{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/utils/promisify-worker.js","webpack:///./src/storage/media-search-store.js","webpack:///./src/utils/media-url-utils.js","webpack:///./src/avatar.js","webpack:///./src/utils/disable-ios-zoom.js","webpack:///./src/utils/async-utils.js","webpack:///./src/utils/i18n.js","webpack:///./src/loaders/HubsTextureLoader.js","webpack:///./src/loaders/HubsBasisTextureLoader.js","webpack:///./src/utils/media-utils.js","webpack:///./src/components/hoverable-visuals.js","webpack:///./src/utils/history.js","webpack:///./src/components/environment-map.js","webpack:///./src/utils/media-highlight-frag.glsl","webpack:///./src/loaders/basis_transcoder.wasm","webpack:///./src/loaders/basis_transcoder.worker.js","webpack:///./src/assets/images/cubemap/posx.jpg","webpack:///./src/assets/images/cubemap/negx.jpg","webpack:///./src/assets/images/cubemap/posy.jpg","webpack:///./src/assets/images/cubemap/negy.jpg","webpack:///./src/assets/images/cubemap/posz.jpg","webpack:///./src/assets/images/cubemap/negz.jpg","webpack:///./src/App.js","webpack:///./src/react-components/avatar-preview.js","webpack:///./src/utils/qs_truthy.js","webpack:///./src/webxr-bypass-hacks.js","webpack:///./src/assets/images/warning_icon@2x.png","webpack:///./src/utils/logging.js","webpack:///./src/assets/stylesheets/avatar-preview.scss?c714","webpack:///./src/object-types.js","webpack:///./src/utils/configs.js","webpack:///./src/utils/avatar-utils.js","webpack:///./src/utils/material-utils.js","webpack:///./src/utils/identity.js","webpack:///./src/storage/store.js","webpack:///./src/assets/images/app-logo.png","webpack:///./src/assets/images/company-logo.png","webpack:///./src/assets/images/editor-logo.png","webpack:///./src/utils/permissions-utils.js","webpack:///./src/utils/name-generation.js","webpack:///./src/utils/phoenix-utils.js","webpack:///./src/assets/models/DuckyMesh.glb","webpack:///./src/utils/next-tick.js","webpack:///./src/components/gltf-model-plus.js","webpack:///./src/utils/three-utils.js","webpack:///./src/utils/image-bitmap-utils.js","webpack:///./src/assets/stylesheets/avatar.scss?bb8d","webpack:///./src/utils/theme.js","webpack:///./src/assets/images/warning_icon.png","webpack:///./src/materials/MobileStandardMaterial.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","2","exports","module","l","e","Promise","resolve","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","oe","err","console","error","jsonpArray","window","oldJsonpFunction","slice","promisifyWorker","worker","nextItemId","outstanding","onmessage","msg","id","handlers","reject","Error","transfer","args","promise","postMessage","assign","payload","__webpack_exports__","EMPTY_RESULT","entries","meta","URL_SOURCE_TO_TO_API_SOURCE","scenes","images","videos","youtube","gifs","sketchfab","poly","twitch","favorites","availableIntegrations","configs","AVAILABLE_INTEGRATIONS","SOURCES","filter","source","apiSource","MEDIA_SOURCE_DEFAULT_FILTERS","SEARCH_CONTEXT_PARAMS","MediaSearchStore","EventTarget","constructor","_this","super","this","_defineProperty","_ref","_asyncToGenerator","location","dispatchEvent","CustomEvent","urlSource","getUrlMediaSource","previousSource","urlParams","URLSearchParams","search","requestIndex","currentRequestIndex","searchParams","locationSearchParams","isMy","startsWith","param","set","navigator","languages","singular","fetch","APP","store","credentialsAccountId","path","toString","url","getReticulumFetchUrl","lastSavedUrl","isFetching","fetchReticulumAuthenticated","nextCursor","next_cursor","lastFetchedUrl","_x","arguments","delta","history","goBack","pushHistoryPath","pathname","query","delete","keepSource","keepNav","keepSelectAction","_stashedParams","_stashedSource","q","_sourceNavigate","selectAction","_ref2","hideNav","useLastStashedParams","currentQuery","getSearchClearedSearchParams","useValue","hasAccountWithAvatars","_hasAccountWithAvatars","hasReticulumServer","document","host","RETICULUM_SERVER","withSlug","_x2","_x3","_x4","_x5","sluglessPath","substring","stashLastSearchParams","_stashLastSearchParams","hasMediaPath","setHistory","_update","listen","nonCorsProxyDomains","NON_CORS_PROXY_DOMAINS","split","CORS_PROXY_SERVER","commonKnownContentTypes","gltf","glb","png","jpg","jpeg","pdf","mp4","mp3","basis","farsparkEncodeUrl","str","btoa","encodeURIComponent","replace","_","p1","String","fromCharCode","b64EncodeUnicode","scaledThumbnailUrlFor","width","height","extension","pathParts","URL","extensionCandidate","pop","thumbnailUrl","THUMBNAIL_SERVER","urlHostname","hostname","isNonCorsProxyDomain","find","domain","endsWith","proxiedUrlFor","parsedUrl","getAbsoluteHref","baseUrl","relativeUrl","getAbsoluteUrl","href","getCustomGLTFParserURLResolver","gltfUrl","test","corsProxyPrefix","originalUrlParts","decodeURIComponent","join","dataUrlRegex","guessContentType","matches","exec","originIsHubsServer","Map","isHubsServer","origin","has","method","headers","hubsSceneRegex","hubsAvatarRegex","_wrapRegExp","hubsRoomRegex","isLocalHubsUrl","isHubsSceneUrl","isLocalHubsSceneUrl","_ref3","isHubsAvatarUrl","_ref4","isLocalHubsAvatarUrl","_ref5","_x6","isHubsRoomUrl","_ref6","_x7","idForAvatarUrl","match","groups","log","process","BUILD_VERSION","addLocaleData","en","disableiOSZoom","qs","App","AvatarUI","React","Component","props","forceUpdate","avatar","fetchAvatar","avatarId","setState","preventDefault","update","profile","state","avatar_id","copyMessage","remixAvatar","setTimeout","componentDidMount","addEventListener","storeUpdated","refetchAvatar","componentWillUnmount","removeEventListener","render","react__WEBPACK_IMPORTED_MODULE_5___default","a","createElement","className","styles","avatarLanding","classNames","box","darkened","selectedAvatarId","isSelected","onSubmit","setAvatar","title","attributions","creator","preview","_react_components_avatar_preview__WEBPACK_IMPORTED_MODULE_14__","avatarGltfUrl","gltf_url","copyTip","type","allow_remixing","editAvatar","onClick","handleCopyAvatar","_fortawesome_react_fontawesome__WEBPACK_IMPORTED_MODULE_17__","icon","faClone","selectedMessage","react_intl__WEBPACK_IMPORTED_MODULE_8__","disabled","formSubmit","logo","src","image","PropTypes","string","intl","ReactDOM","locale","lang","messages","getElementById","detect_browser__WEBPACK_IMPORTED_MODULE_0__","detectOS","userAgent","lastTouchAtMs","ev","scale","now","Date","getTime","isDoubleTouch","waitForEvent","waitForDOMContentLoaded","eventName","eventObj","once","readyState","_configs__WEBPACK_IMPORTED_MODULE_0__","_assets_translations_data_json__WEBPACK_IMPORTED_MODULE_1__","navigatorLang","language","userLanguage","toLowerCase","localeData","_messages","APP_CONFIG","translations","configTranslations","messageKey","map","message","_match","subkey","reduce","acc","entry","HubsTextureLoader","manager","THREE","DefaultLoadingManager","load","onLoad","onProgress","onError","texture","Texture","loadTextureAsync","then","catch","imageLoader","undefined","createImageBitmap","ImageBitmapLoader","flipY","ImageLoader","setCrossOrigin","crossOrigin","setPath","cacheKey","resolveURL","loader","loadAsync","Cache","remove","needsUpdate","onUpdate","close","BasisTextureLoader","Loader","transcoderPath","transcoderBinary","transcoderPending","workerLimit","workerPool","workerNextTaskID","workerConfig","format","astcSupported","etcSupported","dxtSupported","pvrtcSupported","returnBuffer","setTranscoderPath","setWorkerLimit","detectSupport","renderer","config","extensions","BASIS_FORMAT","cTFASTC_4x4","cTFBC3","cTFPVRTC1_4_RGBA","cTFETC1","FileLoader","ranDetect","AFRAME","setResponseType","buffer","_createTexture","taskID","texturePending","_getWorker","_worker","_callbacks","_taskCosts","byteLength","_taskLoad","mipmaps","hasAlpha","CompressedTexture","RGBA_ASTC_4x4_Format","cTFBC1","DXT_FORMAT_MAP","UnsignedByteType","RGB_ETC1_Format","cTFPVRTC1_4_RGB","RGB_PVRTC_4BPPV1_Format","RGBA_PVRTC_4BPPV1_Format","minFilter","LinearFilter","LinearMipmapLinearFilter","magFilter","generateMipmaps","finally","_initTranscoder","binaryLoader","binaryContent","transcoderWasmFile","BasisWorker","sort","b","dispose","terminate","cTFETC2","cTFBC4","cTFBC5","cTFBC7_M6_OPAQUE_ONLY","cTFBC7_M5","cTFATC_RGB","cTFATC_RGBA_INTERPOLATED_ALPHA","cTFRGBA32","cTFRGB565","cTFBGR565","cTFRGBA4444","DXT_FORMAT","COMPRESSED_RGB_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","linkify","Linkify","tlds","mediaAPIEndpoint","isMobile","utils","device","isMobileVR","resolveUrlCache","getDefaultResolveQuality","is360","useLowerQuality","resolveUrl","media_utils_asyncToGenerator","quality","version","bustCache","resultPromise","Content-Type","body","JSON","stringify","media","response","ok","text","statusText","json","upload","file","desiredContentType","formData","FormData","append","getDirectReticulumFetchUrl","getDirectMediaAPIEndpoint","coerceToUrl","urlOrText","indexOf","addMedia","template","contentOrigin","contentSubtype","fitToBox","animate","mediaOptions","networked","parentEl","linkedEl","scene","entity","setAttribute","templateBody","importNode","querySelector","content","firstElementChild","cloneNode","elAttrs","attributes","attrIdx","appendChild","needsToBeUploaded","File","els","querySelectorAll","el","components","Math","max","getLatestMediaVersionOfSrc","fileIsOwned","object3D","matrixNeedsUpdate","orientation","callback","reader","FileReader","onload","view","DataView","target","getUint16","offset","marker","getUint32","little","tags","readAsArrayBuffer","getOrientation","x","srcUrl","access_token","fileId","file_id","uploadPromotionTokens","promotionToken","promotion_token","MediaStream","NAF","clientId","detail","objectType","objectTypeForOriginAndContentType","contentType","emit","cloneMedia","sourceEl","link","ObjectContentOrigins","injectCustomShaderChunks","obj","vertexRegex","fragRegex","shaderUniforms","batchManagerSystem","systems","traverse","material","mapMaterials","hubs_InjectedCustomShaderChunks","validMaterials","includes","classList","contains","getAttribute","batchingEnabled","meshToEl","newMaterial","clone","onBeforeCompile","shader","vertexShader","uniforms","hubs_IsFrozen","hubs_EnableSweepingEffect","hubs_SweepParams","hubs_InteractorOnePos","hubs_InteractorTwoPos","hubs_HighlightInteractorOne","hubs_HighlightInteractorTwo","hubs_Time","vlines","vindex","findIndex","line","unshift","flines","fragmentShader","findex","mediaHighlightFrag","getPromotionTokenForFile","mediaPos","Vector3","addAndArrangeMedia","snapCount","mirrorOrientation","distance","pos","position","y","z","rotation","copy","rotateY","PI","idx","cos","sin","localToWorld","visible","handler","dur","from","to","easing","eventType","textureLoader","createImageTexture","_createImageTexture","Image","res","canvas","ctx","getContext","drawImage","CanvasTexture","status","encoding","sRGBEncoding","anisotropy","basisTextureLoader","HubsBasisTextureLoader","createBasisTexture","addMeshScaleAnimation","mesh","initialScale","onComplete","step","lastValue","anim","animatables","Number","MIN_VALUE","duration","elasticity","loop","round","targets","complete","anime","closeExistingMediaMirror","mirrorTarget","firstChild","removeChild","_utils_material_utils__WEBPACK_IMPORTED_MODULE_0__","_utils_permissions_utils__WEBPACK_IMPORTED_MODULE_1__","interactorOneTransform","interactorTwoTransform","registerComponent","schema","enableSweepingEffect","default","init","geometryRadius","sweepParams","boundingBox","sceneEl","forEachMaterial","isTouchscreen","tick","time","isFrozen","is","showEffect","showHoverEffect","toggling","cursorTogglingSystem","interactorOne","interactorTwo","interaction","ready","leftHand","hovered","held","options","leftRemote","leftToggledOff","rightRemote","rightToggledOff","rightHand","matrixWorld","toArray","worldY","elements","ms1","ms2","ms3","scaledRadius","sqrt","uniform","pushOrUpdateHistory","k","v","newPathname","newSearch","newLength","__historyLength","_objectSpread","__duplicate","isDuplicate","pushHistoryState","replaceHistoryState","clearHistoryState","popToBeginningOfHubHistory","navigateToPriorPage","len","unsubscribe","go","createDefaultEnvironmentMap","_createDefaultEnvironmentMap","urls","cubeMapPosX","cubeMapNegX","cubeMapPosY","cubeMapNegY","cubeMapPosZ","cubeMapNegZ","CubeTextureLoader","RGBFormat","environmentMap","updateEnvironmentMap","applyEnvironmentMap","isMeshStandardMaterial","envMap","_storage_store__WEBPACK_IMPORTED_MODULE_0__","_storage_media_search_store__WEBPACK_IMPORTED_MODULE_1__","Store","mediaSearchStore","setQuality","TEXTURE_PROPS","base_map","emissive_map","normal_map","orm_map","ALL_MAPS","keys","createRenderer","alpha","useDevicePixelRatio","context","depth","antialias","premultipliedAlpha","preserveDrawingBuffer","powerPreference","WebGLRenderer","forceWebVR","gammaOutput","gammaFactor","physicallyCorrectLights","setPixelRatio","devicePixelRatio","createImageBitmapFromURL","blob","ORBIT_ANGLE","Euler","DEG2RAD","DEFAULT_MARGIN","fitBoxInFrustum","camera","center","margin","halfYExtents","min","halfVertFOV","degToRad","fov","tan","applyEuler","add","lookAt","AvatarPreview","Scene","PerspectiveCamera","clientWidth","clientHeight","controls","OrbitControls","enablePan","light","DirectionalLight","HemisphereLight","loadId","matrixAutoUpdate","loadCurrentAvatarGltfUrl","clock","Clock","snapshotCanvas","snapshotCamera","snapshotRenderer","setClearAlpha","previewRenderer","setClearColor","setAnimationLoop","dt","getDelta","mixer","resize","parentElement","offsetWidth","offsetHeight","setSize","aspect","updateProjectionMatrix","resetCamera","loading","Box3","setFromObject","getCenter","disposeNode","domElement","values","imageBitmaps","forEach","img","disposeImageBitmap","oldProps","applyMaps","technique","loadGLTF","ensureAvatarMaterial","previewMesh","findNode","isMesh","MAT_NAME","idleAnimation","animations","AnimationMixer","action","clipAction","enabled","setLoop","LoopRepeat","Infinity","play","idleAnimationAction","getImage","originalMaps","all","prop","bm","stop","toBlob","_this2","newLoadId","loadPreviewAvatar","onGltfLoaded","newProps","mapName","applyMap","applyMapToPreview","revertMap","react__WEBPACK_IMPORTED_MODULE_2___default","_assets_images_warning_icon_png__WEBPACK_IMPORTED_MODULE_0___default","srcSet","_assets_images_warning_icon_2x_png__WEBPACK_IMPORTED_MODULE_1___default","react_intl__WEBPACK_IMPORTED_MODULE_4__","ref","func","injectIntl","withRef","qsTruthy","qsGet","val","xr","requestDevice","getVRDisplays","debug__WEBPACK_IMPORTED_MODULE_0__","debug__WEBPACK_IMPORTED_MODULE_0___default","_qs_truthy__WEBPACK_IMPORTED_MODULE_1__","isDebug","logFilter","debug","enable","ObjectTypes","FILE","CLIPBOARD","SPAWNER","URL_IMAGE","URL_VIDEO","URL_MODEL","URL_PDF","URL_AUDIO","FILE_IMAGE","FILE_VIDEO","FILE_MODEL","FILE_PDF","FILE_AUDIO","CLIPBOARD_IMAGE","CLIPBOARD_VIDEO","CLIPBOARD_MODEL","CLIPBOARD_PDF","CLIPBOARD_AUDIO","SPAWNER_IMAGE","SPAWNER_VIDEO","SPAWNER_MODEL","SPAWNER_PDF","SPAWNER_AUDIO","CAMERA","UNKNOWN","objectTypeForOrigin","urlType","fileType","clipboardType","spawnerType","objectTypeMimePrefixLookupMap","image/","model/","application/x-zip-compressed","video/","application/vnd.apple.mpegurl","application/x-mpegurl","audio/","application/pdf","srcSuffixLookupMap",".m3u8","prefix","suffix","pdfjs_dist__WEBPACK_IMPORTED_MODULE_3__","pdfjs_dist__WEBPACK_IMPORTED_MODULE_3___default","isAdmin","__webpack_public_path__","pdfjs","GlobalWorkerOptions","workerSrc","theme","colorVars","style","innerHTML","head","prepend","features","feature","featureName","enableAll","localDevImages","imageName","cssUrl","linkName","defaultValue","links","setIsAdmin","_isAdmin","AVATARS_API","AVATAR_TYPES","SKINNABLE","getAvatarType","resp","avatars","_fetchAvatar","fetchSkinnableAvatar","getAvatarSrc","fetchAvatarGltfUrl","getAvatarThumbnailUrl","_getAvatarThumbnailUrl","files","thumbnail","materials","materialForMesh","primitives","primitive","nodes","node","meshes","children","concat","_remixAvatar","parentId","parent_avatar_listing_id","fn","Array","isArray","names","chooseRandom","arr","floor","random","fetchRandomDefaultAvatarId","_fetchRandomDefaultAvatarId","defaultAvatars","ducky","LOCAL_STORE_KEY","STORE_STATE_CACHE_KEY","OAUTH_FLOW_CREDENTIALS_KEY","validator","Validator","SCHEMA","definitions","additionalProperties","properties","displayName","pattern","personalAvatarId","credentials","token","email","activity","hasFoundFreeze","hasChangedName","hasAcceptedProfile","lastEnteredAt","hasPinned","hasRotated","hasRecentered","hasScaled","hasHoveredInWorldHud","hasOpenedShare","entryCount","settings","lastUsedMicDeviceId","preferences","muteMicOnEntry","enableOnScreenJoystickLeft","enableOnScreenJoystickRight","onlyShowNametagsInFreeze","allowMultipleHubsInstances","maxResolutionWidth","maxResolutionHeight","globalVoiceVolume","globalMediaVolume","snapRotationDegrees","materialQualitySetting","disableMovement","disableBackwardsMovement","disableStrafing","disableTeleporter","disableAutoPixelRatio","confirmedDiscordRooms","items","confirmedBroadcastedRooms","creatorAssignmentTokens","hubId","creatorAssignmentToken","embedTokens","embedToken","onLoadActions","$ref","jwtDecode","exp","store_asyncToGenerator","_shouldResetAvatarOnInit","resetToRandomDefaultAvatar","localStorage","getItem","setItem","oauthFlowCredentials","Cookies","getJSON","_signOutOnExpiredAuthToken","parse","sub","resetConfirmedBroadcastedRooms","clearStoredArray","resetTipActivityFlags","bumpEntryCount","currentEntryCount","enqueueOnLoadAction","executeOnLoadActions","event","clearOnLoadActions","arrayMerge","destinationArray","sourceArray","newState","mergeOpts","finalState","merge","valid","validate","isPinned","pinnable","pinned","isSpawner","isEmojiSpawner","canMove","emoji","hubChannel","can","networkedTemplate","isCamera","isPen","isEmoji","holdableButton","indexForComponent","component","fullComponent","componentName","schemaComponent","authorizeOrSanitizeMessage","applyPersistentSync","nonAuthorizedSchemas","sanitizeMessageData","schemaDict","schemas","nonAuthorizedComponents","nonAuthorizedComponent","index","initializeNonAuthorizedSchemas","nonAuthorizedIndices","authorizeEntityManipulation","entityMetadata","sender","senderPermissions","isCreator","pin_objects","spawn_and_move_media","spawn_camera","spawn_drawing","spawn_emoji","getPendingOrExistingEntityMetadata","networkId","pendingData","connection","adapter","getPendingDataForNetworkId","pinnableComponent","entities","getEntity","authorizeOrSanitizeMessageData","persistentSyncs","stashPersistentSync","entityData","currentData","currentComponents","dataType","from_session_id","emptyObject","isFirstSync","persistent","presenceState","presence","metas","permissions","sanitizedAny","stashedAny","PHOENIX_RELIABLE_NAF","onData","adjectives","nouns","generateHubName","randItem","charAt","toUpperCase","isLocalClient","resolverLink","directReticulumHostAndPort","reticulumMeta","invalidatedReticulumMetaThisSession","absolute","port","getReticulumMeta","_getReticulumMeta","pool","phx_host","phxHostOverride","RETICULUM_SOCKET_SERVER","protocol","warn","invalidateReticulumMeta","_invalidateReticulumMeta","connectToReticulum","_connectToReticulum","params","socketClass","Socket","getNewSocketUrl","refreshDirectReticulumHostAndPort","RETICULUM_SOCKET_PROTOCOL","socketUrl","socketSettings","logger","kind","socket","connect","endPointPath","endPoint","newEndPoint","getLandingPageForPhoto","photoUrl","retUrl","content-type","authorization","createAndRedirectToNewHub","_createAndRedirectToNewHub","sceneId","createUrl","hub","scene_id","creator_assignment_token","hub_id","embed_token","BASE_ASSETS_PATH","getPresenceEntryForSession","presences","sessionId","getPresenceContextForSession","getPresenceProfileForSession","migrateChannelToSocket","oldChannel","channel","topic","bindings","item","on","pushBuffer","timeout","oldJoinPush","joinPush","recHooks","receive","discordBridgesForPresences","channels","discordBridges","nextTick","Mesh","raycast","acceleratedRaycast","gltfCache","[object Object]","cache","count","retain","cacheItem","release","inflightGltfs","extractZipFile","SketchfabZipWorker","defaultInflator","componentData","multiple","cloneGltf","cloneObject3D","getHubsComponents","hubsComponents","userData","gltfExtensions","MOZ_hubs_components","HUBS_components","legacyComponents","GLTFModelPlus","componentKey","inflator","inflateEntities","indexToEntityMap","templates","isRoot","modelToWorldScale","childEntities","child","entityComponents","uuid","order","setFromQuaternion","quaternion","multiplyScalar","matrix","identity","decompose","setObject3D","generateUUID","parent","morphTargetInfluences","gltfIndex","inflatedEntity","isFirstInflation","objectInflations","objectInflation","_x9","attachTemplate","root","templateRoot","targetEls","getHubsComponentsExtension","extras","_loadGLTF","preferredTechnique","jsonPreprocessor","fileMap","loadingManager","LoadingManager","setURLModifier","gltfLoader","GLTFLoader","setBasisTextureLoader","parser","createParser","oldHeightfieldNode","heightfield","range","decay","runMigration","MOZ_alt_materials","altMaterialIndex","Object3D","DefaultMatrixAutoUpdate","MobileStandardMaterial","fromStandardMaterial","revokeObjectURL","loadModel","_x8","_loadModel","useCache","resolveAsset","assetEl","inflate","batch","loadTemplates","applySrc","model","removeObject","object3DMap","templateEl","lastSrc","inflatedEl","disposeLastInflatedEl","addObject","initMixer","hasBufferGeometry","geometry","isBufferGeometry","hasBoundsTree","boundsTree","geo","triCount","MeshBVH","strategy","maxDepth","object3DToSet","inflateComponents","rewires","environmentMapComponent","f","parentNode","removeAttribute","getLastWorldPosition","getLastWorldQuaternion","setMatrixWorld","interpolateAffine","squareDistanceBetween","affixToWorldUp","calculateCameraTransformForWaypoint","calculateViewingDistance","rotateInPlaceAroundWorldUp","childMatch","tempVector3","Quaternion","updateMatrices","setFromMatrixPosition","disposeMaterial","mtrl","lightMap","bumpMap","normalMap","specularMap","materialArray","MeshFaceMaterial","MultiMaterial","IDENTITY","Matrix4","matrixIsModified","applyMatrix","getInverse","multiply","childrenNeedMatrixWorldUpdate","cloneAnimationClip","sourceAnimationClip","cloneUUIDLookup","clonedTracks","tracks","keyframeTrack","sourceKeyframeTrack","nodeName","objectName","objectIndex","propertyName","propertyIndex","PropertyBinding","parseTrackName","clonedUUID","clonedKeyframeTrack","cloneKeyframeTrack","AnimationClip","preserveUUIDs","cloneLookup","parallelTraverse","sourceNode","clonedNode","animationClip","isSkinnedMesh","sourceBones","skeleton","bones","sourceBone","bindMatrix","pred","mat4","end","start","interpolated","startMat4","endMat4","progress","outMat4","setFromRotationMatrix","extractRotation","slerp","lerpVectors","setFromMatrixColumn","setFromMatrixScale","compose","posA","posB","objA","objB","distanceToSquared","inRotationMat4","inForward","outForward","outSide","worldUp","inMat4Copy","inMat4","projectOnVector","normalize","crossVectors","makeBasis","setPosition","upAffixedCameraTransform","upAffixedWaypointTransform","detachFromWorldUp","cameraTransform","waypointTransform","vrMode","abs","halfXExtents","halfHorFOV","atan","length1","length2","length3","startRotation","endRotation","theta","makeRotationY","childInverse","newParentMatrix","multiplyMatrices","Blob","createObjectURL","putImageData","toDataURL","imageBitmap","HTMLImageElement","avatar-landing","form-submit","selected-message","copy-tip","edit-avatar","applyThemeToTextButton","getThemeColor","_async_utils__WEBPACK_IMPORTED_MODULE_0__","DEFAULT_COLORS","action-color","action-label-color","action-color-disabled","action-color-highlight","action-text-color","action-subtitle-color","notice-background-color","notice-text-color","favorited-color","highlighted","actionColor","actionHoverColor","VERTEX_SHADER","FRAGMENT_SHADER","ShaderMaterial","parameters","UniformsUtils","UniformsLib","fog","uvTransform","Matrix3","diffuse","color","opacity","aoMapIntensity","aoMap","emissive","emissiveMap","lights","transparent","alphaTest","skinning","morphTargets","vertexColors","mobileMaterial","emissiveIntensity","refreshUniforms","uvScaleMap","updateMatrix"],"mappings":"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CxDxxB,EAFmBgzB,EAQ5B,OAAOhzB,EAIX,MAAMyzB,EAAuB,eACtB,SAAS9C,EAAoBqB,GAC7BS,EAAgBT,KACrBtkB,IAAIwkB,WAAWC,QAAQuB,OAAOhD,EAA2B+B,EAAgBT,IAAayB,UAC/EhB,EAAgBT,kDCxOzB,MAAM2B,EAAa,CACjB,OACA,WACA,aACA,YACA,eACA,WACA,SACA,YACA,WACA,cACA,QACA,UACA,UACA,OACA,SACA,UACA,WACA,SACA,WACA,aACA,WACA,SACA,UACA,UACA,OACA,QACA,QACA,UACA,OACA,YACA,WACA,SACA,WACA,OACA,WACA,WACA,SACA,QACA,YACA,MACA,WACA,SACA,UACA,QACA,WACA,WACA,QACA,QACA,MACA,QACA,YACA,OACA,UACA,SACA,cACA,WACA,UACA,YACA,UACA,WACA,YACA,UACA,aACA,SACA,WACA,UACA,WACA,SACA,YACA,UACA,QACA,OACA,OACA,QACA,YACA,QACA,SACA,SACA,QACA,UACA,aACA,SACA,cACA,YACA,WACA,OACA,QACA,WACA,UACA,WACA,WACA,cACA,cACA,OACA,SACA,QACA,YACA,UACA,WACA,SACA,WACA,eACA,aACA,OACA,SACA,MACA,WACA,SACA,QACA,SACA,UACA,QACA,QACA,SACA,SACA,WACA,OACA,UACA,aACA,aACA,YACA,YACA,UACA,SACA,UACA,aACA,aACA,OACA,YACA,WACA,WACA,SACA,YACA,WACA,aACA,aACA,cACA,UACA,UACA,OACA,QACA,QACA,SACA,OACA,WACA,OACA,YACA,QACA,UACA,UACA,WACA,QACA,WACA,YACA,QACA,YACA,QACA,OACA,YACA,aACA,QACA,SACA,SACA,QACA,QACA,QACA,MACA,QACA,WACA,QACA,WACA,QACA,WACA,UACA,SACA,OACA,QACA,MACA,UACA,QACA,UACA,QACA,QACA,QACA,WACA,WACA,SACA,WACA,WACA,cACA,gBACA,WACA,aACA,QACA,aACA,YACA,cACA,WACA,aACA,UACA,YACA,UACA,YACA,YACA,aACA,YACA,WACA,OACA,WACA,OACA,YACA,QACA,SACA,WACA,WACA,SACA,SACA,OACA,WACA,WACA,UACA,YACA,SACA,UACA,YACA,aACA,QACA,SACA,eACA,UACA,QACA,SACA,UACA,YACA,OACA,MACA,UACA,UACA,WACA,WACA,QACA,QACA,WACA,SACA,WACA,WACA,aACA,SACA,aACA,cACA,SACA,aACA,WACA,SACA,SACA,OACA,QACA,SACA,SACA,SACA,UACA,OACA,WACA,QACA,aACA,SACA,UACA,UACA,WACA,YACA,YACA,QACA,UACA,YACA,QACA,SACA,UACA,UACA,UACA,UACA,OACA,QACA,OACA,SACA,YACA,UACA,YACA,cACA,WACA,UACA,eACA,SACA,OACA,cACA,WACA,YACA,SACA,WACA,UACA,YACA,UACA,WACA,WACA,SACA,YACA,UACA,OACA,WACA,QACA,YACA,WACA,WACA,QACA,QACA,SACA,OACA,YACA,SACA,eACA,aACA,WACA,SACA,SACA,YACA,SACA,OACA,WACA,YACA,QACA,QACA,OACA,OACA,QACA,SACA,UACA,UACA,SACA,UACA,OACA,WACA,UACA,WACA,YACA,WACA,UACA,cACA,QACA,YACA,OACA,QACA,WACA,OACA,QACA,OACA,gBACA,UACA,YACA,cACA,SACA,QACA,SACA,WACA,WACA,WACA,WACA,OACA,UACA,OACA,QACA,SACA,SACA,SACA,WACA,SACA,SACA,OACA,OACA,UACA,UACA,QACA,SACA,eACA,cACA,WACA,UACA,cACA,SACA,YACA,SACA,cACA,aACA,YACA,SACA,QACA,SACA,WACA,QACA,UACA,WACA,YACA,YACA,cACA,QACA,OACA,YACA,YACA,YACA,YACA,aACA,YACA,WACA,QACA,OACA,WACA,QACA,WACA,aACA,SACA,WACA,WACA,SACA,YACA,UACA,UACA,aACA,MACA,OACA,aACA,WACA,WACA,YACA,cACA,QACA,QACA,UACA,gBACA,WACA,OACA,UACA,SACA,SACA,SACA,aACA,SACA,UACA,WACA,WACA,SACA,UACA,UACA,WACA,UACA,QACA,aACA,aACA,QACA,iBACA,UACA,SACA,SACA,WACA,SACA,QACA,SACA,QACA,cACA,WACA,UACA,SACA,WACA,WACA,QACA,UACA,YACA,aACA,aACA,SACA,SACA,UACA,SACA,UACA,QACA,YACA,SACA,UACA,WACA,WACA,YACA,aACA,UACA,YACA,YACA,QACA,UACA,SACA,WACA,OACA,UACA,SACA,WACA,QACA,QACA,OACA,cACA,YACA,WACA,UACA,WACA,SACA,cACA,SACA,SACA,WACA,OACA,WACA,QACA,QACA,UACA,QACA,QACA,SACA,YACA,SACA,cACA,cACA,QACA,QACA,QACA,QACA,WACA,WACA,YACA,eACA,aACA,aACA,OACA,aACA,cACA,YACA,SACA,QACA,UACA,WACA,OACA,OACA,UACA,WACA,SACA,aACA,SACA,UACA,UACA,SACA,QACA,QACA,SACA,aACA,YACA,QACA,QACA,cACA,UACA,WACA,cACA,SACA,WACA,OACA,SACA,OACA,SACA,WACA,QACA,QACA,UACA,aACA,SACA,WACA,MACA,QACA,YACA,UACA,OACA,UACA,OACA,WACA,OACA,QACA,UACA,QACA,OACA,SACA,WACA,SACA,OACA,UACA,SACA,cACA,YACA,UAGIC,EAAQ,CACZ,QACA,OACA,QACA,WACA,QACA,OACA,SACA,QACA,YACA,SACA,eACA,WACA,QACA,SACA,WACA,QACA,SACA,UACA,OACA,SACA,SACA,UACA,OACA,OACA,OACA,QACA,OACA,QACA,YACA,SACA,OACA,SACA,SACA,WACA,YACA,cACA,SACA,YACA,SACA,UACA,aACA,WACA,cACA,YACA,OACA,UACA,SACA,aACA,WACA,eACA,aACA,SACA,OACA,UAGK,SAASC,IACd,MAAMC,EAAWvjC,IACf,MAAMzG,EAAIyG,EAAIob,KAAK8d,MAAM9d,KAAK+d,SAAWn5B,EAAI7H,SAC7C,OAAOoB,EAAEiqC,OAAO,GAAGC,cAAgBlqC,EAAEwC,M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","file":"assets/js/avatar-a15aca393dfa09629d02.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t2: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"assets/js/\" + ({}[chunkId]||chunkId) + \"-\" + {}[chunkId] + \".js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// The chunk loading function for additional chunks\n \t// Since all referenced chunks are already included\n \t// in this file, this function is empty here.\n \t__webpack_require__.e = function requireEnsure() {\n \t\treturn Promise.resolve();\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/hubs\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([1224,1,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","// Wrapper for a worker which accepts work items and responds with results.\r\n//\r\n// The worker must receive messages with data of the shape { id, payload }, and then respond\r\n// with messages containing matching IDs of the shape { id, result, err }.\r\n//\r\n// Returns a function that accepts a work item, sends it to the worker, and returns a promise that\r\n// will resolve with the result or reject with the error.\r\n//\r\nexport function promisifyWorker(worker) {\r\n  let nextItemId = 0;\r\n  const outstanding = {}; // item ID: { resolve, reject }\r\n\r\n  worker.onmessage = msg => {\r\n    const { id, result, err } = msg.data;\r\n    const handlers = outstanding[id];\r\n    if (handlers == null) {\r\n      console.error(`Unknown message with ID ${id} received from ${worker}.`);\r\n    } else {\r\n      delete outstanding[id];\r\n      if (err != null) {\r\n        handlers.reject(new Error(err));\r\n      } else {\r\n        handlers.resolve(result);\r\n      }\r\n    }\r\n  };\r\n\r\n  return function(data, transfer, args = {}) {\r\n    const id = nextItemId++;\r\n    const promise = new Promise((resolve, reject) => {\r\n      outstanding[id] = { resolve, reject };\r\n    });\r\n    worker.postMessage(Object.assign(args, { id, payload: data }), transfer);\r\n    return promise;\r\n  };\r\n}\r\n","import { EventTarget } from \"event-target-shim\";\r\nimport configs from \"../utils/configs\";\r\nimport { getReticulumFetchUrl, fetchReticulumAuthenticated, hasReticulumServer } from \"../utils/phoenix-utils\";\r\nimport { pushHistoryPath, sluglessPath, withSlug } from \"../utils/history\";\r\n\r\nconst EMPTY_RESULT = { entries: [], meta: {} };\r\n\r\nconst URL_SOURCE_TO_TO_API_SOURCE = {\r\n  scenes: \"scene_listings\",\r\n  images: \"bing_images\",\r\n  videos: \"bing_videos\",\r\n  youtube: \"youtube_videos\",\r\n  gifs: \"tenor\",\r\n  sketchfab: \"sketchfab\",\r\n  poly: \"poly\",\r\n  twitch: \"twitch\",\r\n  favorites: \"favorites\"\r\n};\r\n\r\nconst desiredSources = [\"poly\", \"sketchfab\", \"videos\", \"scenes\", \"avatars\", \"gifs\", \"images\"];\r\nconst availableIntegrations = configs.AVAILABLE_INTEGRATIONS;\r\nconst availableSources = desiredSources.filter(source => {\r\n  const apiSource = URL_SOURCE_TO_TO_API_SOURCE[source];\r\n  return !availableIntegrations.hasOwnProperty(apiSource) || availableIntegrations[apiSource];\r\n});\r\nexport const SOURCES = availableSources;\r\n\r\nexport const MEDIA_SOURCE_DEFAULT_FILTERS = {\r\n  gifs: \"trending\",\r\n  sketchfab: \"featured\",\r\n  scenes: \"featured\",\r\n  favorites: \"my-favorites\"\r\n};\r\n\r\nconst SEARCH_CONTEXT_PARAMS = [\"q\", \"filter\", \"cursor\", \"similar_to\"];\r\n\r\n// This class is responsible for fetching and storing media search results and provides a\r\n// convenience API for performing history updates relevant to search navigation.\r\nexport default class MediaSearchStore extends EventTarget {\r\n  constructor() {\r\n    super();\r\n\r\n    this.requestIndex = 0;\r\n  }\r\n\r\n  setHistory(history) {\r\n    this.history = history;\r\n\r\n    this._update(this.history.location);\r\n\r\n    this.history.listen(location => {\r\n      this._update(location);\r\n    });\r\n  }\r\n\r\n  _update = async location => {\r\n    this.result = null;\r\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\r\n\r\n    const urlSource = this.getUrlMediaSource(location);\r\n    if (!urlSource) return;\r\n\r\n    if (!this.previousSource || this.previousSource !== urlSource) {\r\n      this.dispatchEvent(new CustomEvent(\"sourcechanged\"));\r\n      this.previousSource = urlSource;\r\n    }\r\n\r\n    const urlParams = new URLSearchParams(location.search);\r\n\r\n    this.requestIndex++;\r\n    const currentRequestIndex = this.requestIndex;\r\n    const searchParams = new URLSearchParams();\r\n    const locationSearchParams = new URLSearchParams(location.search);\r\n    const isMy = locationSearchParams.get(\"filter\") && locationSearchParams.get(\"filter\").startsWith(\"my-\");\r\n\r\n    for (const param of SEARCH_CONTEXT_PARAMS) {\r\n      if (!urlParams.get(param)) continue;\r\n      searchParams.set(param, urlParams.get(param));\r\n    }\r\n\r\n    searchParams.get(\"locale\", navigator.languages[0]);\r\n\r\n    let source;\r\n    if (urlSource === \"avatars\" || urlSource === \"scenes\") {\r\n      // Avatars + scenes are special since we request them from a different source based on the facet.\r\n      const singular = urlSource === \"avatars\" ? \"avatar\" : \"scene\";\r\n      source = isMy ? `${singular}s` : `${singular}_listings`;\r\n    } else {\r\n      source = URL_SOURCE_TO_TO_API_SOURCE[urlSource];\r\n    }\r\n    searchParams.set(\"source\", source);\r\n\r\n    let fetch = true;\r\n\r\n    if (source === \"avatars\" || source === \"scenes\" || source === \"favorites\") {\r\n      if (isMy) {\r\n        if (window.APP.store.credentialsAccountId) {\r\n          searchParams.set(\"user\", window.APP.store.credentialsAccountId);\r\n        } else {\r\n          fetch = false; // Don't fetch my-* if not signed in\r\n        }\r\n      }\r\n    }\r\n\r\n    const path = `/api/v1/media/search?${searchParams.toString()}`;\r\n    const url = getReticulumFetchUrl(path);\r\n    if (this.lastSavedUrl === url) return;\r\n\r\n    this.isFetching = true;\r\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\r\n    const result = fetch ? await fetchReticulumAuthenticated(path) : EMPTY_RESULT;\r\n\r\n    if (this.requestIndex != currentRequestIndex) return;\r\n\r\n    this.result = result;\r\n    this.nextCursor = this.result && this.result.meta && this.result.meta.next_cursor;\r\n    this.lastFetchedUrl = url;\r\n    this.isFetching = false;\r\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\r\n  };\r\n\r\n  pageNavigate = delta => {\r\n    if (delta === -1) {\r\n      this.history.goBack();\r\n    } else {\r\n      const location = this.history.location;\r\n      const searchParams = new URLSearchParams(location.search);\r\n      searchParams.set(\"cursor\", this.nextCursor);\r\n      pushHistoryPath(this.history, location.pathname, searchParams.toString());\r\n    }\r\n  };\r\n\r\n  filterQueryNavigate = (filter, query) => {\r\n    const location = this.history.location;\r\n    const searchParams = new URLSearchParams(location.search);\r\n\r\n    searchParams.delete(\"similar_to\");\r\n    searchParams.delete(\"similar_name\");\r\n\r\n    if (query) {\r\n      searchParams.set(\"q\", query);\r\n    } else {\r\n      searchParams.delete(\"q\");\r\n    }\r\n\r\n    if (filter) {\r\n      searchParams.set(\"filter\", filter);\r\n    } else {\r\n      searchParams.delete(\"filter\");\r\n    }\r\n\r\n    if (filter) {\r\n      searchParams.set(\"cursor\", filter);\r\n    } else {\r\n      searchParams.delete(\"cursor\");\r\n    }\r\n\r\n    pushHistoryPath(this.history, location.pathname, searchParams.toString());\r\n  };\r\n\r\n  getSearchClearedSearchParams = (location, keepSource, keepNav, keepSelectAction) => {\r\n    const searchParams = new URLSearchParams(location.search);\r\n\r\n    // Strip browsing query params\r\n    searchParams.delete(\"q\");\r\n    searchParams.delete(\"filter\");\r\n    searchParams.delete(\"cursor\");\r\n    searchParams.delete(\"similar_to\");\r\n    searchParams.delete(\"similar_name\");\r\n\r\n    if (!keepNav) {\r\n      searchParams.delete(\"media_nav\");\r\n    }\r\n\r\n    if (!keepSource) {\r\n      searchParams.delete(\"media_source\");\r\n    }\r\n\r\n    if (!keepSelectAction) {\r\n      searchParams.delete(\"selectAction\");\r\n    }\r\n\r\n    return searchParams;\r\n  };\r\n\r\n  _stashLastSearchParams = location => {\r\n    const searchParams = new URLSearchParams(location.search);\r\n\r\n    this._stashedParams = {};\r\n    this._stashedSource = null;\r\n\r\n    const source = this.getUrlMediaSource(location);\r\n\r\n    // HACK for now do not stash favorite search, since that ends up being a source\r\n    // we do not reveal in the media browser UX. Revisit the rules here when we have a\r\n    // proper favorites browser. Then, we should have two separate stashes.\r\n    if (source === \"favorites\") return;\r\n    this._stashedSource = source;\r\n\r\n    for (const param of SEARCH_CONTEXT_PARAMS) {\r\n      const value = searchParams.get(param);\r\n\r\n      if (value) {\r\n        this._stashedParams[param] = value;\r\n      }\r\n    }\r\n  };\r\n\r\n  clearStashedQuery = () => {\r\n    if (!this._stashedParams) return;\r\n    delete this._stashedParams.q;\r\n  };\r\n\r\n  sourceNavigate = source => {\r\n    this._sourceNavigate(source, false, true);\r\n  };\r\n\r\n  sourceNavigateToDefaultSource = () => {\r\n    this._sourceNavigate(this._stashedSource ? this._stashedSource : SOURCES[0], false, true);\r\n  };\r\n\r\n  sourceNavigateWithNoNav = (source, selectAction) => {\r\n    this._sourceNavigate(source, true, false, selectAction);\r\n  };\r\n\r\n  _sourceNavigate = async (source, hideNav, useLastStashedParams, selectAction) => {\r\n    const currentQuery = new URLSearchParams(this.history.location.search).get(\"q\");\r\n    const searchParams = this.getSearchClearedSearchParams(this.history.location);\r\n\r\n    if (currentQuery) {\r\n      searchParams.set(\"q\", currentQuery);\r\n    } else {\r\n      if (useLastStashedParams && this._stashedParams) {\r\n        for (const param of SEARCH_CONTEXT_PARAMS) {\r\n          const value = this._stashedParams[param];\r\n\r\n          // Only q param is compatible across sources, so keep it if is stashed.\r\n          const useValue = param === \"q\" || this._stashedSource === source;\r\n\r\n          if (value && useValue) {\r\n            searchParams.set(param, value);\r\n          }\r\n        }\r\n      } else {\r\n        if (source === \"avatars\") {\r\n          const hasAccountWithAvatars = await this._hasAccountWithAvatars();\r\n          searchParams.set(\"filter\", hasAccountWithAvatars ? \"my-avatars\" : \"featured\");\r\n        } else if (MEDIA_SOURCE_DEFAULT_FILTERS[source]) {\r\n          searchParams.set(\"filter\", MEDIA_SOURCE_DEFAULT_FILTERS[source]);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._stashedParams = null;\r\n    this._stashedSource = null;\r\n\r\n    if (hideNav) {\r\n      searchParams.set(\"media_nav\", \"false\");\r\n    }\r\n\r\n    if (selectAction) {\r\n      searchParams.set(\"selectAction\", selectAction);\r\n    }\r\n\r\n    if (hasReticulumServer() && document.location.host !== configs.RETICULUM_SERVER) {\r\n      searchParams.set(\"media_source\", source);\r\n      pushHistoryPath(this.history, this.history.location.pathname, searchParams.toString());\r\n    } else {\r\n      pushHistoryPath(this.history, withSlug(this.history.location, `/media/${source}`), searchParams.toString());\r\n    }\r\n  };\r\n\r\n  _hasAccountWithAvatars = async () => {\r\n    const { credentialsAccountId } = window.APP.store;\r\n    if (!credentialsAccountId) return false;\r\n\r\n    const searchParams = new URLSearchParams();\r\n    const source = \"avatars\";\r\n    searchParams.set(\"source\", source);\r\n    searchParams.set(\"user\", credentialsAccountId);\r\n    const result = await fetchReticulumAuthenticated(`/api/v1/media/search?${searchParams.toString()}`);\r\n    return !!(result && result.entries) && result.entries.length > 0;\r\n  };\r\n\r\n  getUrlMediaSource = location => {\r\n    const { search } = location;\r\n    const urlParams = new URLSearchParams(search);\r\n    const pathname = sluglessPath(location);\r\n\r\n    if (!pathname.startsWith(\"/media\") && !urlParams.get(\"media_source\")) return null;\r\n    return urlParams.get(\"media_source\") || pathname.substring(7);\r\n  };\r\n\r\n  pushExitMediaBrowserHistory = (history, stashLastSearchParams = true) => {\r\n    if (!history) history = this.history;\r\n\r\n    if (stashLastSearchParams) this._stashLastSearchParams(history.location);\r\n\r\n    const { pathname } = history.location;\r\n    const hasMediaPath = sluglessPath(history.location).startsWith(\"/media\");\r\n    pushHistoryPath(\r\n      history,\r\n      hasMediaPath ? withSlug(history.location, \"/\") : pathname,\r\n      this.getSearchClearedSearchParams(history.location).toString()\r\n    );\r\n    this.dispatchEvent(new CustomEvent(\"media-exit\"));\r\n  };\r\n}\r\n","import { hasReticulumServer } from \"./phoenix-utils\";\r\nimport configs from \"./configs\";\r\n\r\nconst nonCorsProxyDomains = (configs.NON_CORS_PROXY_DOMAINS || \"\").split(\",\");\r\nif (configs.CORS_PROXY_SERVER) {\r\n  nonCorsProxyDomains.push(configs.CORS_PROXY_SERVER);\r\n}\r\n\r\nconst commonKnownContentTypes = {\r\n  gltf: \"model/gltf\",\r\n  glb: \"model/gltf-binary\",\r\n  png: \"image/png\",\r\n  jpg: \"image/jpeg\",\r\n  jpeg: \"image/jpeg\",\r\n  pdf: \"application/pdf\",\r\n  mp4: \"video/mp4\",\r\n  mp3: \"audio/mpeg\",\r\n  basis: \"image/basis\"\r\n};\r\n\r\n// thanks to https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\r\nfunction b64EncodeUnicode(str) {\r\n  // first we use encodeURIComponent to get percent-encoded UTF-8, then we convert the percent-encodings\r\n  // into raw bytes which can be fed into btoa.\r\n  const CHAR_RE = /%([0-9A-F]{2})/g;\r\n  return btoa(encodeURIComponent(str).replace(CHAR_RE, (_, p1) => String.fromCharCode(\"0x\" + p1)));\r\n}\r\n\r\nconst farsparkEncodeUrl = url => {\r\n  // farspark doesn't know how to read '=' base64 padding characters\r\n  // translate base64 + to - and / to _ for URL safety\r\n  return b64EncodeUnicode(url)\r\n    .replace(/=+$/g, \"\")\r\n    .replace(/\\+/g, \"-\")\r\n    .replace(/\\//g, \"_\");\r\n};\r\n\r\nexport const scaledThumbnailUrlFor = (url, width, height) => {\r\n  let extension = \"\";\r\n  try {\r\n    const pathParts = new URL(url).pathname.split(\".\");\r\n\r\n    if (pathParts.length > 1) {\r\n      const extensionCandidate = pathParts.pop();\r\n      if (commonKnownContentTypes[extensionCandidate]) {\r\n        extension = `.${extensionCandidate}`;\r\n      }\r\n    }\r\n  } catch (e) {\r\n    extension = \".png\";\r\n  }\r\n\r\n  // HACK: the extension is needed to ensure CDN caching on Cloudflare\r\n  const thumbnailUrl = `https://${configs.THUMBNAIL_SERVER}/thumbnail/${farsparkEncodeUrl(\r\n    url\r\n  )}${extension}?w=${width}&h=${height}`;\r\n\r\n  try {\r\n    const urlHostname = new URL(url).hostname;\r\n\r\n    if (hasReticulumServer()) {\r\n      const retHostname = new URL(`https://${configs.RETICULUM_SERVER}`).hostname;\r\n      if (retHostname === urlHostname) return url;\r\n    }\r\n  } catch (e) {\r\n    return thumbnailUrl;\r\n  }\r\n\r\n  return thumbnailUrl;\r\n};\r\n\r\nexport const isNonCorsProxyDomain = hostname => {\r\n  return nonCorsProxyDomains.find(domain => hostname.endsWith(domain));\r\n};\r\n\r\nexport const proxiedUrlFor = url => {\r\n  if (!(url.startsWith(\"http:\") || url.startsWith(\"https:\"))) return url;\r\n\r\n  // Skip known domains that do not require CORS proxying.\r\n  try {\r\n    const parsedUrl = new URL(url);\r\n    if (isNonCorsProxyDomain(parsedUrl.hostname)) return url;\r\n  } catch (e) {\r\n    // Ignore\r\n  }\r\n\r\n  return `https://${configs.CORS_PROXY_SERVER}/${url}`;\r\n};\r\n\r\nexport function getAbsoluteUrl(baseUrl, relativeUrl) {\r\n  return new URL(relativeUrl, baseUrl);\r\n}\r\n\r\nexport function getAbsoluteHref(baseUrl, relativeUrl) {\r\n  return getAbsoluteUrl(baseUrl, relativeUrl).href;\r\n}\r\n\r\nexport const getCustomGLTFParserURLResolver = gltfUrl => url => {\r\n  if (typeof url !== \"string\" || url === \"\") return \"\";\r\n  if (/^(https?:)?\\/\\//i.test(url)) return url;\r\n  if (/^data:.*,.*$/i.test(url)) return url;\r\n  if (/^blob:.*$/i.test(url)) return url;\r\n\r\n  if (configs.CORS_PROXY_SERVER) {\r\n    // For absolute paths with a CORS proxied gltf URL, re-write the url properly to be proxied\r\n    const corsProxyPrefix = `https://${configs.CORS_PROXY_SERVER}/`;\r\n\r\n    if (gltfUrl.startsWith(corsProxyPrefix)) {\r\n      const originalUrl = decodeURIComponent(gltfUrl.substring(corsProxyPrefix.length));\r\n      const originalUrlParts = originalUrl.split(\"/\");\r\n\r\n      // Drop the .gltf filename\r\n      const path = new URL(url).pathname;\r\n      const assetUrl = originalUrlParts.slice(0, originalUrlParts.length - 1).join(\"/\") + \"/\" + path;\r\n      return corsProxyPrefix + assetUrl;\r\n    }\r\n  }\r\n\r\n  return url;\r\n};\r\n\r\nconst dataUrlRegex = /data:([a-zA-Z0-9]+\\/[a-zA-Z0-9-.+]+).*,.*/;\r\n\r\nexport const guessContentType = url => {\r\n  if (!url) return;\r\n  if (url.startsWith(\"hubs://\") && url.endsWith(\"/video\")) return \"video/vnd.hubs-webrtc\";\r\n  if (url.startsWith(\"data:\")) {\r\n    const matches = dataUrlRegex.exec(url);\r\n    if (matches.length > 0) {\r\n      matches[1];\r\n    }\r\n  }\r\n  const extension = new URL(url, window.location).pathname.split(\".\").pop();\r\n  return commonKnownContentTypes[extension];\r\n};\r\n\r\nconst originIsHubsServer = new Map();\r\nasync function isHubsServer(url) {\r\n  if (!url) return false;\r\n  if (!url.startsWith(\"http\")) {\r\n    url = \"https://\" + url;\r\n  }\r\n  const { origin } = new URL(url);\r\n\r\n  if (originIsHubsServer.has(origin)) {\r\n    return originIsHubsServer.get(origin);\r\n  }\r\n\r\n  let isHubsServer;\r\n  try {\r\n    isHubsServer = (await fetch(proxiedUrlFor(origin), { method: \"HEAD\" })).headers.has(\"hub-name\");\r\n  } catch (e) {\r\n    isHubsServer = false;\r\n  }\r\n  originIsHubsServer.set(origin, isHubsServer);\r\n  return isHubsServer;\r\n}\r\n\r\nconst hubsSceneRegex = /https?:\\/\\/[^/]+\\/scenes\\/(\\w+)\\/?\\S*/;\r\nconst hubsAvatarRegex = /https?:\\/\\/[^/]+\\/avatars\\/(?<id>\\w+)\\/?\\S*/;\r\nconst hubsRoomRegex = /(https?:\\/\\/)?[^/]+\\/([a-zA-Z0-9]{7})\\/?\\S*/;\r\n\r\nexport const isLocalHubsUrl = async url =>\r\n  (await isHubsServer(url)) && new URL(url).origin === document.location.origin;\r\n\r\nexport const isHubsSceneUrl = async url => (await isHubsServer(url)) && hubsSceneRegex.test(url);\r\nexport const isLocalHubsSceneUrl = async url => (await isHubsSceneUrl(url)) && (await isLocalHubsUrl(url));\r\n\r\nexport const isHubsAvatarUrl = async url => (await isHubsServer(url)) && hubsAvatarRegex.test(url);\r\nexport const isLocalHubsAvatarUrl = async url => (await isHubsAvatarUrl(url)) && (await isLocalHubsUrl(url));\r\n\r\nexport const isHubsRoomUrl = async url =>\r\n  (await isHubsServer(url)) && !(await isHubsAvatarUrl(url)) && !(await isHubsSceneUrl(url)) && hubsRoomRegex.test(url);\r\n\r\nexport const isHubsDestinationUrl = async url =>\r\n  (await isHubsServer(url)) && ((await isHubsSceneUrl(url)) || (await isHubsRoomUrl(url)));\r\n\r\nexport const idForAvatarUrl = url => {\r\n  const match = url.match(hubsAvatarRegex);\r\n  if (match) {\r\n    return match.groups.id;\r\n  }\r\n  return null;\r\n};\r\n","import \"./webxr-bypass-hacks\";\r\n// We should technically be able to just include three here, but our dependancies are tangled such that not having aframe is a bit difficult\r\nimport \"./utils/theme\";\r\nconsole.log(`Hubs version: ${process.env.BUILD_VERSION || \"?\"}`);\r\n\r\nimport \"aframe\";\r\nimport \"./utils/logging\";\r\n\r\nimport ReactDOM from \"react-dom\";\r\nimport React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport classNames from \"classnames\";\r\nimport { IntlProvider, FormattedMessage, addLocaleData } from \"react-intl\";\r\nimport en from \"react-intl/locale-data/en\";\r\n\r\nimport configs from \"./utils/configs\";\r\nimport { lang, messages } from \"./utils/i18n\";\r\naddLocaleData([...en]);\r\n\r\nimport { disableiOSZoom } from \"./utils/disable-ios-zoom\";\r\ndisableiOSZoom();\r\n\r\nimport { App } from \"./App\";\r\n\r\nimport AvatarPreview from \"./react-components/avatar-preview\";\r\n\r\nimport { fetchAvatar, remixAvatar } from \"./utils/avatar-utils\";\r\n\r\nimport styles from \"./assets/stylesheets/avatar.scss\";\r\n\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faClone } from \"@fortawesome/free-solid-svg-icons/faClone\";\r\n\r\nconst qs = new URLSearchParams(location.search);\r\nwindow.APP = new App();\r\n\r\nclass AvatarUI extends React.Component {\r\n  static propTypes = {\r\n    avatarId: PropTypes.string,\r\n    store: PropTypes.object,\r\n    intl: PropTypes.object\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { copyMessage: null };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.store.addEventListener(\"statechanged\", this.storeUpdated);\r\n    this.refetchAvatar();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.store.removeEventListener(\"statechanged\", this.storeUpdated);\r\n  }\r\n\r\n  storeUpdated = () => this.forceUpdate();\r\n\r\n  refetchAvatar = async () => {\r\n    const avatar = await fetchAvatar(this.props.avatarId);\r\n    this.setState({ avatar });\r\n  };\r\n\r\n  setAvatar = e => {\r\n    e && e.preventDefault();\r\n    this.props.store.update({\r\n      profile: { avatarId: this.state.avatar.avatar_id }\r\n    });\r\n  };\r\n\r\n  handleCopyAvatar = async e => {\r\n    e.preventDefault();\r\n    const { avatar } = this.state;\r\n    this.setState({ copyMessage: \"copying...\" });\r\n    await remixAvatar(avatar.avatar_id, avatar.name);\r\n    this.setState({ copyMessage: \"Copied!\" });\r\n    setTimeout(() => this.setState({ copyMessage: null }), 2000);\r\n  };\r\n\r\n  render() {\r\n    const { avatar, copyMessage } = this.state;\r\n    if (!avatar) {\r\n      return (\r\n        <div className={styles.avatarLanding}>\r\n          <div className={classNames([styles.box, styles.darkened])}>Loading</div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    const selectedAvatarId = this.props.store.state.profile.avatarId;\r\n    const isSelected = avatar.avatar_id === selectedAvatarId;\r\n\r\n    return (\r\n      <form onSubmit={this.setAvatar} className={styles.avatarLanding}>\r\n        <div className={classNames([styles.box, styles.darkened])}>\r\n          <label className={styles.title}>\r\n            <span>{avatar.name}</span>\r\n          </label>\r\n          <div className={styles.attributions}>\r\n            {avatar.attributions && avatar.attributions.creator && <span>{`by ${avatar.attributions.creator}`}</span>}\r\n          </div>\r\n          <div className={styles.preview}>\r\n            {avatar && <AvatarPreview avatarGltfUrl={avatar.gltf_url} />}\r\n            {copyMessage ? (\r\n              <div className={styles.copyTip}>{copyMessage}</div>\r\n            ) : (\r\n              avatar &&\r\n              avatar.type === \"avatar_listing\" &&\r\n              avatar.allow_remixing && (\r\n                <a className={styles.editAvatar} onClick={this.handleCopyAvatar} title=\"Copy to my avatars\">\r\n                  <FontAwesomeIcon icon={faClone} />\r\n                </a>\r\n              )\r\n            )}\r\n          </div>\r\n          {isSelected ? (\r\n            <span className={styles.selectedMessage}>\r\n              <FormattedMessage id=\"avatar-landing.selected\" />\r\n            </span>\r\n          ) : (\r\n            <button disabled={isSelected} className={styles.formSubmit} type=\"submit\">\r\n              <FormattedMessage id=\"avatar-landing.select\" />\r\n            </button>\r\n          )}\r\n        </div>\r\n        <img className={styles.logo} src={configs.image(\"logo\")} />\r\n      </form>\r\n    );\r\n  }\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const avatarId = qs.get(\"avatar_id\") || document.location.pathname.substring(1).split(\"/\")[1];\r\n  console.log(`Avatar ID: ${avatarId}`);\r\n  ReactDOM.render(\r\n    <IntlProvider locale={lang} messages={messages}>\r\n      <AvatarUI avatarId={avatarId} store={window.APP.store} />\r\n    </IntlProvider>,\r\n    document.getElementById(\"ui-root\")\r\n  );\r\n});\r\n","import { detectOS } from \"detect-browser\";\r\n\r\nexport function disableiOSZoom() {\r\n  if (detectOS(navigator.userAgent) !== \"iOS\") return;\r\n\r\n  let lastTouchAtMs = 0;\r\n\r\n  document.addEventListener(\"touchmove\", ev => {\r\n    if (ev.scale === 1) return;\r\n\r\n    ev.preventDefault();\r\n  });\r\n\r\n  document.addEventListener(\"touchend\", ev => {\r\n    const now = new Date().getTime();\r\n    const isDoubleTouch = now - lastTouchAtMs <= 300;\r\n    lastTouchAtMs = now;\r\n\r\n    if (isDoubleTouch) {\r\n      ev.preventDefault();\r\n    }\r\n  });\r\n}\r\n","export const waitForEvent = function(eventName, eventObj) {\r\n  return new Promise(resolve => {\r\n    eventObj.addEventListener(eventName, resolve, { once: true });\r\n  });\r\n};\r\n\r\nexport const waitForDOMContentLoaded = function() {\r\n  if (document.readyState === \"complete\" || document.readyState === \"loaded\" || document.readyState === \"interactive\") {\r\n    return Promise.resolve(null);\r\n  } else {\r\n    return waitForEvent(\"DOMContentLoaded\", window);\r\n  }\r\n};\r\n","import configs from \"./configs\";\r\nimport localeData from \"../assets/translations.data.json\";\r\n\r\nconst navigatorLang = ((navigator.languages && navigator.languages[0]) || navigator.language || navigator.userLanguage)\r\n  .toLowerCase()\r\n  .split(/[_-]+/)[0];\r\nexport const lang = (localeData[navigatorLang] && navigatorLang) || \"en\";\r\n\r\nconst _messages = localeData[lang] || localeData.en;\r\n\r\nif (configs.APP_CONFIG && configs.APP_CONFIG.translations && configs.APP_CONFIG.translations[lang]) {\r\n  const configTranslations = configs.APP_CONFIG.translations[lang];\r\n  for (const messageKey in configTranslations) {\r\n    if (!configTranslations.hasOwnProperty(messageKey)) continue;\r\n    if (!configTranslations[messageKey]) continue;\r\n    _messages[messageKey] = configTranslations[messageKey];\r\n  }\r\n}\r\n\r\nexport const messages = Object.entries(_messages)\r\n  .map(([key, message]) => [\r\n    key,\r\n    // Replace nested message keys (e.g. %app-name%) with their messages.\r\n    message.replace(/%([\\w-.]+)%/i, (_match, subkey) => _messages[subkey])\r\n  ])\r\n  .reduce((acc, entry) => {\r\n    acc[entry[0]] = entry[1];\r\n    return acc;\r\n  }, {});\r\n","function loadAsync(loader, url, onProgress) {\r\n  return new Promise((resolve, reject) => loader.load(url, resolve, onProgress, reject));\r\n}\r\n\r\nexport default class HubsTextureLoader {\r\n  static crossOrigin = \"anonymous\";\r\n\r\n  constructor(manager = THREE.DefaultLoadingManager) {\r\n    this.manager = manager;\r\n  }\r\n\r\n  load(url, onLoad, onProgress, onError) {\r\n    const texture = new THREE.Texture();\r\n\r\n    this.loadTextureAsync(texture, url, onProgress)\r\n      .then(onLoad)\r\n      .catch(onError);\r\n\r\n    return texture;\r\n  }\r\n\r\n  async loadTextureAsync(texture, src, onProgress) {\r\n    let imageLoader;\r\n\r\n    if (window.createImageBitmap !== undefined) {\r\n      imageLoader = new THREE.ImageBitmapLoader(this.manager);\r\n      texture.flipY = false;\r\n    } else {\r\n      imageLoader = new THREE.ImageLoader(this.manager);\r\n    }\r\n\r\n    imageLoader.setCrossOrigin(this.crossOrigin);\r\n    imageLoader.setPath(this.path);\r\n\r\n    const cacheKey = this.manager.resolveURL(src);\r\n\r\n    texture.image = await loadAsync(imageLoader, src, onProgress);\r\n\r\n    // Image was just added to cache before this function gets called, disable caching by immediatly removing it\r\n    THREE.Cache.remove(cacheKey);\r\n\r\n    texture.needsUpdate = true;\r\n\r\n    texture.onUpdate = function() {\r\n      // Delete texture data once it has been uploaded to the GPU\r\n      texture.image.close && texture.image.close();\r\n      delete texture.image;\r\n    };\r\n\r\n    return texture;\r\n  }\r\n\r\n  setCrossOrigin(value) {\r\n    this.crossOrigin = value;\r\n    return this;\r\n  }\r\n\r\n  setPath(value) {\r\n    this.path = value;\r\n    return this;\r\n  }\r\n}\r\n","/* eslint-disable */\r\n\r\nimport transcoderWasmFile from \"./basis_transcoder.wasm\";\r\nimport BasisWorker from \"./basis_transcoder.worker.js\";\r\n\r\n/**\r\n * @author Don McCurdy / https://www.donmccurdy.com\r\n * @author Austin Eng / https://github.com/austinEng\r\n * @author Shrek Shao / https://github.com/shrekshao\r\n */\r\n\r\n/**\r\n * Loader for Basis Universal GPU Texture Codec.\r\n *\r\n * Basis Universal is a \"supercompressed\" GPU texture and texture video\r\n * compression system that outputs a highly compressed intermediate file format\r\n * (.basis) that can be quickly transcoded to a wide variety of GPU texture\r\n * compression formats.\r\n *\r\n * This loader parallelizes the transcoding process across a configurable number\r\n * of web workers, before transferring the transcoded compressed texture back\r\n * to the main thread.\r\n */\r\n\r\nTHREE.BasisTextureLoader = function(manager) {\r\n  THREE.Loader.call(this, manager);\r\n\r\n  this.transcoderPath = \"\";\r\n  this.transcoderBinary = null;\r\n  this.transcoderPending = null;\r\n\r\n  this.workerLimit = 4;\r\n  this.workerPool = [];\r\n  this.workerNextTaskID = 1;\r\n  this.workerConfig = {\r\n    format: null,\r\n    astcSupported: false,\r\n    etcSupported: false,\r\n    dxtSupported: false,\r\n    pvrtcSupported: false,\r\n    returnBuffer: false\r\n  };\r\n};\r\n\r\nTHREE.BasisTextureLoader.prototype = Object.assign(Object.create(THREE.Loader.prototype), {\r\n  constructor: THREE.BasisTextureLoader,\r\n\r\n  setTranscoderPath: function(path) {\r\n    this.transcoderPath = path;\r\n\r\n    return this;\r\n  },\r\n\r\n  setWorkerLimit: function(workerLimit) {\r\n    this.workerLimit = workerLimit;\r\n\r\n    return this;\r\n  },\r\n\r\n  detectSupport: function(renderer) {\r\n    var config = this.workerConfig;\r\n\r\n    config.astcSupported = !!renderer.extensions.get(\"WEBGL_compressed_texture_astc\");\r\n    config.etcSupported = !!renderer.extensions.get(\"WEBGL_compressed_texture_etc1\");\r\n    config.dxtSupported = !!renderer.extensions.get(\"WEBGL_compressed_texture_s3tc\");\r\n    config.pvrtcSupported =\r\n      !!renderer.extensions.get(\"WEBGL_compressed_texture_pvrtc\") ||\r\n      !!renderer.extensions.get(\"WEBKIT_WEBGL_compressed_texture_pvrtc\");\r\n\r\n    if (config.astcSupported) {\r\n      config.format = THREE.BasisTextureLoader.BASIS_FORMAT.cTFASTC_4x4;\r\n    } else if (config.dxtSupported) {\r\n      config.format = THREE.BasisTextureLoader.BASIS_FORMAT.cTFBC3;\r\n    } else if (config.pvrtcSupported) {\r\n      config.format = THREE.BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGBA;\r\n    } else if (config.etcSupported) {\r\n      config.format = THREE.BasisTextureLoader.BASIS_FORMAT.cTFETC1;\r\n    } else {\r\n      throw new Error(\"THREE.BasisTextureLoader: No suitable compressed texture format found.\");\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n    var loader = new THREE.FileLoader(this.manager);\r\n\r\n    if (!this.ranDetect) {\r\n      this.detectSupport(AFRAME.scenes[0].renderer);\r\n      this.ranDetect = true;\r\n    }\r\n\r\n    loader.setResponseType(\"arraybuffer\");\r\n\r\n    loader.load(\r\n      url,\r\n      buffer => {\r\n        this._createTexture(buffer)\r\n          .then(onLoad)\r\n          .catch(onError);\r\n      },\r\n      onProgress,\r\n      onError\r\n    );\r\n  },\r\n\r\n  /**\r\n   * @param  {ArrayBuffer} buffer\r\n   * @return {Promise<THREE.CompressedTexture>}\r\n   */\r\n  _createTexture: function(buffer) {\r\n    var worker;\r\n    var taskID;\r\n\r\n    var texturePending = this._getWorker()\r\n      .then(_worker => {\r\n        worker = _worker;\r\n        taskID = this.workerNextTaskID++;\r\n\r\n        return new Promise((resolve, reject) => {\r\n          worker._callbacks[taskID] = { resolve, reject };\r\n          worker._taskCosts[taskID] = buffer.byteLength;\r\n          worker._taskLoad += worker._taskCosts[taskID];\r\n\r\n          worker.postMessage({ type: \"transcode\", id: taskID, buffer }, [buffer]);\r\n        });\r\n      })\r\n      .then(message => {\r\n        var config = this.workerConfig;\r\n\r\n        var { width, height, mipmaps, format, hasAlpha, buffer } = message;\r\n\r\n        var texture;\r\n\r\n        switch (format) {\r\n          case THREE.BasisTextureLoader.BASIS_FORMAT.cTFASTC_4x4:\r\n            texture = new THREE.CompressedTexture(mipmaps, width, height, THREE.RGBA_ASTC_4x4_Format);\r\n            break;\r\n          case THREE.BasisTextureLoader.BASIS_FORMAT.cTFBC1:\r\n          case THREE.BasisTextureLoader.BASIS_FORMAT.cTFBC3:\r\n            texture = new THREE.CompressedTexture(\r\n              mipmaps,\r\n              width,\r\n              height,\r\n              THREE.BasisTextureLoader.DXT_FORMAT_MAP[config.format],\r\n              THREE.UnsignedByteType\r\n            );\r\n            break;\r\n          case THREE.BasisTextureLoader.BASIS_FORMAT.cTFETC1:\r\n            texture = new THREE.CompressedTexture(mipmaps, width, height, THREE.RGB_ETC1_Format);\r\n            break;\r\n          case THREE.BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGB:\r\n            texture = new THREE.CompressedTexture(mipmaps, width, height, THREE.RGB_PVRTC_4BPPV1_Format);\r\n            break;\r\n          case THREE.BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGBA:\r\n            texture = new THREE.CompressedTexture(mipmaps, width, height, THREE.RGBA_PVRTC_4BPPV1_Format);\r\n            break;\r\n          default:\r\n            throw new Error(\"THREE.BasisTextureLoader: No supported format available.\");\r\n        }\r\n\r\n        texture.minFilter = mipmaps.length === 1 ? THREE.LinearFilter : THREE.LinearMipmapLinearFilter;\r\n        texture.magFilter = THREE.LinearFilter;\r\n        texture.generateMipmaps = false;\r\n        texture.needsUpdate = true;\r\n\r\n        texture.image.hasAlpha = hasAlpha;\r\n        if (this.workerConfig.returnBuffer) {\r\n          texture.image.data = buffer;\r\n        }\r\n\r\n        return texture;\r\n      });\r\n\r\n    texturePending.finally(() => {\r\n      if (worker && taskID) {\r\n        worker._taskLoad -= worker._taskCosts[taskID];\r\n        delete worker._callbacks[taskID];\r\n        delete worker._taskCosts[taskID];\r\n      }\r\n    });\r\n\r\n    return texturePending;\r\n  },\r\n\r\n  _initTranscoder: function() {\r\n    if (!this.transcoderBinary) {\r\n      // Load transcoder WASM binary.\r\n      var binaryLoader = new THREE.FileLoader(this.manager);\r\n      binaryLoader.setPath(this.transcoderPath);\r\n      binaryLoader.setResponseType(\"arraybuffer\");\r\n      var binaryContent = new Promise((resolve, reject) => {\r\n        binaryLoader.load(transcoderWasmFile, resolve, undefined, reject);\r\n      });\r\n\r\n      this.transcoderPending = binaryContent.then(binaryContent => {\r\n        this.transcoderBinary = binaryContent;\r\n      });\r\n    }\r\n\r\n    return this.transcoderPending;\r\n  },\r\n\r\n  _getWorker: function() {\r\n    return this._initTranscoder().then(() => {\r\n      if (this.workerPool.length < this.workerLimit) {\r\n        var worker = new BasisWorker();\r\n\r\n        worker._callbacks = {};\r\n        worker._taskCosts = {};\r\n        worker._taskLoad = 0;\r\n\r\n        worker.postMessage({\r\n          type: \"init\",\r\n          config: this.workerConfig,\r\n          transcoderBinary: this.transcoderBinary\r\n        });\r\n\r\n        worker.onmessage = function(e) {\r\n          var message = e.data;\r\n\r\n          switch (message.type) {\r\n            case \"transcode\":\r\n              worker._callbacks[message.id].resolve(message);\r\n              break;\r\n\r\n            case \"error\":\r\n              worker._callbacks[message.id].reject(message);\r\n              break;\r\n\r\n            default:\r\n              console.error('THREE.BasisTextureLoader: Unexpected message, \"' + message.type + '\"');\r\n          }\r\n        };\r\n\r\n        this.workerPool.push(worker);\r\n      } else {\r\n        this.workerPool.sort(function(a, b) {\r\n          return a._taskLoad > b._taskLoad ? -1 : 1;\r\n        });\r\n      }\r\n\r\n      return this.workerPool[this.workerPool.length - 1];\r\n    });\r\n  },\r\n\r\n  dispose: function() {\r\n    for (var i = 0; i < this.workerPool.length; i++) {\r\n      this.workerPool[i].terminate();\r\n    }\r\n\r\n    this.workerPool.length = 0;\r\n\r\n    return this;\r\n  }\r\n});\r\n\r\n/* CONSTANTS */\r\n\r\nTHREE.BasisTextureLoader.BASIS_FORMAT = {\r\n  cTFETC1: 0,\r\n  cTFETC2: 1,\r\n  cTFBC1: 2,\r\n  cTFBC3: 3,\r\n  cTFBC4: 4,\r\n  cTFBC5: 5,\r\n  cTFBC7_M6_OPAQUE_ONLY: 6,\r\n  cTFBC7_M5: 7,\r\n  cTFPVRTC1_4_RGB: 8,\r\n  cTFPVRTC1_4_RGBA: 9,\r\n  cTFASTC_4x4: 10,\r\n  cTFATC_RGB: 11,\r\n  cTFATC_RGBA_INTERPOLATED_ALPHA: 12,\r\n  cTFRGBA32: 13,\r\n  cTFRGB565: 14,\r\n  cTFBGR565: 15,\r\n  cTFRGBA4444: 16\r\n};\r\n\r\n// DXT formats, from:\r\n// http://www.khronos.org/registry/webgl/extensions/WEBGL_compressed_texture_s3tc/\r\nTHREE.BasisTextureLoader.DXT_FORMAT = {\r\n  COMPRESSED_RGB_S3TC_DXT1_EXT: 0x83f0,\r\n  COMPRESSED_RGBA_S3TC_DXT1_EXT: 0x83f1,\r\n  COMPRESSED_RGBA_S3TC_DXT3_EXT: 0x83f2,\r\n  COMPRESSED_RGBA_S3TC_DXT5_EXT: 0x83f3\r\n};\r\nTHREE.BasisTextureLoader.DXT_FORMAT_MAP = {};\r\nTHREE.BasisTextureLoader.DXT_FORMAT_MAP[THREE.BasisTextureLoader.BASIS_FORMAT.cTFBC1] =\r\n  THREE.BasisTextureLoader.DXT_FORMAT.COMPRESSED_RGB_S3TC_DXT1_EXT;\r\nTHREE.BasisTextureLoader.DXT_FORMAT_MAP[THREE.BasisTextureLoader.BASIS_FORMAT.cTFBC3] =\r\n  THREE.BasisTextureLoader.DXT_FORMAT.COMPRESSED_RGBA_S3TC_DXT5_EXT;\r\n\r\nexport default THREE.BasisTextureLoader;\r\n","import { objectTypeForOriginAndContentType } from \"../object-types\";\r\nimport { getReticulumFetchUrl, getDirectReticulumFetchUrl } from \"./phoenix-utils\";\r\nimport { ObjectContentOrigins } from \"../object-types\";\r\nimport mediaHighlightFrag from \"./media-highlight-frag.glsl\";\r\nimport { mapMaterials } from \"./material-utils\";\r\nimport HubsTextureLoader from \"../loaders/HubsTextureLoader\";\r\nimport { validMaterials } from \"../components/hoverable-visuals\";\r\nimport { proxiedUrlFor, guessContentType } from \"../utils/media-url-utils\";\r\nimport Linkify from \"linkify-it\";\r\nimport tlds from \"tlds\";\r\n\r\nimport anime from \"animejs\";\r\n\r\nconst linkify = Linkify();\r\nlinkify.tlds(tlds);\r\n\r\nconst mediaAPIEndpoint = getReticulumFetchUrl(\"/api/v1/media\");\r\nconst getDirectMediaAPIEndpoint = () => getDirectReticulumFetchUrl(\"/api/v1/media\");\r\n\r\nconst isMobile = AFRAME.utils.device.isMobile();\r\nconst isMobileVR = AFRAME.utils.device.isMobile();\r\n\r\n// Map<String, Promise<Object>\r\nconst resolveUrlCache = new Map();\r\nexport const getDefaultResolveQuality = (is360 = false) => {\r\n  const useLowerQuality = isMobile || isMobileVR;\r\n  return !is360 ? (useLowerQuality ? \"low\" : \"high\") : useLowerQuality ? \"low_360\" : \"high_360\";\r\n};\r\n\r\nexport const resolveUrl = async (url, quality = null, version = 1, bustCache) => {\r\n  const key = `${url}_${version}`;\r\n  if (!bustCache && resolveUrlCache.has(key)) return resolveUrlCache.get(key);\r\n\r\n  const resultPromise = fetch(mediaAPIEndpoint, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ media: { url, quality: quality || getDefaultResolveQuality() }, version })\r\n  }).then(async response => {\r\n    if (!response.ok) {\r\n      const message = `Error resolving url \"${url}\":`;\r\n      try {\r\n        const body = await response.text();\r\n        throw new Error(message + \" \" + body);\r\n      } catch (e) {\r\n        throw new Error(message + \" \" + response.statusText);\r\n      }\r\n    }\r\n    return response.json();\r\n  });\r\n\r\n  resolveUrlCache.set(key, resultPromise);\r\n  return resultPromise;\r\n};\r\n\r\nexport const upload = (file, desiredContentType) => {\r\n  const formData = new FormData();\r\n  formData.append(\"media\", file);\r\n  formData.append(\"promotion_mode\", \"with_token\");\r\n\r\n  if (desiredContentType) {\r\n    formData.append(\"desired_content_type\", desiredContentType);\r\n  }\r\n\r\n  // To eliminate the extra hop and avoid proxy timeouts, upload files directly\r\n  // to a reticulum host.\r\n  return fetch(getDirectMediaAPIEndpoint(), {\r\n    method: \"POST\",\r\n    body: formData\r\n  }).then(r => r.json());\r\n};\r\n\r\n// https://stackoverflow.com/questions/7584794/accessing-jpeg-exif-rotation-data-in-javascript-on-the-client-side/32490603#32490603\r\nfunction getOrientation(file, callback) {\r\n  const reader = new FileReader();\r\n  reader.onload = function(e) {\r\n    const view = new DataView(e.target.result);\r\n    if (view.getUint16(0, false) != 0xffd8) {\r\n      return callback(-2);\r\n    }\r\n    const length = view.byteLength;\r\n    let offset = 2;\r\n    while (offset < length) {\r\n      if (view.getUint16(offset + 2, false) <= 8) return callback(-1);\r\n      const marker = view.getUint16(offset, false);\r\n      offset += 2;\r\n      if (marker == 0xffe1) {\r\n        if (view.getUint32((offset += 2), false) != 0x45786966) {\r\n          return callback(-1);\r\n        }\r\n\r\n        const little = view.getUint16((offset += 6), false) == 0x4949;\r\n        offset += view.getUint32(offset + 4, little);\r\n        const tags = view.getUint16(offset, little);\r\n        offset += 2;\r\n        for (let i = 0; i < tags; i++) {\r\n          if (view.getUint16(offset + i * 12, little) == 0x0112) {\r\n            return callback(view.getUint16(offset + i * 12 + 8, little));\r\n          }\r\n        }\r\n      } else if ((marker & 0xff00) != 0xff00) {\r\n        break;\r\n      } else {\r\n        offset += view.getUint16(offset, false);\r\n      }\r\n    }\r\n    return callback(-1);\r\n  };\r\n  reader.readAsArrayBuffer(file);\r\n}\r\n\r\nfunction getLatestMediaVersionOfSrc(src) {\r\n  const els = document.querySelectorAll(\"[media-loader]\");\r\n  let version = 1;\r\n\r\n  for (const el of els) {\r\n    const loader = el.components[\"media-loader\"];\r\n\r\n    if (loader.data && loader.data.src === src) {\r\n      version = Math.max(version, loader.data.version);\r\n    }\r\n  }\r\n\r\n  return version;\r\n}\r\n\r\nexport function coerceToUrl(urlOrText) {\r\n  if (!linkify.test(urlOrText)) return urlOrText;\r\n\r\n  // See: https://github.com/Soapbox/linkifyjs/blob/master/src/linkify.js#L52\r\n  return urlOrText.indexOf(\"://\") >= 0 ? urlOrText : `https://${urlOrText}`;\r\n}\r\n\r\nexport const addMedia = (\r\n  src,\r\n  template,\r\n  contentOrigin,\r\n  contentSubtype = null,\r\n  resolve = false,\r\n  fitToBox = false,\r\n  animate = true,\r\n  mediaOptions = {},\r\n  networked = true,\r\n  parentEl = null,\r\n  linkedEl = null\r\n) => {\r\n  const scene = AFRAME.scenes[0];\r\n\r\n  const entity = document.createElement(\"a-entity\");\r\n\r\n  if (networked) {\r\n    entity.setAttribute(\"networked\", { template: template });\r\n  } else {\r\n    const templateBody = document\r\n      .importNode(document.body.querySelector(template).content, true)\r\n      .firstElementChild.cloneNode(true);\r\n    const elAttrs = templateBody.attributes;\r\n\r\n    // Merge root element attributes with this entity\r\n    for (let attrIdx = 0; attrIdx < elAttrs.length; attrIdx++) {\r\n      entity.setAttribute(elAttrs[attrIdx].name, elAttrs[attrIdx].value);\r\n    }\r\n\r\n    // Append all child elements\r\n    while (templateBody.firstElementChild) {\r\n      entity.appendChild(templateBody.firstElementChild);\r\n    }\r\n  }\r\n\r\n  const needsToBeUploaded = src instanceof File;\r\n\r\n  // If we're re-pasting an existing src in the scene, we should use the latest version\r\n  // seen across any other entities. Otherwise, start with version 1.\r\n  const version = getLatestMediaVersionOfSrc(src);\r\n\r\n  entity.setAttribute(\"media-loader\", {\r\n    fitToBox,\r\n    resolve,\r\n    animate,\r\n    src: typeof src === \"string\" ? coerceToUrl(src) || src : \"\",\r\n    version,\r\n    contentSubtype,\r\n    fileIsOwned: !needsToBeUploaded,\r\n    linkedEl,\r\n    mediaOptions\r\n  });\r\n\r\n  entity.object3D.matrixNeedsUpdate = true;\r\n\r\n  (parentEl || scene).appendChild(entity);\r\n\r\n  const orientation = new Promise(function(resolve) {\r\n    if (needsToBeUploaded) {\r\n      getOrientation(src, x => {\r\n        resolve(x);\r\n      });\r\n    } else {\r\n      resolve(1);\r\n    }\r\n  });\r\n  if (needsToBeUploaded) {\r\n    // Video camera videos are converted to mp4 for compatibility\r\n    const desiredContentType = contentSubtype === \"video-camera\" ? \"video/mp4\" : src.type || guessContentType(src.name);\r\n\r\n    upload(src, desiredContentType)\r\n      .then(response => {\r\n        const srcUrl = new URL(proxiedUrlFor(response.origin));\r\n        srcUrl.searchParams.set(\"token\", response.meta.access_token);\r\n        entity.setAttribute(\"media-loader\", { resolve: false, src: srcUrl.href, fileId: response.file_id });\r\n        window.APP.store.update({\r\n          uploadPromotionTokens: [{ fileId: response.file_id, promotionToken: response.meta.promotion_token }]\r\n        });\r\n      })\r\n      .catch(e => {\r\n        console.error(\"Media upload failed\", e);\r\n        entity.setAttribute(\"media-loader\", { src: \"error\" });\r\n      });\r\n  } else if (src instanceof MediaStream) {\r\n    entity.setAttribute(\"media-loader\", { src: `hubs://clients/${NAF.clientId}/video` });\r\n  }\r\n\r\n  if (contentOrigin) {\r\n    entity.addEventListener(\"media_resolved\", ({ detail }) => {\r\n      const objectType = objectTypeForOriginAndContentType(contentOrigin, detail.contentType, detail.src);\r\n      scene.emit(\"object_spawned\", { objectType });\r\n    });\r\n  }\r\n\r\n  return { entity, orientation };\r\n};\r\n\r\nexport const cloneMedia = (sourceEl, template, src = null, networked = true, link = false, parentEl = null) => {\r\n  if (!src) {\r\n    ({ src } = sourceEl.components[\"media-loader\"].data);\r\n  }\r\n\r\n  const { contentSubtype, fitToBox, mediaOptions } = sourceEl.components[\"media-loader\"].data;\r\n\r\n  return addMedia(\r\n    src,\r\n    template,\r\n    ObjectContentOrigins.URL,\r\n    contentSubtype,\r\n    true,\r\n    fitToBox,\r\n    false,\r\n    mediaOptions,\r\n    networked,\r\n    parentEl,\r\n    link ? sourceEl : null\r\n  );\r\n};\r\n\r\nexport function injectCustomShaderChunks(obj) {\r\n  const vertexRegex = /\\bskinning_vertex\\b/;\r\n  const fragRegex = /\\bgl_FragColor\\b/;\r\n\r\n  const shaderUniforms = [];\r\n  const batchManagerSystem = AFRAME.scenes[0].systems[\"hubs-systems\"].batchManagerSystem;\r\n\r\n  obj.traverse(object => {\r\n    if (!object.material) return;\r\n\r\n    object.material = mapMaterials(object, material => {\r\n      if (material.hubs_InjectedCustomShaderChunks) return material;\r\n      if (!validMaterials.includes(material.type)) {\r\n        return material;\r\n      }\r\n\r\n      // HACK, this routine inadvertently leaves the A-Frame shaders wired to the old, dark\r\n      // material, so maps cannot be updated at runtime. This breaks UI elements who have\r\n      // hover/toggle state, so for now just skip these while we figure out a more correct\r\n      // solution.\r\n      if (\r\n        object.el.classList.contains(\"ui\") ||\r\n        object.el.classList.contains(\"hud\") ||\r\n        object.el.getAttribute(\"text-button\")\r\n      )\r\n        return material;\r\n\r\n      // Used when the object is batched\r\n      if (batchManagerSystem.batchingEnabled) {\r\n        batchManagerSystem.meshToEl.set(object, obj.el);\r\n      }\r\n\r\n      const newMaterial = material.clone();\r\n      // This will not run if the object is never rendered unbatched, since its unbatched shader will never be compiled\r\n      newMaterial.onBeforeCompile = shader => {\r\n        if (!vertexRegex.test(shader.vertexShader)) return;\r\n\r\n        shader.uniforms.hubs_IsFrozen = { value: false };\r\n        shader.uniforms.hubs_EnableSweepingEffect = { value: false };\r\n        shader.uniforms.hubs_SweepParams = { value: [0, 0] };\r\n        shader.uniforms.hubs_InteractorOnePos = { value: [0, 0, 0] };\r\n        shader.uniforms.hubs_InteractorTwoPos = { value: [0, 0, 0] };\r\n        shader.uniforms.hubs_HighlightInteractorOne = { value: false };\r\n        shader.uniforms.hubs_HighlightInteractorTwo = { value: false };\r\n        shader.uniforms.hubs_Time = { value: 0 };\r\n\r\n        const vchunk = `\r\n        if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\r\n          vec4 wt = modelMatrix * vec4(transformed, 1);\r\n\r\n          // Used in the fragment shader below.\r\n          hubs_WorldPosition = wt.xyz;\r\n        }\r\n        `;\r\n\r\n        const vlines = shader.vertexShader.split(\"\\n\");\r\n        const vindex = vlines.findIndex(line => vertexRegex.test(line));\r\n        vlines.splice(vindex + 1, 0, vchunk);\r\n        vlines.unshift(\"varying vec3 hubs_WorldPosition;\");\r\n        vlines.unshift(\"uniform bool hubs_IsFrozen;\");\r\n        vlines.unshift(\"uniform bool hubs_HighlightInteractorOne;\");\r\n        vlines.unshift(\"uniform bool hubs_HighlightInteractorTwo;\");\r\n        shader.vertexShader = vlines.join(\"\\n\");\r\n\r\n        const flines = shader.fragmentShader.split(\"\\n\");\r\n        const findex = flines.findIndex(line => fragRegex.test(line));\r\n        flines.splice(findex + 1, 0, mediaHighlightFrag);\r\n        flines.unshift(\"varying vec3 hubs_WorldPosition;\");\r\n        flines.unshift(\"uniform bool hubs_IsFrozen;\");\r\n        flines.unshift(\"uniform bool hubs_EnableSweepingEffect;\");\r\n        flines.unshift(\"uniform vec2 hubs_SweepParams;\");\r\n        flines.unshift(\"uniform bool hubs_HighlightInteractorOne;\");\r\n        flines.unshift(\"uniform vec3 hubs_InteractorOnePos;\");\r\n        flines.unshift(\"uniform bool hubs_HighlightInteractorTwo;\");\r\n        flines.unshift(\"uniform vec3 hubs_InteractorTwoPos;\");\r\n        flines.unshift(\"uniform float hubs_Time;\");\r\n        shader.fragmentShader = flines.join(\"\\n\");\r\n\r\n        shaderUniforms.push(shader.uniforms);\r\n      };\r\n      newMaterial.needsUpdate = true;\r\n      newMaterial.hubs_InjectedCustomShaderChunks = true;\r\n      return newMaterial;\r\n    });\r\n  });\r\n\r\n  return shaderUniforms;\r\n}\r\n\r\nexport function getPromotionTokenForFile(fileId) {\r\n  return window.APP.store.state.uploadPromotionTokens.find(upload => upload.fileId === fileId);\r\n}\r\n\r\nconst mediaPos = new THREE.Vector3();\r\n\r\nexport function addAndArrangeMedia(el, media, contentSubtype, snapCount, mirrorOrientation = false, distance = 0.75) {\r\n  const { entity, orientation } = addMedia(media, \"#interactable-media\", undefined, contentSubtype, false);\r\n\r\n  const pos = el.object3D.position;\r\n\r\n  entity.object3D.position.set(pos.x, pos.y, pos.z);\r\n  entity.object3D.rotation.copy(el.object3D.rotation);\r\n\r\n  if (mirrorOrientation) {\r\n    entity.object3D.rotateY(Math.PI);\r\n  }\r\n\r\n  // Generate photos in a circle around camera, starting from the bottom.\r\n  // Prevent z-fighting but place behind viewfinder\r\n  const idx = (snapCount % 6) + 3;\r\n\r\n  mediaPos.set(\r\n    Math.cos(Math.PI * 2 * (idx / 6.0)) * distance,\r\n    Math.sin(Math.PI * 2 * (idx / 6.0)) * distance,\r\n    -0.05 + idx * 0.001\r\n  );\r\n\r\n  el.object3D.localToWorld(mediaPos);\r\n  entity.object3D.visible = false;\r\n\r\n  const handler = () => {\r\n    entity.object3D.visible = true;\r\n    entity.setAttribute(\"animation__photo_pos\", {\r\n      property: \"position\",\r\n      dur: 800,\r\n      from: { x: pos.x, y: pos.y, z: pos.z },\r\n      to: { x: mediaPos.x, y: mediaPos.y, z: mediaPos.z },\r\n      easing: \"easeOutElastic\"\r\n    });\r\n  };\r\n\r\n  let eventType = null;\r\n\r\n  if (contentSubtype.startsWith(\"photo\")) {\r\n    entity.addEventListener(\"image-loaded\", handler, { once: true });\r\n    eventType = \"photo\";\r\n  } else if (contentSubtype.startsWith(\"video\")) {\r\n    entity.addEventListener(\"video-loaded\", handler, { once: true });\r\n    eventType = \"video\";\r\n  } else {\r\n    console.error(\"invalid type \" + contentSubtype);\r\n    return;\r\n  }\r\n\r\n  entity.object3D.matrixNeedsUpdate = true;\r\n\r\n  entity.addEventListener(\r\n    \"media_resolved\",\r\n    () => {\r\n      el.emit(`${eventType}_taken`, entity.components[\"media-loader\"].data.src);\r\n    },\r\n    { once: true }\r\n  );\r\n\r\n  return { entity, orientation };\r\n}\r\n\r\nexport const textureLoader = new HubsTextureLoader().setCrossOrigin(\"anonymous\");\r\n\r\nexport async function createImageTexture(url, filter) {\r\n  let texture;\r\n\r\n  if (filter) {\r\n    const image = new Image();\r\n    image.crossOrigin = \"anonymous\";\r\n    const load = new Promise(res => image.addEventListener(\"load\", res, { once: true }));\r\n    image.src = url;\r\n    await load;\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = image.width;\r\n    canvas.height = image.height;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    ctx.drawImage(image, 0, 0);\r\n    await filter(ctx, image.width, image.height);\r\n\r\n    texture = new THREE.CanvasTexture(canvas);\r\n  } else {\r\n    texture = new THREE.Texture();\r\n\r\n    try {\r\n      await textureLoader.loadTextureAsync(texture, url);\r\n    } catch (e) {\r\n      throw new Error(`'${url}' could not be fetched (Error code: ${e.status}; Response: ${e.statusText})`);\r\n    }\r\n  }\r\n\r\n  texture.encoding = THREE.sRGBEncoding;\r\n  texture.anisotropy = 4;\r\n\r\n  return texture;\r\n}\r\n\r\nimport HubsBasisTextureLoader from \"../loaders/HubsBasisTextureLoader\";\r\nexport const basisTextureLoader = new HubsBasisTextureLoader();\r\n\r\nexport function createBasisTexture(url) {\r\n  return new Promise((resolve, reject) => {\r\n    basisTextureLoader.load(\r\n      url,\r\n      function(texture) {\r\n        texture.encoding = THREE.sRGBEncoding;\r\n        texture.onUpdate = function() {\r\n          // Delete texture data once it has been uploaded to the GPU\r\n          texture.mipmaps.length = 0;\r\n        };\r\n        // texture.anisotropy = 4;\r\n        resolve(texture);\r\n      },\r\n      undefined,\r\n      function(error) {\r\n        console.error(error);\r\n        reject(new Error(`'${url}' could not be fetched (Error: ${error}`));\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nexport function addMeshScaleAnimation(mesh, initialScale, onComplete) {\r\n  const step = (function() {\r\n    const lastValue = {};\r\n    return function(anim) {\r\n      const value = anim.animatables[0].target;\r\n\r\n      value.x = Math.max(Number.MIN_VALUE, value.x);\r\n      value.y = Math.max(Number.MIN_VALUE, value.y);\r\n      value.z = Math.max(Number.MIN_VALUE, value.z);\r\n\r\n      // For animation timeline.\r\n      if (value.x === lastValue.x && value.y === lastValue.y && value.z === lastValue.z) {\r\n        return;\r\n      }\r\n\r\n      lastValue.x = value.x;\r\n      lastValue.y = value.y;\r\n      lastValue.z = value.z;\r\n\r\n      mesh.scale.set(value.x, value.y, value.z);\r\n      mesh.matrixNeedsUpdate = true;\r\n    };\r\n  })();\r\n\r\n  const config = {\r\n    duration: 400,\r\n    easing: \"easeOutElastic\",\r\n    elasticity: 400,\r\n    loop: 0,\r\n    round: false,\r\n    x: mesh.scale.x,\r\n    y: mesh.scale.y,\r\n    z: mesh.scale.z,\r\n    targets: [initialScale],\r\n    update: anim => step(anim),\r\n    complete: anim => {\r\n      step(anim);\r\n      if (onComplete) onComplete();\r\n    }\r\n  };\r\n\r\n  mesh.scale.copy(initialScale);\r\n  mesh.matrixNeedsUpdate = true;\r\n\r\n  return anime(config);\r\n}\r\n\r\nexport function closeExistingMediaMirror() {\r\n  const mirrorTarget = document.querySelector(\"#media-mirror-target\");\r\n\r\n  // Remove old mirror target media element\r\n  if (mirrorTarget.firstChild) {\r\n    mirrorTarget.firstChild.setAttribute(\"animation__remove\", {\r\n      property: \"scale\",\r\n      dur: 200,\r\n      to: { x: 0.01, y: 0.01, z: 0.01 },\r\n      easing: \"easeInQuad\"\r\n    });\r\n\r\n    return new Promise(res => {\r\n      mirrorTarget.firstChild.addEventListener(\"animationcomplete\", () => {\r\n        mirrorTarget.removeChild(mirrorTarget.firstChild);\r\n        mirrorTarget.parentEl.object3D.visible = false;\r\n        res();\r\n      });\r\n    });\r\n  }\r\n}\r\n","import { forEachMaterial } from \"../utils/material-utils\";\r\nimport { showHoverEffect } from \"../utils/permissions-utils\";\r\n\r\nconst interactorOneTransform = [];\r\nconst interactorTwoTransform = [];\r\n\r\nexport const validMaterials = [\"MeshStandardMaterial\", \"MeshBasicMaterial\", \"MobileStandardMaterial\"];\r\n/**\r\n * Applies effects to a hoverable based on hover state.\r\n * @namespace interactables\r\n * @component hoverable-visuals\r\n */\r\nAFRAME.registerComponent(\"hoverable-visuals\", {\r\n  schema: {\r\n    enableSweepingEffect: { type: \"boolean\", default: true }\r\n  },\r\n  init() {\r\n    // uniforms and boundingSphere are set from the component responsible for loading the mesh.\r\n    this.uniforms = null;\r\n    this.geometryRadius = 0;\r\n\r\n    this.sweepParams = [0, 0];\r\n  },\r\n  remove() {\r\n    this.uniforms = null;\r\n    this.boundingBox = null;\r\n\r\n    // Used when the object is batched\r\n    const batchManagerSystem = this.el.sceneEl.systems[\"hubs-systems\"].batchManagerSystem;\r\n    this.el.object3D.traverse(object => {\r\n      if (!object.material) return;\r\n      forEachMaterial(object, material => {\r\n        if (\r\n          !validMaterials.includes(material.type) ||\r\n          object.el.classList.contains(\"ui\") ||\r\n          object.el.classList.contains(\"hud\") ||\r\n          object.el.getAttribute(\"text-button\")\r\n        )\r\n          return;\r\n\r\n        if (batchManagerSystem.batchingEnabled) {\r\n          batchManagerSystem.meshToEl.delete(object);\r\n        }\r\n      });\r\n    });\r\n\r\n    const isMobile = AFRAME.utils.device.isMobile();\r\n    const isMobileVR = AFRAME.utils.device.isMobileVR();\r\n    this.isTouchscreen = isMobile && !isMobileVR;\r\n  },\r\n  tick(time) {\r\n    if (!this.uniforms || !this.uniforms.length) return;\r\n\r\n    const isFrozen = this.el.sceneEl.is(\"frozen\");\r\n    const showEffect = showHoverEffect(this.el);\r\n    const toggling = this.el.sceneEl.systems[\"hubs-systems\"].cursorTogglingSystem;\r\n\r\n    let interactorOne, interactorTwo;\r\n    const interaction = this.el.sceneEl.systems.interaction;\r\n    if (!interaction.ready) return; //DOMContentReady workaround\r\n    if (interaction.state.leftHand.hovered === this.el && !interaction.state.leftHand.held) {\r\n      interactorOne = interaction.options.leftHand.entity.object3D;\r\n    }\r\n    if (\r\n      interaction.state.leftRemote.hovered === this.el &&\r\n      !interaction.state.leftRemote.held &&\r\n      !toggling.leftToggledOff\r\n    ) {\r\n      interactorOne = interaction.options.leftRemote.entity.object3D;\r\n    }\r\n    if (\r\n      interaction.state.rightRemote.hovered === this.el &&\r\n      !interaction.state.rightRemote.held &&\r\n      !toggling.rightToggledOff\r\n    ) {\r\n      interactorTwo = interaction.options.rightRemote.entity.object3D;\r\n    }\r\n    if (interaction.state.rightHand.hovered === this.el && !interaction.state.rightHand.held) {\r\n      interactorTwo = interaction.options.rightHand.entity.object3D;\r\n    }\r\n\r\n    if (interactorOne) {\r\n      interactorOne.matrixWorld.toArray(interactorOneTransform);\r\n    }\r\n    if (interactorTwo) {\r\n      interactorTwo.matrixWorld.toArray(interactorTwoTransform);\r\n    }\r\n\r\n    if (interactorOne || interactorTwo || isFrozen) {\r\n      const worldY = this.el.object3D.matrixWorld.elements[13];\r\n      const ms1 = this.el.object3D.matrixWorld.elements[4];\r\n      const ms2 = this.el.object3D.matrixWorld.elements[5];\r\n      const ms3 = this.el.object3D.matrixWorld.elements[6];\r\n      const worldScale = Math.sqrt(ms1 * ms1 + ms2 * ms2 + ms3 * ms3);\r\n      const scaledRadius = worldScale * this.geometryRadius;\r\n      this.sweepParams[0] = worldY - scaledRadius;\r\n      this.sweepParams[1] = worldY + scaledRadius;\r\n    }\r\n\r\n    for (let i = 0, l = this.uniforms.length; i < l; i++) {\r\n      const uniform = this.uniforms[i];\r\n      uniform.hubs_EnableSweepingEffect.value = this.data.enableSweepingEffect && showEffect;\r\n      uniform.hubs_IsFrozen.value = isFrozen;\r\n      uniform.hubs_SweepParams.value = this.sweepParams;\r\n\r\n      uniform.hubs_HighlightInteractorOne.value = !!interactorOne && showEffect && !this.isTouchscreen;\r\n      uniform.hubs_InteractorOnePos.value[0] = interactorOneTransform[12];\r\n      uniform.hubs_InteractorOnePos.value[1] = interactorOneTransform[13];\r\n      uniform.hubs_InteractorOnePos.value[2] = interactorOneTransform[14];\r\n\r\n      uniform.hubs_HighlightInteractorTwo.value = !!interactorTwo && showEffect && !this.isTouchscreen;\r\n      uniform.hubs_InteractorTwoPos.value[0] = interactorTwoTransform[12];\r\n      uniform.hubs_InteractorTwoPos.value[1] = interactorTwoTransform[13];\r\n      uniform.hubs_InteractorTwoPos.value[2] = interactorTwoTransform[14];\r\n\r\n      if (interactorOne || interactorTwo || isFrozen) {\r\n        uniform.hubs_Time.value = time;\r\n      }\r\n    }\r\n  }\r\n});\r\n","// Utilities for manipulating state history. This provides a number of functions which\r\n// need to be used to manipulate history state so we can deal with edge cases around\r\n// entry back button and refreshes once entered.\r\n//\r\n// These functions also transparently deal with the room slug, so incoming calls can ignore\r\n// dealing with it, and provides APIs for getting the non-slug part of the path.\r\n//\r\n// The slug cannot be part of the basename for history, because the slug changes intra-session\r\n// if the room is renamed.\r\n\r\n// This pushes/replaces a new k, v pair into the history, while maintaining all the other\r\n// keys, or clears state if k if null.\r\n//\r\n// Also maintains a length key that can be used to find the length of the history chain\r\n// (across refreshes) for the current room.\r\nfunction pushOrUpdateHistory(history, replace, k, v, detail, newPathname, newSearch) {\r\n  let state = {};\r\n  const newLength = ((history.location.state && history.location.state.__historyLength) || 0) + (replace ? 0 : 1);\r\n\r\n  if (k || newPathname || newSearch) {\r\n    state = history.location.state ? { ...history.location.state } : {};\r\n    delete state.__duplicate;\r\n\r\n    if (k) {\r\n      state[k] = v;\r\n      state.key = k;\r\n      state.value = v;\r\n      state.detail = detail;\r\n    }\r\n  }\r\n\r\n  const pathname =\r\n    newPathname !== undefined ? newPathname : history.location.pathname === \"/\" ? \"\" : history.location.pathname;\r\n\r\n  const search = newSearch !== undefined ? newSearch : history.location.search;\r\n\r\n  // If popToBeginningOfHubHistory was previously used, there is a duplicate entry\r\n  // at the top of the history stack (which was needed to wipe out forward history)\r\n  // so we use this opportunity to replace it.\r\n  const isDuplicate = history.location.state && history.location.state.__duplicate;\r\n  const method = replace || isDuplicate ? history.replace : history.push;\r\n  state.__historyLength = newLength;\r\n\r\n  method({ pathname, search, state });\r\n}\r\n\r\nexport function pushHistoryState(history, k, v, detail) {\r\n  pushOrUpdateHistory(history, false, k, v, detail);\r\n}\r\n\r\nexport function replaceHistoryState(history, k, v, detail) {\r\n  pushOrUpdateHistory(history, true, k, v, detail);\r\n}\r\n\r\nexport function pushHistoryPath(history, path, search) {\r\n  pushOrUpdateHistory(history, false, null, null, null, path, search);\r\n}\r\n\r\nexport function clearHistoryState(history) {\r\n  pushOrUpdateHistory(history, false);\r\n}\r\n\r\n// This will pop the browser history to the first entry that was for this hubs room,\r\n// and then push a duplicate entry onto the history stack in order to wipe out forward\r\n// history.\r\nexport function popToBeginningOfHubHistory(history, navigateToPriorPage) {\r\n  if (!history.location.state || history.location.state.__historyLength === undefined) return;\r\n\r\n  const len = history.location.state.__historyLength;\r\n  if (len === 0) return;\r\n\r\n  return new Promise(resolve => {\r\n    // After the go() completes, we push a duplicate history entry onto the stack\r\n    // in order to wipe out forward history. We also optionally go back -2 if we wanted\r\n    // to go back to the prior page.\r\n    const unsubscribe = history.listen(() => {\r\n      unsubscribe();\r\n      history.push({\r\n        pathname: history.location.pathname,\r\n        search: history.location.search,\r\n        state: { __historyLength: 0, __duplicate: true }\r\n      });\r\n      if (navigateToPriorPage) history.go(-2); // Go back to history entry before beginning.\r\n      resolve();\r\n    });\r\n\r\n    history.go(-len);\r\n  });\r\n}\r\n\r\n// This will pop the browser history to the entry before the first entry for this hubs room.\r\nexport function navigateToPriorPage(history) {\r\n  popToBeginningOfHubHistory(history, true);\r\n}\r\n\r\n// Returns the part of the pathname that does not include the slug\r\nexport function sluglessPath(location) {\r\n  const parts = location.pathname.split(\"/\");\r\n  return `/${parts.slice(2).join(\"/\")}`;\r\n}\r\n\r\n// Returns a new path that includes the current slug as a prefix to the\r\n// provided path.\r\nexport function withSlug(location, path) {\r\n  const parts = location.pathname.split(\"/\");\r\n  return `/${parts[1]}${path}`;\r\n}\r\n","import { forEachMaterial } from \"../utils/material-utils\";\r\nimport cubeMapPosX from \"../assets/images/cubemap/posx.jpg\";\r\nimport cubeMapNegX from \"../assets/images/cubemap/negx.jpg\";\r\nimport cubeMapPosY from \"../assets/images/cubemap/posy.jpg\";\r\nimport cubeMapNegY from \"../assets/images/cubemap/negy.jpg\";\r\nimport cubeMapPosZ from \"../assets/images/cubemap/posz.jpg\";\r\nimport cubeMapNegZ from \"../assets/images/cubemap/negz.jpg\";\r\n\r\nexport async function createDefaultEnvironmentMap() {\r\n  const urls = [cubeMapPosX, cubeMapNegX, cubeMapPosY, cubeMapNegY, cubeMapPosZ, cubeMapNegZ];\r\n  const texture = await new Promise((resolve, reject) =>\r\n    new THREE.CubeTextureLoader().load(urls, resolve, undefined, reject)\r\n  );\r\n  texture.format = THREE.RGBFormat;\r\n  return texture;\r\n}\r\n\r\nAFRAME.registerComponent(\"environment-map\", {\r\n  init() {\r\n    this.environmentMap = null;\r\n\r\n    this.updateEnvironmentMap = this.updateEnvironmentMap.bind(this);\r\n  },\r\n\r\n  updateEnvironmentMap(environmentMap) {\r\n    this.environmentMap = environmentMap;\r\n    this.applyEnvironmentMap(this.el.object3D);\r\n  },\r\n\r\n  applyEnvironmentMap(object3D) {\r\n    object3D.traverse(object => {\r\n      forEachMaterial(object, material => {\r\n        if (material.isMeshStandardMaterial) {\r\n          material.envMap = this.environmentMap;\r\n          material.needsUpdate = true;\r\n        }\r\n      });\r\n    });\r\n  }\r\n});\r\n","module.exports = \"if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\\r\\n  float ratio = 0.0;\\r\\n  float size = hubs_SweepParams.t - hubs_SweepParams.s;\\r\\n\\r\\n  if (hubs_EnableSweepingEffect) {\\r\\n    float line = mod(hubs_Time / 500.0 * size, size * 3.0) + hubs_SweepParams.s - size / 3.0;\\r\\n\\r\\n    if (hubs_WorldPosition.y < line) {\\r\\n      // Highlight with a sweeping gradient.\\r\\n      ratio = max(0.0, 1.0 - (line - hubs_WorldPosition.y) / (size * 1.5));\\r\\n    }\\r\\n  }\\r\\n\\r\\n  // Highlight with a gradient falling off with distance.\\r\\n  float pulse = 1.0 / (size + 0.2) * 8.0 + 1.0 / (size + 0.3) * 3.0 * (sin(hubs_Time / 1000.0) + 1.0);\\r\\n\\r\\n  if (hubs_HighlightInteractorOne) {\\r\\n    float dist1 = distance(hubs_WorldPosition, hubs_InteractorOnePos);\\r\\n    ratio += -min(1.0, pow(dist1 * pulse, 3.0)) + 1.0;\\r\\n  } \\r\\n\\r\\n  if (hubs_HighlightInteractorTwo) {\\r\\n    float dist2 = distance(hubs_WorldPosition, hubs_InteractorTwoPos);\\r\\n    ratio += -min(1.0, pow(dist2 * pulse, 3.0)) + 1.0;\\r\\n  }\\r\\n\\r\\n  ratio = min(1.0, ratio);\\r\\n\\r\\n  // Gamma corrected highlight color\\r\\n  vec3 highlightColor = vec3(0.184, 0.499, 0.933);\\r\\n\\r\\n  gl_FragColor.rgb = (gl_FragColor.rgb * (1.0 - ratio)) + (highlightColor * ratio);\\r\\n}\\r\\n\"","module.exports = __webpack_public_path__ + \"assets/wasm/basis_transcoder-47fe610404bbcccd872b6ced44635d10.wasm\";","module.exports = function() {\n  return require(\"!!C:\\\\Projects\\\\hubs\\\\node_modules\\\\worker-loader\\\\dist\\\\workers\\\\InlineWorker.js\")(\"!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){\\\"undefined\\\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\\\"Module\\\"}),Object.defineProperty(t,\\\"__esModule\\\",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&\\\"object\\\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\\\"default\\\",{enumerable:!0,value:t}),2&e&&\\\"string\\\"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,\\\"a\\\",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p=\\\"/hubs\\\",r(r.s=1)}([function(t,e){var r,n,o=t.exports={};function i(){throw new Error(\\\"setTimeout has not been defined\\\")}function a(){throw new Error(\\\"clearTimeout has not been defined\\\")}function u(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r=\\\"function\\\"==typeof setTimeout?setTimeout:i}catch(t){r=i}try{n=\\\"function\\\"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var s,c=[],l=!1,f=-1;function p(){l&&s&&(l=!1,s.length?c=s.concat(c):f=-1,c.length&&d())}function d(){if(!l){var t=u(p);l=!0;for(var e=c.length;e;){for(s=c,c=[];++f<e;)s&&s[f].run();f=-1,e=c.length}s=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function y(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new h(t,e)),1!==c.length||l||u(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title=\\\"browser\\\",o.browser=!0,o.env={},o.argv=[],o.version=\\\"\\\",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(t){return[]},o.binding=function(t){throw new Error(\\\"process.binding is not supported\\\")},o.cwd=function(){return\\\"/\\\"},o.chdir=function(t){throw new Error(\\\"process.chdir is not supported\\\")},o.umask=function(){return 0}},function(t,e,r){(function(e,n){var o,i,a,u,s=(o=\\\"undefined\\\"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){var i,a=void 0!==(t=t||{})?t:{},u={};for(i in a)a.hasOwnProperty(i)&&(u[i]=a[i]);var s,c,l=[],f=!1,p=!1;f=\\\"object\\\"==typeof window,p=\\\"function\\\"==typeof importScripts,s=\\\"object\\\"==typeof e&&\\\"object\\\"==typeof e.versions&&\\\"string\\\"==typeof e.versions.node&&!f&&!p,c=!f&&!s&&!p;var d,h,y,v,m=\\\"\\\";s?(m=n+\\\"/\\\",d=function(t,e){var n;return y||(y=r(2)),v||(v=r(3)),t=v.normalize(t),n=y.readFileSync(t),e?n:n.toString()},h=function(t){var e=d(t,!0);return e.buffer||(e=new Uint8Array(e)),P(e.buffer),e},e.argv.length>1&&e.argv[1].replace(/\\\\\\\\/g,\\\"/\\\"),l=e.argv.slice(2),e.on(\\\"uncaughtException\\\",function(t){if(!(t instanceof function(t){this.name=\\\"ExitStatus\\\",this.message=\\\"Program terminated with exit(\\\"+t+\\\")\\\",this.status=t}))throw t}),e.on(\\\"unhandledRejection\\\",xe),a.inspect=function(){return\\\"[Emscripten Module object]\\\"}):c?(\\\"undefined\\\"!=typeof read&&(d=function(t){return read(t)}),h=function(t){var e;return\\\"function\\\"==typeof readbuffer?new Uint8Array(readbuffer(t)):(P(\\\"object\\\"==typeof(e=read(t,\\\"binary\\\"))),e)},\\\"undefined\\\"!=typeof scriptArgs?l=scriptArgs:void 0!==arguments&&(l=arguments),\\\"undefined\\\"!=typeof print&&(\\\"undefined\\\"==typeof console&&(console={}),console.log=print,console.warn=console.error=\\\"undefined\\\"!=typeof printErr?printErr:print)):(f||p)&&(p?m=self.location.href:document.currentScript&&(m=document.currentScript.src),o&&(m=o),m=0!==m.indexOf(\\\"blob:\\\")?m.substr(0,m.lastIndexOf(\\\"/\\\")+1):\\\"\\\",d=function(t){var e=new XMLHttpRequest;return e.open(\\\"GET\\\",t,!1),e.send(null),e.responseText},p&&(h=function(t){var e=new XMLHttpRequest;return e.open(\\\"GET\\\",t,!1),e.responseType=\\\"arraybuffer\\\",e.send(null),new Uint8Array(e.response)}));var g=a.print||console.log.bind(console),b=a.printErr||console.warn.bind(console);for(i in u)u.hasOwnProperty(i)&&(a[i]=u[i]);u=null,a.arguments&&(l=a.arguments),a.thisProgram&&a.thisProgram,a.quit&&a.quit;var w,T,C={\\\"f64-rem\\\":function(t,e){return t%e},debugger:function(){}};new Array(0),a.wasmBinary&&(w=a.wasmBinary),a.noExitRuntime&&a.noExitRuntime,\\\"object\\\"!=typeof WebAssembly&&b(\\\"no native wasm support detected\\\");var $=!1;function P(t,e){t||xe(\\\"Assertion failed: \\\"+e)}var _,A,E,F,S,O,j,W,k,x=\\\"undefined\\\"!=typeof TextDecoder?new TextDecoder(\\\"utf8\\\"):void 0;function I(t,e,r){for(var n=e+r,o=e;t[o]&&!(o>=n);)++o;if(o-e>16&&t.subarray&&x)return x.decode(t.subarray(e,o));for(var i=\\\"\\\";e<o;){var a=t[e++];if(128&a){var u=63&t[e++];if(192!=(224&a)){var s=63&t[e++];if((a=224==(240&a)?(15&a)<<12|u<<6|s:(7&a)<<18|u<<12|s<<6|63&t[e++])<65536)i+=String.fromCharCode(a);else{var c=a-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&a)<<6|u)}else i+=String.fromCharCode(a)}return i}function R(t,e){return t?I(E,t,e):\\\"\\\"}function D(t,e){return t%e>0&&(t+=e-t%e),t}function U(t){_=t,a.HEAP8=A=new Int8Array(t),a.HEAP16=F=new Int16Array(t),a.HEAP32=O=new Int32Array(t),a.HEAPU8=E=new Uint8Array(t),a.HEAPU16=S=new Uint16Array(t),a.HEAPU32=j=new Uint32Array(t),a.HEAPF32=W=new Float32Array(t),a.HEAPF64=k=new Float64Array(t)}\\\"undefined\\\"!=typeof TextDecoder&&new TextDecoder(\\\"utf-16le\\\");var B=a.TOTAL_MEMORY||16777216;function M(t){for(;t.length>0;){var e=t.shift();if(\\\"function\\\"!=typeof e){var r=e.func;\\\"number\\\"==typeof r?void 0===e.arg?a.dynCall_v(r):a.dynCall_vi(r,e.arg):r(void 0===e.arg?null:e.arg)}else e()}}(T=a.wasmMemory?a.wasmMemory:new WebAssembly.Memory({initial:B/65536}))&&(_=T.buffer),B=_.byteLength,U(_),O[59864]=5482368;var L=[],N=[],H=[],z=[],V=0,q=null,G=null;a.preloadedImages={},a.preloadedAudios={};var Z=\\\"data:application/octet-stream;base64,\\\";function X(t){return String.prototype.startsWith?t.startsWith(Z):0===t.indexOf(Z)}var J,Y=\\\"basis_transcoder.wasm\\\";function K(){try{if(w)return new Uint8Array(w);if(h)return h(Y);throw\\\"both async and sync fetching of the wasm failed\\\"}catch(t){xe(t)}}function Q(t){var e={env:t,wasi_unstable:t,global:{NaN:NaN,Infinity:1/0},\\\"global.Math\\\":Math,asm2wasm:C};function r(t,e){var r=t.exports;a.asm=r,function(t){if(V--,a.monitorRunDependencies&&a.monitorRunDependencies(V),0==V&&(null!==q&&(clearInterval(q),q=null),G)){var e=G;G=null,e()}}()}function n(t){r(t.instance)}function o(t){return(w||!f&&!p||\\\"function\\\"!=typeof fetch?new Promise(function(t,e){t(K())}):fetch(Y,{credentials:\\\"same-origin\\\"}).then(function(t){if(!t.ok)throw\\\"failed to load wasm binary file at '\\\"+Y+\\\"'\\\";return t.arrayBuffer()}).catch(function(){return K()})).then(function(t){return WebAssembly.instantiate(t,e)}).then(t,function(t){b(\\\"failed to asynchronously prepare wasm: \\\"+t),xe(t)})}if(V++,a.monitorRunDependencies&&a.monitorRunDependencies(V),a.instantiateWasm)try{return a.instantiateWasm(e,r)}catch(t){return b(\\\"Module.instantiateWasm callback failed with error: \\\"+t),!1}return function(){if(w||\\\"function\\\"!=typeof WebAssembly.instantiateStreaming||X(Y)||\\\"function\\\"!=typeof fetch)return o(n);fetch(Y,{credentials:\\\"same-origin\\\"}).then(function(t){return WebAssembly.instantiateStreaming(t,e).then(n,function(t){b(\\\"wasm streaming compile failed: \\\"+t),b(\\\"falling back to ArrayBuffer instantiation\\\"),o(n)})})}(),{}}X(Y)||(J=Y,Y=a.locateFile?a.locateFile(J,m):m+J),a.asm=function(t,e,r){return e.memory=T,e.table=new WebAssembly.Table({initial:342,maximum:342,element:\\\"anyfunc\\\"}),e.__memory_base=1024,e.__table_base=0,Q(e)},N.push({func:function(){We()}});var tt={},et={buffers:[null,[],[]],printChar:function(t,e){var r=et.buffers[t];0===e||10===e?((1===t?g:b)(I(r,0)),r.length=0):r.push(e)},varargs:0,get:function(t){return et.varargs+=4,O[et.varargs-4>>2]},getStr:function(){return R(et.get())},get64:function(){var t=et.get();return et.get(),t},getZero:function(){et.get()}};function rt(t){switch(t){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(\\\"Unknown type size: \\\"+t)}}var nt=void 0;function ot(t){for(var e=\\\"\\\",r=t;E[r];)e+=nt[E[r++]];return e}var it={},at={},ut={},st=48,ct=57;function lt(t){if(void 0===t)return\\\"_unknown\\\";var e=(t=t.replace(/[^a-zA-Z0-9_]/g,\\\"$\\\")).charCodeAt(0);return e>=st&&e<=ct?\\\"_\\\"+t:t}function ft(t,e){return t=lt(t),new Function(\\\"body\\\",\\\"return function \\\"+t+'() {\\\\n    \\\"use strict\\\";    return body.apply(this, arguments);\\\\n};\\\\n')(e)}function pt(t,e){var r=ft(e,function(t){this.name=e,this.message=t;var r=new Error(t).stack;void 0!==r&&(this.stack=this.toString()+\\\"\\\\n\\\"+r.replace(/^Error(:[^\\\\n]*)?\\\\n/,\\\"\\\"))});return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+\\\": \\\"+this.message},r}var dt=void 0;function ht(t){throw new dt(t)}var yt=void 0;function vt(t){throw new yt(t)}function mt(t,e,r){function n(e){var n=r(e);n.length!==t.length&&vt(\\\"Mismatched type converter count\\\");for(var o=0;o<t.length;++o)gt(t[o],n[o])}t.forEach(function(t){ut[t]=e});var o=new Array(e.length),i=[],a=0;e.forEach(function(t,e){at.hasOwnProperty(t)?o[e]=at[t]:(i.push(t),it.hasOwnProperty(t)||(it[t]=[]),it[t].push(function(){o[e]=at[t],++a===i.length&&n(o)}))}),0===i.length&&n(o)}function gt(t,e,r){if(r=r||{},!(\\\"argPackAdvance\\\"in e))throw new TypeError(\\\"registerType registeredInstance requires argPackAdvance\\\");var n=e.name;if(t||ht('type \\\"'+n+'\\\" must have a positive integer typeid pointer'),at.hasOwnProperty(t)){if(r.ignoreDuplicateRegistrations)return;ht(\\\"Cannot register type '\\\"+n+\\\"' twice\\\")}if(at[t]=e,delete ut[t],it.hasOwnProperty(t)){var o=it[t];delete it[t],o.forEach(function(t){t()})}}function bt(t){if(!(this instanceof Wt))return!1;if(!(t instanceof Wt))return!1;for(var e=this.$$.ptrType.registeredClass,r=this.$$.ptr,n=t.$$.ptrType.registeredClass,o=t.$$.ptr;e.baseClass;)r=e.upcast(r),e=e.baseClass;for(;n.baseClass;)o=n.upcast(o),n=n.baseClass;return e===n&&r===o}function wt(t){ht(t.$$.ptrType.registeredClass.name+\\\" instance already deleted\\\")}var Tt=!1;function Ct(t){}function $t(t){t.count.value-=1,0===t.count.value&&function(t){t.smartPtr?t.smartPtrType.rawDestructor(t.smartPtr):t.ptrType.registeredClass.rawDestructor(t.ptr)}(t)}function Pt(t){return\\\"undefined\\\"==typeof FinalizationGroup?(Pt=function(t){return t},t):(Tt=new FinalizationGroup(function(t){for(var e=t.next();!e.done;e=t.next()){var r=e.value;r.ptr?$t(r):console.warn(\\\"object already deleted: \\\"+r.ptr)}}),Ct=function(t){Tt.unregister(t.$$)},(Pt=function(t){return Tt.register(t,t.$$,t.$$),t})(t))}function _t(){if(this.$$.ptr||wt(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var t,e=Pt(Object.create(Object.getPrototypeOf(this),{$$:{value:(t=this.$$,{count:t.count,deleteScheduled:t.deleteScheduled,preservePointerOnDelete:t.preservePointerOnDelete,ptr:t.ptr,ptrType:t.ptrType,smartPtr:t.smartPtr,smartPtrType:t.smartPtrType})}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function At(){this.$$.ptr||wt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ht(\\\"Object already scheduled for deletion\\\"),Ct(this),$t(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Et(){return!this.$$.ptr}var Ft=void 0,St=[];function Ot(){for(;St.length;){var t=St.pop();t.$$.deleteScheduled=!1,t.delete()}}function jt(){return this.$$.ptr||wt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ht(\\\"Object already scheduled for deletion\\\"),St.push(this),1===St.length&&Ft&&Ft(Ot),this.$$.deleteScheduled=!0,this}function Wt(){}var kt={};function xt(t,e,r){if(void 0===t[e].overloadTable){var n=t[e];t[e]=function(){return t[e].overloadTable.hasOwnProperty(arguments.length)||ht(\\\"Function '\\\"+r+\\\"' called with an invalid number of arguments (\\\"+arguments.length+\\\") - expects one of (\\\"+t[e].overloadTable+\\\")!\\\"),t[e].overloadTable[arguments.length].apply(this,arguments)},t[e].overloadTable=[],t[e].overloadTable[n.argCount]=n}}function It(t,e,r){a.hasOwnProperty(t)?((void 0===r||void 0!==a[t].overloadTable&&void 0!==a[t].overloadTable[r])&&ht(\\\"Cannot register public name '\\\"+t+\\\"' twice\\\"),xt(a,t,t),a.hasOwnProperty(r)&&ht(\\\"Cannot register multiple overloads of a function with the same number of arguments (\\\"+r+\\\")!\\\"),a[t].overloadTable[r]=e):(a[t]=e,void 0!==r&&(a[t].numArguments=r))}function Rt(t,e,r,n,o,i,a,u){this.name=t,this.constructor=e,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=o,this.getActualType=i,this.upcast=a,this.downcast=u,this.pureVirtualFunctions=[]}function Dt(t,e,r){for(;e!==r;)e.upcast||ht(\\\"Expected null or instance of \\\"+r.name+\\\", got an instance of \\\"+e.name),t=e.upcast(t),e=e.baseClass;return t}function Ut(t,e){if(null===e)return this.isReference&&ht(\\\"null is not a valid \\\"+this.name),0;e.$$||ht('Cannot pass \\\"'+he(e)+'\\\" as a '+this.name),e.$$.ptr||ht(\\\"Cannot pass deleted object as a pointer of type \\\"+this.name);var r=e.$$.ptrType.registeredClass;return Dt(e.$$.ptr,r,this.registeredClass)}function Bt(t,e){var r;if(null===e)return this.isReference&&ht(\\\"null is not a valid \\\"+this.name),this.isSmartPointer?(r=this.rawConstructor(),null!==t&&t.push(this.rawDestructor,r),r):0;e.$$||ht('Cannot pass \\\"'+he(e)+'\\\" as a '+this.name),e.$$.ptr||ht(\\\"Cannot pass deleted object as a pointer of type \\\"+this.name),!this.isConst&&e.$$.ptrType.isConst&&ht(\\\"Cannot convert argument of type \\\"+(e.$$.smartPtrType?e.$$.smartPtrType.name:e.$$.ptrType.name)+\\\" to parameter type \\\"+this.name);var n=e.$$.ptrType.registeredClass;if(r=Dt(e.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(void 0===e.$$.smartPtr&&ht(\\\"Passing raw pointer to smart pointer is illegal\\\"),this.sharingPolicy){case 0:e.$$.smartPtrType===this?r=e.$$.smartPtr:ht(\\\"Cannot convert argument of type \\\"+(e.$$.smartPtrType?e.$$.smartPtrType.name:e.$$.ptrType.name)+\\\" to parameter type \\\"+this.name);break;case 1:r=e.$$.smartPtr;break;case 2:if(e.$$.smartPtrType===this)r=e.$$.smartPtr;else{var o=e.clone();r=this.rawShare(r,de(function(){o.delete()})),null!==t&&t.push(this.rawDestructor,r)}break;default:ht(\\\"Unsupporting sharing policy\\\")}return r}function Mt(t,e){if(null===e)return this.isReference&&ht(\\\"null is not a valid \\\"+this.name),0;e.$$||ht('Cannot pass \\\"'+he(e)+'\\\" as a '+this.name),e.$$.ptr||ht(\\\"Cannot pass deleted object as a pointer of type \\\"+this.name),e.$$.ptrType.isConst&&ht(\\\"Cannot convert argument of type \\\"+e.$$.ptrType.name+\\\" to parameter type \\\"+this.name);var r=e.$$.ptrType.registeredClass;return Dt(e.$$.ptr,r,this.registeredClass)}function Lt(t){return this.fromWireType(j[t>>2])}function Nt(t){return this.rawGetPointee&&(t=this.rawGetPointee(t)),t}function Ht(t){this.rawDestructor&&this.rawDestructor(t)}function zt(t){null!==t&&t.delete()}function Vt(){return Object.keys(Zt).length}function qt(){var t=[];for(var e in Zt)Zt.hasOwnProperty(e)&&t.push(Zt[e]);return t}function Gt(t){Ft=t,St.length&&Ft&&Ft(Ot)}var Zt={};function Xt(t,e){return e=function(t,e){for(void 0===e&&ht(\\\"ptr should not be undefined\\\");t.baseClass;)e=t.upcast(e),t=t.baseClass;return e}(t,e),Zt[e]}function Jt(t,e){return e.ptrType&&e.ptr||vt(\\\"makeClassHandle requires ptr and ptrType\\\"),!!e.smartPtrType!=!!e.smartPtr&&vt(\\\"Both smartPtrType and smartPtr must be specified\\\"),e.count={value:1},Pt(Object.create(t,{$$:{value:e}}))}function Yt(t){var e=this.getPointee(t);if(!e)return this.destructor(t),null;var r=Xt(this.registeredClass,e);if(void 0!==r){if(0===r.$$.count.value)return r.$$.ptr=e,r.$$.smartPtr=t,r.clone();var n=r.clone();return this.destructor(t),n}function o(){return this.isSmartPointer?Jt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:e,smartPtrType:this,smartPtr:t}):Jt(this.registeredClass.instancePrototype,{ptrType:this,ptr:t})}var i,a=this.registeredClass.getActualType(e),u=kt[a];if(!u)return o.call(this);i=this.isConst?u.constPointerType:u.pointerType;var s=function t(e,r,n){if(r===n)return e;if(void 0===n.baseClass)return null;var o=t(e,r,n.baseClass);return null===o?null:n.downcast(o)}(e,this.registeredClass,i.registeredClass);return null===s?o.call(this):this.isSmartPointer?Jt(i.registeredClass.instancePrototype,{ptrType:i,ptr:s,smartPtrType:this,smartPtr:t}):Jt(i.registeredClass.instancePrototype,{ptrType:i,ptr:s})}function Kt(t,e,r,n,o,i,a,u,s,c,l){this.name=t,this.registeredClass=e,this.isReference=r,this.isConst=n,this.isSmartPointer=o,this.pointeeType=i,this.sharingPolicy=a,this.rawGetPointee=u,this.rawConstructor=s,this.rawShare=c,this.rawDestructor=l,o||void 0!==e.baseClass?this.toWireType=Bt:n?(this.toWireType=Ut,this.destructorFunction=null):(this.toWireType=Mt,this.destructorFunction=null)}function Qt(t,e,r){a.hasOwnProperty(t)||vt(\\\"Replacing nonexistant public symbol\\\"),void 0!==a[t].overloadTable&&void 0!==r?a[t].overloadTable[r]=e:(a[t]=e,a[t].argCount=r)}function te(t,e){var r;if(t=ot(t),void 0!==a[\\\"FUNCTION_TABLE_\\\"+t])r=a[\\\"FUNCTION_TABLE_\\\"+t][e];else if(\\\"undefined\\\"!=typeof FUNCTION_TABLE)r=FUNCTION_TABLE[e];else{var n=a[\\\"dynCall_\\\"+t];void 0===n&&void 0===(n=a[\\\"dynCall_\\\"+t.replace(/f/g,\\\"d\\\")])&&ht(\\\"No dynCall invoker for signature: \\\"+t),r=function(r){for(var n=[],o=1;o<t.length;++o)n.push(\\\"a\\\"+o);var i=\\\"return function dynCall_\\\"+t+\\\"_\\\"+e+\\\"(\\\"+n.join(\\\", \\\")+\\\") {\\\\n\\\";return i+=\\\"    return dynCall(rawFunction\\\"+(n.length?\\\", \\\":\\\"\\\")+n.join(\\\", \\\")+\\\");\\\\n\\\",i+=\\\"};\\\\n\\\",new Function(\\\"dynCall\\\",\\\"rawFunction\\\",i)(r,e)}(n)}return\\\"function\\\"!=typeof r&&ht(\\\"unknown function pointer with signature \\\"+t+\\\": \\\"+e),r}var ee=void 0;function re(t){var e=Se(t),r=ot(e);return Oe(e),r}function ne(t,e){var r=[],n={};throw e.forEach(function t(e){n[e]||at[e]||(ut[e]?ut[e].forEach(t):(r.push(e),n[e]=!0))}),new ee(t+\\\": \\\"+r.map(re).join([\\\", \\\"]))}function oe(t,e){for(var r=[],n=0;n<t;n++)r.push(O[(e>>2)+n]);return r}function ie(t){for(;t.length;){var e=t.pop();t.pop()(e)}}function ae(t,e){if(!(t instanceof Function))throw new TypeError(\\\"new_ called with constructor type \\\"+typeof t+\\\" which is not a function\\\");var r=ft(t.name||\\\"unknownFunctionName\\\",function(){});r.prototype=t.prototype;var n=new r,o=t.apply(n,e);return o instanceof Object?o:n}function ue(t,e,r,n,o){var i=e.length;i<2&&ht(\\\"argTypes array size mismatch! Must at least get return value and 'this' types!\\\");for(var a=null!==e[1]&&null!==r,u=!1,s=1;s<e.length;++s)if(null!==e[s]&&void 0===e[s].destructorFunction){u=!0;break}var c=\\\"void\\\"!==e[0].name,l=\\\"\\\",f=\\\"\\\";for(s=0;s<i-2;++s)l+=(0!==s?\\\", \\\":\\\"\\\")+\\\"arg\\\"+s,f+=(0!==s?\\\", \\\":\\\"\\\")+\\\"arg\\\"+s+\\\"Wired\\\";var p=\\\"return function \\\"+lt(t)+\\\"(\\\"+l+\\\") {\\\\nif (arguments.length !== \\\"+(i-2)+\\\") {\\\\nthrowBindingError('function \\\"+t+\\\" called with ' + arguments.length + ' arguments, expected \\\"+(i-2)+\\\" args!');\\\\n}\\\\n\\\";u&&(p+=\\\"var destructors = [];\\\\n\\\");var d=u?\\\"destructors\\\":\\\"null\\\",h=[\\\"throwBindingError\\\",\\\"invoker\\\",\\\"fn\\\",\\\"runDestructors\\\",\\\"retType\\\",\\\"classParam\\\"],y=[ht,n,o,ie,e[0],e[1]];for(a&&(p+=\\\"var thisWired = classParam.toWireType(\\\"+d+\\\", this);\\\\n\\\"),s=0;s<i-2;++s)p+=\\\"var arg\\\"+s+\\\"Wired = argType\\\"+s+\\\".toWireType(\\\"+d+\\\", arg\\\"+s+\\\"); // \\\"+e[s+2].name+\\\"\\\\n\\\",h.push(\\\"argType\\\"+s),y.push(e[s+2]);if(a&&(f=\\\"thisWired\\\"+(f.length>0?\\\", \\\":\\\"\\\")+f),p+=(c?\\\"var rv = \\\":\\\"\\\")+\\\"invoker(fn\\\"+(f.length>0?\\\", \\\":\\\"\\\")+f+\\\");\\\\n\\\",u)p+=\\\"runDestructors(destructors);\\\\n\\\";else for(s=a?1:2;s<e.length;++s){var v=1===s?\\\"thisWired\\\":\\\"arg\\\"+(s-2)+\\\"Wired\\\";null!==e[s].destructorFunction&&(p+=v+\\\"_dtor(\\\"+v+\\\"); // \\\"+e[s].name+\\\"\\\\n\\\",h.push(v+\\\"_dtor\\\"),y.push(e[s].destructorFunction))}return c&&(p+=\\\"var ret = retType.fromWireType(rv);\\\\nreturn ret;\\\\n\\\"),p+=\\\"}\\\\n\\\",h.push(p),ae(Function,h).apply(null,y)}var se=[],ce=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function le(t){t>4&&0==--ce[t].refcount&&(ce[t]=void 0,se.push(t))}function fe(){for(var t=0,e=5;e<ce.length;++e)void 0!==ce[e]&&++t;return t}function pe(){for(var t=5;t<ce.length;++t)if(void 0!==ce[t])return ce[t];return null}function de(t){switch(t){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var e=se.length?se.pop():ce.length;return ce[e]={refcount:1,value:t},e}}function he(t){if(null===t)return\\\"null\\\";var e=typeof t;return\\\"object\\\"===e||\\\"array\\\"===e||\\\"function\\\"===e?t.toString():\\\"\\\"+t}function ye(t,e){switch(e){case 2:return function(t){return this.fromWireType(W[t>>2])};case 3:return function(t){return this.fromWireType(k[t>>3])};default:throw new TypeError(\\\"Unknown float type: \\\"+t)}}function ve(t,e,r){switch(e){case 0:return r?function(t){return A[t]}:function(t){return E[t]};case 1:return r?function(t){return F[t>>1]}:function(t){return S[t>>1]};case 2:return r?function(t){return O[t>>2]}:function(t){return j[t>>2]};default:throw new TypeError(\\\"Unknown integer type: \\\"+t)}}function me(t){return t||ht(\\\"Cannot use deleted val. handle = \\\"+t),ce[t].value}function ge(t,e){var r=at[t];return void 0===r&&ht(e+\\\" has unknown type \\\"+re(t)),r}var be={};function we(t){var e=be[t];return void 0===e?ot(t):e}var Te=[];function Ce(){return\\\"object\\\"==typeof globalThis?globalThis:Function(\\\"return this\\\")()}var $e={};function Pe(){return A.length}!function(){for(var t=new Array(256),e=0;e<256;++e)t[e]=String.fromCharCode(e);nt=t}(),dt=a.BindingError=pt(Error,\\\"BindingError\\\"),yt=a.InternalError=pt(Error,\\\"InternalError\\\"),Wt.prototype.isAliasOf=bt,Wt.prototype.clone=_t,Wt.prototype.delete=At,Wt.prototype.isDeleted=Et,Wt.prototype.deleteLater=jt,Kt.prototype.getPointee=Nt,Kt.prototype.destructor=Ht,Kt.prototype.argPackAdvance=8,Kt.prototype.readValueFromPointer=Lt,Kt.prototype.deleteObject=zt,Kt.prototype.fromWireType=Yt,a.getInheritedInstanceCount=Vt,a.getLiveInheritedInstances=qt,a.flushPendingDeletes=Ot,a.setDelayFunction=Gt,ee=a.UnboundTypeError=pt(Error,\\\"UnboundTypeError\\\"),a.count_emval_handles=fe,a.get_first_emval=pe;var _e={c:xe,A:function(t){},i:function(t){return je(t)},I:function(){throw $=!0,\\\"Pure virtual function called!\\\"},h:function(t,e,r){throw tt[t]={ptr:t,adjusted:[t],type:e,destructor:r,refcount:0,caught:!1,rethrown:!1},\\\"uncaught_exception\\\"in Fe?Fe.uncaught_exceptions++:Fe.uncaught_exceptions=1,t},z:function(){return Fe.uncaught_exceptions},m:function(t){return a.___errno_location&&(O[a.___errno_location()>>2]=t),t},y:function(t,e){et.varargs=e;try{return et.getStreamFromFD(),et.get(),et.get(),et.get(),et.get(),0}catch(t){return\\\"undefined\\\"!=typeof FS&&t instanceof FS.ErrnoError||xe(t),-t.errno}},x:function(t,e){et.varargs=e;try{return et.getStreamFromFD(),0}catch(t){return\\\"undefined\\\"!=typeof FS&&t instanceof FS.ErrnoError||xe(t),-t.errno}},w:function(){return function(t,e,r,n){try{for(var o=0,i=0;i<r;i++){for(var a=O[e+8*i>>2],u=O[e+(8*i+4)>>2],s=0;s<u;s++)et.printChar(t,E[a+s]);o+=u}return O[n>>2]=o,0}catch(t){return\\\"undefined\\\"!=typeof FS&&t instanceof FS.ErrnoError||xe(t),-t.errno}}.apply(null,arguments)},v:function(t,e,r,n,o){var i=rt(r);gt(t,{name:e=ot(e),fromWireType:function(t){return!!t},toWireType:function(t,e){return e?n:o},argPackAdvance:8,readValueFromPointer:function(t){var n;if(1===r)n=A;else if(2===r)n=F;else{if(4!==r)throw new TypeError(\\\"Unknown boolean type size: \\\"+e);n=O}return this.fromWireType(n[t>>i])},destructorFunction:null})},N:function(t,e,r,n,o,i,a,u,s,c,l,f,p){l=ot(l),i=te(o,i),u&&(u=te(a,u)),c&&(c=te(s,c)),p=te(f,p);var d=lt(l);It(d,function(){ne(\\\"Cannot construct \\\"+l+\\\" due to unbound types\\\",[n])}),mt([t,e,r],n?[n]:[],function(e){var r,o;e=e[0],o=n?(r=e.registeredClass).instancePrototype:Wt.prototype;var a=ft(d,function(){if(Object.getPrototypeOf(this)!==s)throw new dt(\\\"Use 'new' to construct \\\"+l);if(void 0===f.constructor_body)throw new dt(l+\\\" has no accessible constructor\\\");var t=f.constructor_body[arguments.length];if(void 0===t)throw new dt(\\\"Tried to invoke ctor of \\\"+l+\\\" with invalid number of parameters (\\\"+arguments.length+\\\") - expected (\\\"+Object.keys(f.constructor_body).toString()+\\\") parameters instead!\\\");return t.apply(this,arguments)}),s=Object.create(o,{constructor:{value:a}});a.prototype=s;var f=new Rt(l,a,s,p,r,i,u,c),h=new Kt(l,f,!0,!1,!1),y=new Kt(l+\\\"*\\\",f,!1,!1,!1),v=new Kt(l+\\\" const*\\\",f,!1,!0,!1);return kt[t]={pointerType:y,constPointerType:v},Qt(d,a),[h,y,v]})},M:function(t,e,r,n,o,i){var a=oe(e,r);o=te(n,o),mt([],[t],function(t){var r=\\\"constructor \\\"+(t=t[0]).name;if(void 0===t.registeredClass.constructor_body&&(t.registeredClass.constructor_body=[]),void 0!==t.registeredClass.constructor_body[e-1])throw new dt(\\\"Cannot register multiple constructors with identical number of parameters (\\\"+(e-1)+\\\") for class '\\\"+t.name+\\\"'! Overload resolution is currently only performed using the parameter count, not actual type info!\\\");return t.registeredClass.constructor_body[e-1]=function(){ne(\\\"Cannot construct \\\"+t.name+\\\" due to unbound types\\\",a)},mt([],a,function(n){return t.registeredClass.constructor_body[e-1]=function(){arguments.length!==e-1&&ht(r+\\\" called with \\\"+arguments.length+\\\" arguments, expected \\\"+(e-1));var t=[],a=new Array(e);a[0]=i;for(var u=1;u<e;++u)a[u]=n[u].toWireType(t,arguments[u-1]);var s=o.apply(null,a);return ie(t),n[0].fromWireType(s)},[]}),[]})},g:function(t,e,r,n,o,i,a,u){var s=oe(r,n);e=ot(e),i=te(o,i),mt([],[t],function(t){var n=(t=t[0]).name+\\\".\\\"+e;function o(){ne(\\\"Cannot call \\\"+n+\\\" due to unbound types\\\",s)}u&&t.registeredClass.pureVirtualFunctions.push(e);var c=t.registeredClass.instancePrototype,l=c[e];return void 0===l||void 0===l.overloadTable&&l.className!==t.name&&l.argCount===r-2?(o.argCount=r-2,o.className=t.name,c[e]=o):(xt(c,e,n),c[e].overloadTable[r-2]=o),mt([],s,function(o){var u=ue(n,o,t,i,a);return void 0===c[e].overloadTable?(u.argCount=r-2,c[e]=u):c[e].overloadTable[r-2]=u,[]}),[]})},L:function(t,e){gt(t,{name:e=ot(e),fromWireType:function(t){var e=ce[t].value;return le(t),e},toWireType:function(t,e){return de(e)},argPackAdvance:8,readValueFromPointer:Lt,destructorFunction:null})},u:function(t,e,r){var n=rt(r);gt(t,{name:e=ot(e),fromWireType:function(t){return t},toWireType:function(t,e){if(\\\"number\\\"!=typeof e&&\\\"boolean\\\"!=typeof e)throw new TypeError('Cannot convert \\\"'+he(e)+'\\\" to '+this.name);return e},argPackAdvance:8,readValueFromPointer:ye(e,n),destructorFunction:null})},K:function(t,e,r,n,o,i){var a=oe(e,r);t=ot(t),o=te(n,o),It(t,function(){ne(\\\"Cannot call \\\"+t+\\\" due to unbound types\\\",a)},e-1),mt([],a,function(r){var n=[r[0],null].concat(r.slice(1));return Qt(t,ue(t,n,null,o,i),e-1),[]})},f:function(t,e,r,n,o){e=ot(e),-1===o&&(o=4294967295);var i=rt(r),a=function(t){return t};if(0===n){var u=32-8*r;a=function(t){return t<<u>>>u}}var s=-1!=e.indexOf(\\\"unsigned\\\");gt(t,{name:e,fromWireType:a,toWireType:function(t,r){if(\\\"number\\\"!=typeof r&&\\\"boolean\\\"!=typeof r)throw new TypeError('Cannot convert \\\"'+he(r)+'\\\" to '+this.name);if(r<n||r>o)throw new TypeError('Passing a number \\\"'+he(r)+'\\\" from JS side to C/C++ side to an argument of type \\\"'+e+'\\\", which is outside the valid range ['+n+\\\", \\\"+o+\\\"]!\\\");return s?r>>>0:0|r},argPackAdvance:8,readValueFromPointer:ve(e,i,0!==n),destructorFunction:null})},e:function(t,e,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][e];function o(t){var e=j,r=e[t>>=2],o=e[t+1];return new n(e.buffer,o,r)}gt(t,{name:r=ot(r),fromWireType:o,argPackAdvance:8,readValueFromPointer:o},{ignoreDuplicateRegistrations:!0})},t:function(t,e){var r=\\\"std::string\\\"===(e=ot(e));gt(t,{name:e,fromWireType:function(t){var e,n=j[t>>2];if(r){var o=E[t+4+n],i=0;0!=o&&(i=o,E[t+4+n]=0);for(var a=t+4,u=0;u<=n;++u){var s=t+4+u;if(0==E[s]){var c=R(a);void 0===e?e=c:(e+=String.fromCharCode(0),e+=c),a=s+1}}0!=i&&(E[t+4+n]=i)}else{var l=new Array(n);for(u=0;u<n;++u)l[u]=String.fromCharCode(E[t+4+u]);e=l.join(\\\"\\\")}return Oe(t),e},toWireType:function(t,e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var n=\\\"string\\\"==typeof e;n||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int8Array||ht(\\\"Cannot pass non-string to std::string\\\");var o=(r&&n?function(){return function(t){for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&t.charCodeAt(++r)),n<=127?++e:e+=n<=2047?2:n<=65535?3:4}return e}(e)}:function(){return e.length})(),i=je(4+o+1);if(j[i>>2]=o,r&&n)!function(t,e,r,n){if(!(n>0))return 0;for(var o=r+n-1,i=0;i<t.length;++i){var a=t.charCodeAt(i);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&t.charCodeAt(++i)),a<=127){if(r>=o)break;e[r++]=a}else if(a<=2047){if(r+1>=o)break;e[r++]=192|a>>6,e[r++]=128|63&a}else if(a<=65535){if(r+2>=o)break;e[r++]=224|a>>12,e[r++]=128|a>>6&63,e[r++]=128|63&a}else{if(r+3>=o)break;e[r++]=240|a>>18,e[r++]=128|a>>12&63,e[r++]=128|a>>6&63,e[r++]=128|63&a}}e[r]=0}(e,E,i+4,o+1);else if(n)for(var a=0;a<o;++a){var u=e.charCodeAt(a);u>255&&(Oe(i),ht(\\\"String has UTF-16 code units that do not fit in 8 bits\\\")),E[i+4+a]=u}else for(a=0;a<o;++a)E[i+4+a]=e[a];return null!==t&&t.push(Oe,i),i},argPackAdvance:8,readValueFromPointer:Lt,destructorFunction:function(t){Oe(t)}})},J:function(t,e,r){var n,o;r=ot(r),2===e?(n=function(){return S},o=1):4===e&&(n=function(){return j},o=2),gt(t,{name:r,fromWireType:function(t){for(var e=n(),r=j[t>>2],i=new Array(r),a=t+4>>o,u=0;u<r;++u)i[u]=String.fromCharCode(e[a+u]);return Oe(t),i.join(\\\"\\\")},toWireType:function(t,r){var i=n(),a=r.length,u=je(4+a*e);j[u>>2]=a;for(var s=u+4>>o,c=0;c<a;++c)i[s+c]=r.charCodeAt(c);return null!==t&&t.push(Oe,u),u},argPackAdvance:8,readValueFromPointer:Lt,destructorFunction:function(t){Oe(t)}})},H:function(t,e){gt(t,{isVoid:!0,name:e=ot(e),argPackAdvance:0,fromWireType:function(){},toWireType:function(t,e){}})},s:function(t,e,r){t=me(t),e=ge(e,\\\"emval::as\\\");var n=[],o=de(n);return O[r>>2]=o,e.toWireType(n,t)},r:function(t,e,r,n){(t=Te[t])(e=me(e),r=we(r),null,n)},b:le,G:function(t){return 0===t?de(Ce()):(t=we(t),de(Ce()[t]))},q:function(t,e){for(var r=function(t,e,r){for(var n=new Array(t),o=0;o<t;++o)n[o]=ge(O[(e>>2)+o],\\\"parameter \\\"+o);return n}(t,e),n=r[0],o=n.name+\\\"_$\\\"+r.slice(1).map(function(t){return t.name}).join(\\\"_\\\")+\\\"$\\\",i=[\\\"retType\\\"],a=[n],u=\\\"\\\",s=0;s<t-1;++s)u+=(0!==s?\\\", \\\":\\\"\\\")+\\\"arg\\\"+s,i.push(\\\"argType\\\"+s),a.push(r[1+s]);var c=\\\"return function \\\"+lt(\\\"methodCaller_\\\"+o)+\\\"(handle, name, destructors, args) {\\\\n\\\",l=0;for(s=0;s<t-1;++s)c+=\\\"    var arg\\\"+s+\\\" = argType\\\"+s+\\\".readValueFromPointer(args\\\"+(l?\\\"+\\\"+l:\\\"\\\")+\\\");\\\\n\\\",l+=r[s+1].argPackAdvance;for(c+=\\\"    var rv = handle[name](\\\"+u+\\\");\\\\n\\\",s=0;s<t-1;++s)r[s+1].deleteObject&&(c+=\\\"    argType\\\"+s+\\\".deleteObject(arg\\\"+s+\\\");\\\\n\\\");n.isVoid||(c+=\\\"    return retType.toWireType(destructors, rv);\\\\n\\\"),c+=\\\"};\\\\n\\\",i.push(c);var f,p,d=ae(Function,i).apply(null,a);return f=d,p=Te.length,Te.push(f),p},p:function(t){return t=we(t),de(a[t])},k:function(t,e){return de((t=me(t))[e=me(e)])},l:function(t){t>4&&(ce[t].refcount+=1)},o:function(t,e,r,n){t=me(t);var o=$e[e];return o||(o=function(t){for(var e=\\\"\\\",r=0;r<t;++r)e+=(0!==r?\\\", \\\":\\\"\\\")+\\\"arg\\\"+r;var n=\\\"return function emval_allocator_\\\"+t+\\\"(constructor, argTypes, args) {\\\\n\\\";for(r=0;r<t;++r)n+=\\\"var argType\\\"+r+\\\" = requireRegisteredType(Module['HEAP32'][(argTypes >> 2) + \\\"+r+'], \\\"parameter '+r+'\\\");\\\\nvar arg'+r+\\\" = argType\\\"+r+\\\".readValueFromPointer(args);\\\\nargs += argType\\\"+r+\\\"['argPackAdvance'];\\\\n\\\";return n+=\\\"var obj = new constructor(\\\"+e+\\\");\\\\nreturn __emval_register(obj);\\\\n}\\\\n\\\",new Function(\\\"requireRegisteredType\\\",\\\"Module\\\",\\\"__emval_register\\\",n)(ge,a,de)}(e),$e[e]=o),o(t,r,n)},j:function(t){return de(we(t))},n:function(t){ie(ce[t].value),le(t)},d:function(){a.abort()},F:Pe,E:function(t,e,r){E.set(E.subarray(e,e+r),t)},D:function(t){var e=Pe();if(t>2147418112)return!1;for(var r=Math.max(e,16777216);r<t;)r=r<=536870912?D(2*r,65536):Math.min(D((3*r+2147483648)/4,65536),2147418112);return!!function(t){try{return T.grow(t-_.byteLength+65535>>16),U(T.buffer),1}catch(t){}}(r)},C:function(){xe(\\\"trap!\\\")},B:function(t){xe(\\\"OOM\\\")},a:239456},Ae=a.asm({},_e,_);a.asm=Ae;var Ee,Fe=a.__ZSt18uncaught_exceptionv=function(){return a.asm.O.apply(null,arguments)},Se=(a.___embind_register_native_and_builtin_types=function(){return a.asm.P.apply(null,arguments)},a.___errno_location=function(){return a.asm.Q.apply(null,arguments)},a.___getTypeName=function(){return a.asm.R.apply(null,arguments)}),Oe=a._free=function(){return a.asm.S.apply(null,arguments)},je=a._malloc=function(){return a.asm.T.apply(null,arguments)},We=a.globalCtors=function(){return a.asm.ha.apply(null,arguments)};function ke(t){function e(){Ee||(Ee=!0,$||(M(N),M(H),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function(){if(a.postRun)for(\\\"function\\\"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)t=a.postRun.shift(),z.unshift(t);var t;M(z)}()))}t=t||l,V>0||(function(){if(a.preRun)for(\\\"function\\\"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)t=a.preRun.shift(),L.unshift(t);var t;M(L)}(),V>0||(a.setStatus?(a.setStatus(\\\"Running...\\\"),setTimeout(function(){setTimeout(function(){a.setStatus(\\\"\\\")},1),e()},1)):e()))}function xe(t){throw a.onAbort&&a.onAbort(t),g(t+=\\\"\\\"),b(t),$=!0,\\\"abort(\\\"+t+\\\"). Build with -s ASSERTIONS=1 for more info.\\\"}if(a.dynCall_ii=function(){return a.asm.U.apply(null,arguments)},a.dynCall_iidiiii=function(){return a.asm.V.apply(null,arguments)},a.dynCall_iii=function(){return a.asm.W.apply(null,arguments)},a.dynCall_iiii=function(){return a.asm.X.apply(null,arguments)},a.dynCall_iiiii=function(){return a.asm.Y.apply(null,arguments)},a.dynCall_iiiiii=function(){return a.asm.Z.apply(null,arguments)},a.dynCall_iiiiiiii=function(){return a.asm._.apply(null,arguments)},a.dynCall_iiiiiiiii=function(){return a.asm.$.apply(null,arguments)},a.dynCall_jiji=function(){return a.asm.aa.apply(null,arguments)},a.dynCall_v=function(){return a.asm.ba.apply(null,arguments)},a.dynCall_vi=function(){return a.asm.ca.apply(null,arguments)},a.dynCall_vii=function(){return a.asm.da.apply(null,arguments)},a.dynCall_viiii=function(){return a.asm.ea.apply(null,arguments)},a.dynCall_viiiii=function(){return a.asm.fa.apply(null,arguments)},a.dynCall_viiiiii=function(){return a.asm.ga.apply(null,arguments)},a.asm=Ae,a.then=function(t){if(Ee)t(a);else{var e=a.onRuntimeInitialized;a.onRuntimeInitialized=function(){e&&e(),t(a)}}return a},G=function t(){Ee||ke(),Ee||(G=t)},a.run=ke,a.abort=xe,a.preInit)for(\\\"function\\\"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return ke(),t});t.exports=s,onmessage=function(t){var e,r,n=t.data;switch(n.type){case\\\"init\\\":i=n.config,e=n.transcoderBinary,a=new Promise(t=>{s(r={wasmBinary:e,onRuntimeInitialized:t})}).then(()=>{var{BasisFile:t,initializeBasis:e}=r;u=t,e()});break;case\\\"transcode\\\":a.then(()=>{try{for(var{width:t,height:e,hasAlpha:r,mipmaps:o,format:a}=function(t){var e=new u(new Uint8Array(t)),r=e.getImageWidth(0,0),n=e.getImageHeight(0,0),o=e.getNumLevels(0),a=e.getHasAlpha();function s(){e.close(),e.delete()}if(!a)switch(i.format){case 9:i.format=8}if(!r||!n||!o)throw s(),new Error(\\\"THREE.BasisTextureLoader:  Invalid .basis file\\\");if(!e.startTranscoding())throw s(),new Error(\\\"THREE.BasisTextureLoader: .startTranscoding failed\\\");for(var c=[],l=0;l<o;l++){var f=e.getImageWidth(0,l),p=e.getImageHeight(0,l),d=new Uint8Array(e.getImageTranscodedSizeInBytes(0,l,i.format)),h=e.transcodeImage(d,0,l,i.format,a,0);if(!h)throw s(),new Error(\\\"THREE.BasisTextureLoader: .transcodeImage failed.\\\");c.push({data:d,width:f,height:p})}return s(),{width:r,height:n,hasAlpha:a,mipmaps:c,format:i.format}}(n.buffer),s=[],c=0;c<o.length;++c)s.push(o[c].data.buffer);i.returnBuffer&&s.push(n.buffer),self.postMessage({type:\\\"transcode\\\",id:n.id,width:t,height:e,hasAlpha:r,mipmaps:o,format:a,buffer:i.returnBuffer?n.buffer:null},s)}catch(t){console.error(t),self.postMessage({type:\\\"error\\\",id:n.id,error:t.message})}})}}}).call(this,r(0),\\\"/\\\")},function(t,e){},function(t,e,r){(function(t){function r(t,e){for(var r=0,n=t.length-1;n>=0;n--){var o=t[n];\\\".\\\"===o?t.splice(n,1):\\\"..\\\"===o?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r--;r)t.unshift(\\\"..\\\");return t}var n=/^(\\\\/?|)([\\\\s\\\\S]*?)((?:\\\\.{1,2}|[^\\\\/]+?|)(\\\\.[^.\\\\/]*|))(?:[\\\\/]*)$/,o=function(t){return n.exec(t).slice(1)};function i(t,e){if(t.filter)return t.filter(e);for(var r=[],n=0;n<t.length;n++)e(t[n],n,t)&&r.push(t[n]);return r}e.resolve=function(){for(var e=\\\"\\\",n=!1,o=arguments.length-1;o>=-1&&!n;o--){var a=o>=0?arguments[o]:t.cwd();if(\\\"string\\\"!=typeof a)throw new TypeError(\\\"Arguments to path.resolve must be strings\\\");a&&(e=a+\\\"/\\\"+e,n=\\\"/\\\"===a.charAt(0))}return(n?\\\"/\\\":\\\"\\\")+(e=r(i(e.split(\\\"/\\\"),function(t){return!!t}),!n).join(\\\"/\\\"))||\\\".\\\"},e.normalize=function(t){var n=e.isAbsolute(t),o=\\\"/\\\"===a(t,-1);return(t=r(i(t.split(\\\"/\\\"),function(t){return!!t}),!n).join(\\\"/\\\"))||n||(t=\\\".\\\"),t&&o&&(t+=\\\"/\\\"),(n?\\\"/\\\":\\\"\\\")+t},e.isAbsolute=function(t){return\\\"/\\\"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(i(t,function(t,e){if(\\\"string\\\"!=typeof t)throw new TypeError(\\\"Arguments to path.join must be strings\\\");return t}).join(\\\"/\\\"))},e.relative=function(t,r){function n(t){for(var e=0;e<t.length&&\\\"\\\"===t[e];e++);for(var r=t.length-1;r>=0&&\\\"\\\"===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=e.resolve(t).substr(1),r=e.resolve(r).substr(1);for(var o=n(t.split(\\\"/\\\")),i=n(r.split(\\\"/\\\")),a=Math.min(o.length,i.length),u=a,s=0;s<a;s++)if(o[s]!==i[s]){u=s;break}var c=[];for(s=u;s<o.length;s++)c.push(\\\"..\\\");return(c=c.concat(i.slice(u))).join(\\\"/\\\")},e.sep=\\\"/\\\",e.delimiter=\\\":\\\",e.dirname=function(t){var e=o(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):\\\".\\\"},e.basename=function(t,e){var r=o(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},e.extname=function(t){return o(t)[3]};var a=\\\"b\\\"===\\\"ab\\\".substr(-1)?function(t,e,r){return t.substr(e,r)}:function(t,e,r){return e<0&&(e=t.length+e),t.substr(e,r)}}).call(this,r(0))}]);\\n//# sourceMappingURL=basis_transcoder.worker-95a71f078806021bd3c4.js.map\", \"/\" + \"assets/js/basis_transcoder.worker-95a71f078806021bd3c4.js\");\n};","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posx-d235fb97df77b607be04b84125f40e7c.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negx-35034574e114423babdea92b6a2eb97a.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posy-d0c4e1e7979d75923d4d8b49c191bc6e.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negy-35808d21d1d17ac1b84d3184e365093b.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posz-de29aa8396196e4b040cd5305e351dbe.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negz-d73d18a8b7994524dc39a6ea3fcf43fc.jpg\";","import Store from \"./storage/store\";\r\nimport MediaSearchStore from \"./storage/media-search-store\";\r\n\r\nexport class App {\r\n  constructor() {\r\n    this.scene = null;\r\n    this.quality = \"low\";\r\n    this.store = new Store();\r\n    this.mediaSearchStore = new MediaSearchStore();\r\n  }\r\n\r\n  setQuality(quality) {\r\n    if (this.quality === quality) {\r\n      return false;\r\n    }\r\n\r\n    this.quality = quality;\r\n\r\n    if (this.scene) {\r\n      this.scene.dispatchEvent(new CustomEvent(\"quality-changed\", { detail: quality }));\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","import React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { injectIntl, FormattedMessage } from \"react-intl\";\r\nimport classNames from \"classnames\";\r\nimport \"three/examples/js/controls/OrbitControls\";\r\n\r\nimport { createDefaultEnvironmentMap } from \"../components/environment-map\";\r\nimport { loadGLTF } from \"../components/gltf-model-plus\";\r\nimport { disposeNode, findNode } from \"../utils/three-utils\";\r\nimport { ensureAvatarMaterial, MAT_NAME } from \"../utils/avatar-utils\";\r\nimport { createImageBitmap, disposeImageBitmap } from \"../utils/image-bitmap-utils\";\r\nimport styles from \"../assets/stylesheets/avatar-preview.scss\";\r\n\r\nconst TEXTURE_PROPS = {\r\n  base_map: [\"map\"],\r\n  emissive_map: [\"emissiveMap\"],\r\n  normal_map: [\"normalMap\"],\r\n  orm_map: [\"aoMap\", \"roughnessMap\", \"metalnessMap\"]\r\n};\r\n\r\nconst ALL_MAPS = Object.keys(TEXTURE_PROPS);\r\n\r\n// This should match our aframe renderer=\"antialias: true; colorManagement: true; sortObjects: true;\r\n// physicallyCorrectLights: true; webgl2: true; multiview: false;\"\r\nfunction createRenderer(canvas, alpha = false, useDevicePixelRatio = true) {\r\n  const context = canvas.getContext(\"webgl2\", {\r\n    alpha,\r\n    depth: true,\r\n    antialias: true,\r\n    premultipliedAlpha: true,\r\n    preserveDrawingBuffer: false,\r\n    powerPreference: \"default\"\r\n  });\r\n\r\n  const renderer = new THREE.WebGLRenderer({ alpha, canvas, context, forceWebVR: true });\r\n  renderer.gammaOutput = true;\r\n  renderer.gammaFactor = 2.2;\r\n  renderer.physicallyCorrectLights = true;\r\n  if (useDevicePixelRatio) {\r\n    renderer.setPixelRatio(window.devicePixelRatio);\r\n  }\r\n  return renderer;\r\n}\r\n\r\nconst createImageBitmapFromURL = url =>\r\n  fetch(url)\r\n    .then(r => r.blob())\r\n    .then(createImageBitmap);\r\n\r\nconst ORBIT_ANGLE = new THREE.Euler(-30 * THREE.Math.DEG2RAD, 30 * THREE.Math.DEG2RAD, 0);\r\nconst DEFAULT_MARGIN = 1;\r\n\r\nfunction fitBoxInFrustum(camera, box, center, margin = DEFAULT_MARGIN) {\r\n  const halfYExtents = Math.max(box.max.y - center.y, center.y - box.min.y);\r\n  const halfVertFOV = THREE.Math.degToRad(camera.fov / 2);\r\n  camera.position.set(0, 0, (halfYExtents / Math.tan(halfVertFOV) + box.max.z) * margin);\r\n  camera.position.applyEuler(ORBIT_ANGLE);\r\n  camera.position.add(center);\r\n  camera.lookAt(center);\r\n}\r\n\r\nclass AvatarPreview extends Component {\r\n  static propTypes = {\r\n    avatarGltfUrl: PropTypes.string,\r\n    className: PropTypes.string,\r\n    onGltfLoaded: PropTypes.func\r\n  };\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { loading: true, error: null };\r\n    this.avatar = null;\r\n    this.imageBitmaps = {};\r\n  }\r\n\r\n  componentDidMount = () => {\r\n    this.scene = new THREE.Scene();\r\n\r\n    this.camera = new THREE.PerspectiveCamera(55, this.canvas.clientWidth / this.canvas.clientHeight, 0.1, 1000);\r\n    this.controls = new THREE.OrbitControls(this.camera, this.canvas);\r\n    this.controls.enablePan = false;\r\n\r\n    const light = new THREE.DirectionalLight(0xf7f6ef, 1);\r\n    light.position.set(0, 10, 10);\r\n    this.scene.add(light);\r\n    this.scene.add(new THREE.HemisphereLight(0xb1e3ff, 0xb1e3ff, 2.5));\r\n\r\n    this.loadId = 0;\r\n\r\n    this.camera.position.set(-0.2, 0.5, 0.5);\r\n    this.camera.matrixAutoUpdate = true;\r\n\r\n    this.controls.target.set(0, 0.45, 0);\r\n    this.controls.update();\r\n\r\n    if (this.props.avatarGltfUrl) {\r\n      this.loadCurrentAvatarGltfUrl();\r\n    }\r\n\r\n    const clock = new THREE.Clock();\r\n\r\n    this.snapshotCanvas = document.createElement(\"canvas\");\r\n    this.snapshotCanvas.width = 720;\r\n    this.snapshotCanvas.height = 1280;\r\n    this.snapshotCamera = new THREE.PerspectiveCamera(55, 720 / 1280, 0.1, 1000);\r\n    this.snapshotCamera.matrixAutoUpdate = true;\r\n    this.snapshotRenderer = createRenderer(this.snapshotCanvas, true, false);\r\n    this.snapshotRenderer.setClearAlpha(0);\r\n\r\n    this.previewRenderer = createRenderer(this.canvas);\r\n    this.previewRenderer.setClearColor(0xeaeaea);\r\n    this.previewRenderer.setAnimationLoop(() => {\r\n      const dt = clock.getDelta();\r\n      this.mixer && this.mixer.update(dt);\r\n      this.previewRenderer.render(this.scene, this.camera);\r\n    });\r\n    window.addEventListener(\"resize\", this.resize);\r\n    this.resize();\r\n  };\r\n\r\n  resize = () => {\r\n    const width = this.canvas.parentElement.offsetWidth;\r\n    const height = this.canvas.parentElement.offsetHeight;\r\n    this.previewRenderer.setSize(width, height);\r\n    this.camera.aspect = width / height;\r\n    this.camera.updateProjectionMatrix();\r\n  };\r\n\r\n  setAvatar = avatar => {\r\n    if (!avatar) return;\r\n    this.avatar = avatar;\r\n    this.scene.add(avatar);\r\n    this.resetCamera();\r\n    this.setState({ error: null, loading: false });\r\n  };\r\n\r\n  resetCamera = (() => {\r\n    const box = new THREE.Box3();\r\n    const center = new THREE.Vector3();\r\n    return () => {\r\n      box.setFromObject(this.avatar);\r\n      box.getCenter(center);\r\n\r\n      // Shift the center vertically in order to frame the avatar nicely.\r\n      center.y = (box.max.y - box.min.y) * 0.6 + box.min.y;\r\n\r\n      fitBoxInFrustum(this.camera, box, center);\r\n      fitBoxInFrustum(this.snapshotCamera, box, center, 0.7);\r\n\r\n      this.controls.target.copy(center);\r\n      this.controls.update();\r\n    };\r\n  })();\r\n\r\n  componentWillUnmount = () => {\r\n    // Gotta be particularly careful about disposing things here since we will likely create many avatar\r\n    // previews during a session and Chrome will eventually discard the oldest webgl context if we leak\r\n    // contexts by holding on to them directly or indirectly.\r\n\r\n    this.scene && this.scene.traverse(disposeNode);\r\n    if (this.previewRenderer) {\r\n      this.previewRenderer.dispose();\r\n      this.previewRenderer.context = null;\r\n    }\r\n    if (this.snapshotRenderer) {\r\n      this.snapshotRenderer.dispose();\r\n      this.snapshotRenderer.context = null;\r\n    }\r\n    if (this.controls) {\r\n      this.controls.dispose();\r\n      this.controls.domElement = null;\r\n    }\r\n\r\n    Object.values(this.imageBitmaps).forEach(img => disposeImageBitmap(img));\r\n    window.removeEventListener(\"resize\", this.resize);\r\n  };\r\n\r\n  componentDidUpdate = async oldProps => {\r\n    if (oldProps.avatarGltfUrl !== this.props.avatarGltfUrl) {\r\n      if (this.avatar) {\r\n        this.scene.remove(this.avatar);\r\n        this.avatar = null;\r\n      }\r\n      if (this.props.avatarGltfUrl) {\r\n        this.setState({ error: null, loading: true });\r\n        await this.loadCurrentAvatarGltfUrl();\r\n      }\r\n    }\r\n    this.applyMaps(oldProps, this.props);\r\n  };\r\n\r\n  async loadCurrentAvatarGltfUrl() {\r\n    const newLoadId = ++this.loadId;\r\n    const gltf = await this.loadPreviewAvatar(this.props.avatarGltfUrl);\r\n    // If we had started loading another avatar while we were loading this one, throw this one away\r\n    if (newLoadId !== this.loadId) return;\r\n    if (gltf && this.props.onGltfLoaded) this.props.onGltfLoaded(gltf);\r\n    this.setAvatar(gltf.scene);\r\n  }\r\n\r\n  applyMaps(oldProps, newProps) {\r\n    return Promise.all(\r\n      ALL_MAPS.map(mapName => {\r\n        const applyMap = this.applyMapToPreview.bind(this, mapName);\r\n        if (oldProps[mapName] != newProps[mapName]) {\r\n          if (newProps[mapName] instanceof File) {\r\n            return createImageBitmap(newProps[mapName]).then(applyMap);\r\n          } else if (newProps[mapName]) {\r\n            return createImageBitmapFromURL(newProps[mapName]).then(applyMap);\r\n          } else {\r\n            return this.revertMap(mapName);\r\n          }\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  loadPreviewAvatar = async avatarGltfUrl => {\r\n    let gltf;\r\n    try {\r\n      const technique = window.APP.quality === \"low\" ? \"KHR_materials_unlit\" : \"pbrMetallicRoughness\";\r\n      gltf = await loadGLTF(avatarGltfUrl, \"model/gltf\", technique, null, ensureAvatarMaterial);\r\n    } catch (e) {\r\n      console.error(\"Failed to load avatar preview\", e);\r\n      this.setState({ loading: false, error: true });\r\n      return;\r\n    }\r\n\r\n    // TODO Check for \"Bot_Skinned\" here is a hack for legacy avatars which only has a name one of the MOZ_alt_material nodes\r\n    this.previewMesh = findNode(\r\n      gltf.scene,\r\n      n => (n.isMesh && n.material && n.material.name === MAT_NAME) || n.name === \"Bot_Skinned\"\r\n    );\r\n\r\n    if (!this.previewMesh) {\r\n      console.error(\"Failed to find avatar preview mesh\");\r\n      this.setState({ loading: false, error: true });\r\n      return;\r\n    }\r\n\r\n    const idleAnimation = gltf.animations && gltf.animations.find(({ name }) => name === \"idle_eyes\");\r\n    if (idleAnimation) {\r\n      this.mixer = new THREE.AnimationMixer(gltf.scene);\r\n      const action = this.mixer.clipAction(idleAnimation);\r\n      action.enabled = true;\r\n      action.setLoop(THREE.LoopRepeat, Infinity).play();\r\n      this.idleAnimationAction = action;\r\n    }\r\n\r\n    const { material } = this.previewMesh;\r\n    if (material) {\r\n      // We delete onUpdate here to opt out of the auto texture cleanup after GPU upload.\r\n      const getImage = p => material[p] && delete material[p].onUpdate && material[p].image;\r\n      this.originalMaps = {\r\n        base_map: TEXTURE_PROPS[\"base_map\"].map(getImage),\r\n        emissive_map: TEXTURE_PROPS[\"emissive_map\"].map(getImage),\r\n        normal_map: TEXTURE_PROPS[\"normal_map\"].map(getImage),\r\n        orm_map: TEXTURE_PROPS[\"orm_map\"].map(getImage)\r\n      };\r\n\r\n      await Promise.all([\r\n        this.applyMaps({}, this.props), // Apply initial maps\r\n        createDefaultEnvironmentMap().then(t => {\r\n          this.previewMesh.material.envMap = t;\r\n          this.previewMesh.material.needsUpdate = true;\r\n        })\r\n      ]);\r\n    } else {\r\n      this.originalMaps = {};\r\n    }\r\n\r\n    return gltf;\r\n  };\r\n\r\n  applyMapToPreview = (name, image) => {\r\n    if (this.imageBitmaps[name]) {\r\n      disposeImageBitmap(this.imageBitmaps[name]);\r\n    }\r\n    this.imageBitmaps[name] = image;\r\n    TEXTURE_PROPS[name].forEach(prop => {\r\n      const texture = this.previewMesh.material[prop];\r\n      texture.image = image;\r\n      texture.needsUpdate = true;\r\n    });\r\n  };\r\n\r\n  revertMap = name => {\r\n    if (this.imageBitmaps[name]) {\r\n      disposeImageBitmap(this.imageBitmaps[name]);\r\n    }\r\n    delete this.imageBitmaps[name];\r\n    this.originalMaps[name].forEach((bm, i) => {\r\n      const texture = this.previewMesh.material[TEXTURE_PROPS[name][i]];\r\n      texture.image = bm;\r\n      texture.needsUpdate = true;\r\n    });\r\n  };\r\n\r\n  snapshot = () => {\r\n    return new Promise(resolve => {\r\n      if (this.idleAnimationAction) this.idleAnimationAction.stop();\r\n      this.snapshotRenderer.render(this.scene, this.snapshotCamera);\r\n      this.snapshotCanvas.toBlob(blob => {\r\n        if (this.idleAnimationAction) this.idleAnimationAction.play();\r\n        resolve(blob);\r\n      });\r\n    });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className={classNames(styles.preview, this.props.className)}>\r\n        {!this.props.avatarGltfUrl ||\r\n          (this.state.loading &&\r\n            !this.state.error && (\r\n              <div className=\"loader\">\r\n                <div className=\"loader-center\" />\r\n              </div>\r\n            ))}\r\n        {this.props.avatarGltfUrl &&\r\n          (this.state.error && !this.state.loading) && (\r\n            <div className=\"error\">\r\n              <img\r\n                src=\"../assets/images/warning_icon.png\"\r\n                srcSet=\"../assets/images/warning_icon@2x.png 2x\"\r\n                className=\"error-icon\"\r\n              />\r\n              <FormattedMessage id=\"avatar-preview.loading-failed\" />\r\n            </div>\r\n          )}\r\n        <canvas ref={c => (this.canvas = c)} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default injectIntl(AvatarPreview, { withRef: true });\r\n","const qs = new URLSearchParams(location.search);\r\n\r\nexport default function qsTruthy(param) {\r\n  const val = qs.get(param);\r\n  // if the param exists but is not set (e.g. \"?foo&bar\"), its value is the empty string.\r\n  return val === \"\" || /1|on|true|yes/i.test(val);\r\n}\r\n\r\nexport function qsGet(param) {\r\n  return qs.get(param);\r\n}\r\n","/*\r\nHACK Fix a-frame's device detection in Chrome when WebXR or WebVR flags are enabled in\r\nchrome://flags. See https://github.com/mozilla/hubs/issues/892\r\n*/\r\nif (!/Oculus/.test(navigator.userAgent) && navigator.xr && !navigator.xr.requestDevice) {\r\n  navigator.xr.requestDevice = () => Promise.reject({ message: \"Hubs: requestDevice not supported.\" });\r\n}\r\n/*\r\nHACK Call getVRDisplays to force Oculus Browser to use WebVR, which in turn disables the WebXR API.\r\n*/\r\nif (/Oculus/.test(navigator.userAgent)) {\r\n  navigator.getVRDisplays();\r\n}\r\n","module.exports = __webpack_public_path__ + \"assets/images/warning_icon@2x-706e4a4db33f9456bac320e956b4120d.png\";","// A-Frame blows away any npm debug log filters so this allow the user to set the log filter\r\n// via the query string.\r\nimport debug from \"debug\";\r\nimport qsTruthy from \"./qs_truthy\";\r\n\r\nconst qs = new URLSearchParams(location.search);\r\nconst isDebug = qsTruthy(\"debug\");\r\nconst logFilter = qs.get(\"log_filter\") || (isDebug && \"naf-janus-adapter:*\");\r\n\r\nif (logFilter) {\r\n  debug.enable(logFilter);\r\n}\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"preview\":\"avatar-preview__preview__3UraQ\"};","// Enumeration of spawned object content origins. URL means the content is\r\n// fetched from a URL, FILE means it was an uploaded/dropped file, and\r\n// CLIPBOARD means it was raw data pasted in from the clipboard, SPAWNER means\r\n// it was copied over from a spawner.\r\nexport const ObjectContentOrigins = {\r\n  URL: 1,\r\n  FILE: 2,\r\n  CLIPBOARD: 3,\r\n  SPAWNER: 4\r\n};\r\n\r\n// Enumeration of spawnable object types, used for telemetry, which encapsulates\r\n// both the origin of the content for the object and also the type of content\r\n// contained in the object.\r\nexport const ObjectTypes = {\r\n  URL_IMAGE: 0,\r\n  URL_VIDEO: 1,\r\n  URL_MODEL: 2,\r\n  URL_PDF: 3,\r\n  URL_AUDIO: 4,\r\n  //URL_TEXT: 5,\r\n  //URL_TELEPORTER: 6,\r\n  FILE_IMAGE: 8,\r\n  FILE_VIDEO: 9,\r\n  FILE_MODEL: 10,\r\n  FILE_PDF: 11,\r\n  FILE_AUDIO: 12,\r\n  //FILE_TEXT: 13,\r\n  CLIPBOARD_IMAGE: 16,\r\n  CLIPBOARD_VIDEO: 17,\r\n  CLIPBOARD_MODEL: 18,\r\n  CLIPBOARD_PDF: 19,\r\n  CLIPBOARD_AUDIO: 20,\r\n  //CLIPBOARD_TEXT: 21,\r\n  SPAWNER_IMAGE: 24,\r\n  SPAWNER_VIDEO: 25,\r\n  SPAWNER_MODEL: 26,\r\n  SPAWNER_PDF: 27,\r\n  SPAWNER_AUDIO: 28,\r\n  //SPAWNER_TEXT: 29,\r\n  CAMERA: 30,\r\n  UNKNOWN: 31\r\n};\r\n\r\n// Given an origin and three object type values for URL, FILE, and CLIPBOARD\r\n// origins respectively, return the appropriate one\r\nfunction objectTypeForOrigin(contentOrigin, urlType, fileType, clipboardType, spawnerType) {\r\n  if (contentOrigin === ObjectContentOrigins.URL) {\r\n    return urlType;\r\n  } else if (contentOrigin === ObjectContentOrigins.FILE) {\r\n    return fileType;\r\n  } else if (contentOrigin === ObjectContentOrigins.CLIPBOARD) {\r\n    return clipboardType;\r\n  } else {\r\n    return spawnerType;\r\n  }\r\n}\r\n\r\n// Lookup table of mime-type prefixes to the set of object types that we should use\r\n// for objects spawned matching their underlying Content-Type.\r\nconst objectTypeMimePrefixLookupMap = {\r\n  \"image/\": [ObjectTypes.URL_IMAGE, ObjectTypes.FILE_IMAGE, ObjectTypes.CLIPBOARD_IMAGE, ObjectTypes.SPAWNER_IMAGE],\r\n  \"model/\": [ObjectTypes.URL_MODEL, ObjectTypes.FILE_MODEL, ObjectTypes.CLIPBOARD_MODEL, ObjectTypes.SPAWNER_MODEL],\r\n  \"application/x-zip-compressed\": [\r\n    ObjectTypes.URL_MODEL,\r\n    ObjectTypes.FILE_MODEL,\r\n    ObjectTypes.CLIPBOARD_MODEL,\r\n    ObjectTypes.SPAWNER_MODEL\r\n  ],\r\n  \"video/\": [ObjectTypes.URL_VIDEO, ObjectTypes.FILE_VIDEO, ObjectTypes.CLIPBOARD_VIDEO, ObjectTypes.SPAWNER_VIDEO],\r\n  \"application/vnd.apple.mpegurl\": [\r\n    ObjectTypes.URL_VIDEO,\r\n    ObjectTypes.FILE_VIDEO,\r\n    ObjectTypes.CLIPBOARD_VIDEO,\r\n    ObjectTypes.SPAWNER_VIDEO\r\n  ],\r\n  \"application/x-mpegurl\": [\r\n    ObjectTypes.URL_VIDEO,\r\n    ObjectTypes.FILE_VIDEO,\r\n    ObjectTypes.CLIPBOARD_VIDEO,\r\n    ObjectTypes.SPAWNER_VIDEO\r\n  ],\r\n  \"audio/\": [ObjectTypes.URL_AUDIO, ObjectTypes.FILE_AUDIO, ObjectTypes.CLIPBOARD_AUDIO, ObjectTypes.SPAWNER_AUDIO],\r\n  \"application/pdf\": [ObjectTypes.URL_PDF, ObjectTypes.FILE_PDF, ObjectTypes.CLIPBOARD_PDF, ObjectTypes.SPAWNER_PDF]\r\n};\r\n\r\nconst srcSuffixLookupMap = {\r\n  \".m3u8\": [ObjectTypes.URL_VIDEO, ObjectTypes.FILE_VIDEO, ObjectTypes.CLIPBOARD_VIDEO, ObjectTypes.SPAWNER_VIDEO]\r\n};\r\n\r\n// Given an content origin and the resolved mime type of a piece of content, return\r\n// the ObjectType, if any, for that content.\r\nexport function objectTypeForOriginAndContentType(contentOrigin, contentType, src) {\r\n  for (const prefix in objectTypeMimePrefixLookupMap) {\r\n    if (contentType.toLowerCase().startsWith(prefix)) {\r\n      const types = objectTypeMimePrefixLookupMap[prefix];\r\n      return objectTypeForOrigin(contentOrigin, ...types);\r\n    }\r\n  }\r\n\r\n  if (src) {\r\n    for (const suffix in srcSuffixLookupMap) {\r\n      if (src.toLowerCase().endsWith(suffix)) {\r\n        const types = srcSuffixLookupMap[suffix];\r\n        return objectTypeForOrigin(contentOrigin, ...types);\r\n      }\r\n    }\r\n  }\r\n\r\n  return ObjectTypes.UNKNOWN;\r\n}\r\n","import appLogo from \"../assets/images/app-logo.png\";\r\nimport companyLogo from \"../assets/images/company-logo.png\";\r\nimport sceneEditorLogo from \"../assets/images/editor-logo.png\";\r\nimport pdfjs from \"pdfjs-dist\";\r\n\r\n// Read configs from global variable if available, otherwise use the process.env injected from build.\r\nconst configs = {};\r\nlet isAdmin = false;\r\n\r\n[\r\n  \"RETICULUM_SERVER\",\r\n  \"THUMBNAIL_SERVER\",\r\n  \"CORS_PROXY_SERVER\",\r\n  \"NON_CORS_PROXY_DOMAINS\",\r\n  \"SENTRY_DSN\",\r\n  \"GA_TRACKING_ID\",\r\n  \"SHORTLINK_DOMAIN\",\r\n  \"BASE_ASSETS_PATH\"\r\n].forEach(x => {\r\n  const el = document.querySelector(`meta[name='env:${x.toLowerCase()}']`);\r\n  configs[x] = el ? el.getAttribute(\"content\") : process.env[x];\r\n\r\n  if (x === \"BASE_ASSETS_PATH\" && configs[x]) {\r\n    // eslint-disable-next-line no-undef\r\n    __webpack_public_path__ = configs[x];\r\n\r\n    // Using external CDN to reduce build size\r\n    pdfjs.GlobalWorkerOptions.workerSrc = `${configs[x]}../assets/js/pdfjs-dist@2.1.266/build/pdf.worker.js`;\r\n  }\r\n});\r\n\r\n// Also include configs that reticulum injects as a script in the page head.\r\n\r\nconfigs.AVAILABLE_INTEGRATIONS = window.AVAILABLE_INTEGRATIONS || {};\r\n\r\nif (window.APP_CONFIG) {\r\n  configs.APP_CONFIG = window.APP_CONFIG;\r\n  const { theme } = configs.APP_CONFIG;\r\n  if (theme) {\r\n    const colorVars = [];\r\n    for (const key in theme) {\r\n      if (!theme.hasOwnProperty(key)) continue;\r\n      colorVars.push(`--${key}: ${theme[key]};`);\r\n    }\r\n    const style = document.createElement(\"style\");\r\n    style.innerHTML = `:root{${colorVars.join(\"\\n\")}}`;\r\n    document.head.prepend(style);\r\n  }\r\n\r\n  if (!configs.APP_CONFIG.features) {\r\n    configs.APP_CONFIG.features = {};\r\n  }\r\n} else {\r\n  configs.APP_CONFIG = {\r\n    features: {}\r\n  };\r\n}\r\n\r\nconst isLocalDevelopment = process.env.NODE_ENV === \"development\";\r\n\r\nconfigs.feature = featureName => {\r\n  const value = configs.APP_CONFIG.features[featureName];\r\n  if (typeof value === \"boolean\" || featureName === \"enable_spoke\") {\r\n    const enableAll = isLocalDevelopment && !process.env.USE_FEATURE_CONFIG;\r\n    const forceEnableSpoke = featureName === \"enable_spoke\" && isAdmin;\r\n    return forceEnableSpoke || enableAll || value;\r\n  } else {\r\n    return value;\r\n  }\r\n};\r\n\r\nlet localDevImages = {};\r\nif (isLocalDevelopment) {\r\n  localDevImages = {\r\n    logo: appLogo,\r\n    company_logo: companyLogo,\r\n    editor_logo: sceneEditorLogo\r\n  };\r\n}\r\n\r\nconfigs.image = (imageName, cssUrl) => {\r\n  const url =\r\n    (configs.APP_CONFIG && configs.APP_CONFIG.images && configs.APP_CONFIG.images[imageName]) ||\r\n    localDevImages[imageName];\r\n  return url && cssUrl ? `url(${url})` : url;\r\n};\r\n\r\nconfigs.link = (linkName, defaultValue) => {\r\n  return (configs.APP_CONFIG && configs.APP_CONFIG.links && configs.APP_CONFIG.links[linkName]) || defaultValue;\r\n};\r\n\r\nconfigs.setIsAdmin = _isAdmin => {\r\n  isAdmin = _isAdmin;\r\n};\r\nconfigs.isAdmin = () => isAdmin;\r\n\r\nexport default configs;\r\n","import { fetchReticulumAuthenticated } from \"./phoenix-utils\";\r\nimport { proxiedUrlFor } from \"./media-url-utils\";\r\n\r\nconst AVATARS_API = \"/api/v1/avatars\";\r\n\r\nexport const AVATAR_TYPES = {\r\n  SKINNABLE: \"skinnable\",\r\n  URL: \"url\"\r\n};\r\n\r\nexport function getAvatarType(avatarId) {\r\n  if (avatarId.startsWith(\"http\")) return AVATAR_TYPES.URL;\r\n  return AVATAR_TYPES.SKINNABLE;\r\n}\r\n\r\nasync function fetchSkinnableAvatar(avatarId) {\r\n  const resp = await fetchReticulumAuthenticated(`/api/v1/avatars/${avatarId}`);\r\n  return resp && resp.avatars && resp.avatars[0];\r\n}\r\n\r\nexport async function fetchAvatar(avatarId) {\r\n  switch (getAvatarType(avatarId)) {\r\n    case AVATAR_TYPES.SKINNABLE:\r\n      return fetchSkinnableAvatar(avatarId);\r\n    case AVATAR_TYPES.URL:\r\n      return {\r\n        avatar_id: avatarId,\r\n        gltf_url: proxiedUrlFor(avatarId)\r\n      };\r\n  }\r\n}\r\n\r\nasync function fetchAvatarGltfUrl(avatarId) {\r\n  return fetchAvatar(avatarId).then(avatar => avatar && avatar.gltf_url);\r\n}\r\n\r\nexport function getAvatarSrc(avatarId) {\r\n  switch (getAvatarType(avatarId)) {\r\n    case AVATAR_TYPES.SKINNABLE:\r\n      return fetchAvatarGltfUrl(avatarId);\r\n    case AVATAR_TYPES.URL:\r\n      return proxiedUrlFor(avatarId);\r\n    default:\r\n      return avatarId;\r\n  }\r\n}\r\n\r\nexport async function getAvatarThumbnailUrl(avatarId) {\r\n  switch (getAvatarType(avatarId)) {\r\n    case AVATAR_TYPES.SKINNABLE:\r\n      return fetchAvatar(avatarId).then(avatar => avatar.files.thumbnail);\r\n    default:\r\n      return \"https://asset-bundles-prod.reticulum.io/bots/avatar_unavailable.png\";\r\n  }\r\n}\r\n\r\n// Currently the way we do material overrides is with a special named material.\r\n// We want to migrate eventually to having a GLTF extension that specifies what\r\n// materials can be overridden, but in the meantime we want to be able to support\r\n// arbitrary models with some sort of functionality. This provides a fallback\r\nexport const MAT_NAME = \"Bot_PBS\";\r\nexport function ensureAvatarMaterial(gltf) {\r\n  if (gltf.materials.find(m => m.name === MAT_NAME)) return gltf;\r\n\r\n  function materialForMesh(mesh) {\r\n    if (!mesh.primitives) return;\r\n    const primitive = mesh.primitives.find(p => p.material !== undefined);\r\n    return primitive && gltf.materials[primitive.material];\r\n  }\r\n\r\n  let nodes = gltf.scenes[gltf.scene].nodes.slice(0);\r\n  while (nodes.length) {\r\n    const node = gltf.nodes[nodes.shift()];\r\n    const material = node.mesh !== undefined && materialForMesh(gltf.meshes[node.mesh]);\r\n    if (material) {\r\n      material.name = MAT_NAME;\r\n      break;\r\n    }\r\n    if (node.children) nodes = nodes.concat(node.children);\r\n  }\r\n\r\n  return gltf;\r\n}\r\n\r\nexport async function remixAvatar(parentId, name) {\r\n  const avatar = {\r\n    parent_avatar_listing_id: parentId,\r\n    name: name,\r\n    files: {}\r\n  };\r\n\r\n  return fetchReticulumAuthenticated(AVATARS_API, \"POST\", { avatar });\r\n}\r\n","export function forEachMaterial(object3D, fn) {\r\n  if (!object3D.material) return;\r\n\r\n  if (Array.isArray(object3D.material)) {\r\n    object3D.material.forEach(fn);\r\n  } else {\r\n    fn(object3D.material);\r\n  }\r\n}\r\n\r\nexport function mapMaterials(object3D, fn) {\r\n  if (!object3D.material) return;\r\n\r\n  if (Array.isArray(object3D.material)) {\r\n    return object3D.material.map(fn);\r\n  } else {\r\n    return fn(object3D.material);\r\n  }\r\n}\r\n","import { fetchReticulumAuthenticated } from \"./phoenix-utils\";\r\nimport ducky from \"../assets/models/DuckyMesh.glb\";\r\n\r\nconst names = [\r\n  \"Baers-Pochard\",\r\n  \"Baikal-Teal\",\r\n  \"Barrows-Goldeneye\",\r\n  \"Blue-Billed\",\r\n  \"Blue-Duck\",\r\n  \"Blue-Winged\",\r\n  \"Brown-Teal\",\r\n  \"Bufflehead\",\r\n  \"Canvasback\",\r\n  \"Cape-Shoveler\",\r\n  \"Chestnut-Teal\",\r\n  \"Chiloe-Wigeon\",\r\n  \"Cinnamon-Teal\",\r\n  \"Comb-Duck\",\r\n  \"Common-Eider\",\r\n  \"Common-Goldeneye\",\r\n  \"Common-Merganser\",\r\n  \"Common-Pochard\",\r\n  \"Common-Scoter\",\r\n  \"Common-Shelduck\",\r\n  \"Cotton-Pygmy\",\r\n  \"Crested-Duck\",\r\n  \"Crested-Shelduck\",\r\n  \"Eatons-Pintail\",\r\n  \"Falcated\",\r\n  \"Ferruginous\",\r\n  \"Freckled-Duck\",\r\n  \"Gadwall\",\r\n  \"Garganey\",\r\n  \"Greater-Scaup\",\r\n  \"Green-Pygmy\",\r\n  \"Grey-Teal\",\r\n  \"Hardhead\",\r\n  \"Harlequin\",\r\n  \"Hartlaubs\",\r\n  \"Hooded-Merganser\",\r\n  \"Hottentot-Teal\",\r\n  \"Kelp-Goose\",\r\n  \"King-Eider\",\r\n  \"Lake-Duck\",\r\n  \"Laysan-Duck\",\r\n  \"Lesser-Scaup\",\r\n  \"Long-Tailed\",\r\n  \"Maccoa-Duck\",\r\n  \"Mallard\",\r\n  \"Mandarin\",\r\n  \"Marbled-Teal\",\r\n  \"Mellers-Duck\",\r\n  \"Merganser\",\r\n  \"Northern-Pintail\",\r\n  \"Orinoco-Goose\",\r\n  \"Paradise-Shelduck\",\r\n  \"Plumed-Whistler\",\r\n  \"Puna-Teal\",\r\n  \"Pygmy-Goose\",\r\n  \"Radjah-Shelduck\",\r\n  \"Red-Billed\",\r\n  \"Red-Crested\",\r\n  \"Red-Shoveler\",\r\n  \"Ring-Necked\",\r\n  \"Ringed-Teal\",\r\n  \"Rosy-Billed\",\r\n  \"Ruddy-Shelduck\",\r\n  \"Salvadoris-Teal\",\r\n  \"Scaly-Sided\",\r\n  \"Shelduck\",\r\n  \"Shoveler\",\r\n  \"Silver-Teal\",\r\n  \"Smew\",\r\n  \"Spectacled-Eider\",\r\n  \"Spot-Billed\",\r\n  \"Spotted-Whistler\",\r\n  \"Steamerduck\",\r\n  \"Stellers-Eider\",\r\n  \"Sunda-Teal\",\r\n  \"Surf-Scoter\",\r\n  \"Tufted-Duck\",\r\n  \"Velvet-Scoter\",\r\n  \"Wandering-Whistler\",\r\n  \"Whistling-duck\",\r\n  \"White-Backed\",\r\n  \"White-Cheeked\",\r\n  \"White-Winged\",\r\n  \"Wigeon\",\r\n  \"Wood-Duck\",\r\n  \"Yellow-Billed\"\r\n];\r\n\r\nfunction chooseRandom(arr) {\r\n  return arr[Math.floor(Math.random() * arr.length)];\r\n}\r\n\r\nexport function generateRandomName() {\r\n  return `${chooseRandom(names)}-${Math.floor(10000 + Math.random() * 10000)}`;\r\n}\r\n\r\nexport async function fetchRandomDefaultAvatarId() {\r\n  const defaultAvatarEndpoint = \"/api/v1/media/search?filter=default&source=avatar_listings\";\r\n  const defaultAvatars = (await fetchReticulumAuthenticated(defaultAvatarEndpoint)).entries;\r\n  if (defaultAvatars.length === 0) {\r\n    // If reticulum doesn't return any default avatars, just default to the duck model. This should only happen\r\n    // when running against a fresh reticulum server, e.g. a local ret instance.\r\n    return new URL(ducky, location.href).href;\r\n  }\r\n  const avatarIds = defaultAvatars.map(avatar => avatar.id);\r\n  return chooseRandom(avatarIds);\r\n}\r\n","import { Validator } from \"jsonschema\";\r\nimport merge from \"deepmerge\";\r\nimport Cookies from \"js-cookie\";\r\nimport jwtDecode from \"jwt-decode\";\r\n\r\nconst LOCAL_STORE_KEY = \"___hubs_store\";\r\nconst STORE_STATE_CACHE_KEY = Symbol();\r\nconst OAUTH_FLOW_CREDENTIALS_KEY = \"ret-oauth-flow-account-credentials\";\r\nconst validator = new Validator();\r\nimport { EventTarget } from \"event-target-shim\";\r\nimport { fetchRandomDefaultAvatarId, generateRandomName } from \"../utils/identity.js\";\r\n\r\n// Durable (via local-storage) schema-enforced state that is meant to be consumed via forward data flow.\r\n// (Think flux but with way less incidental complexity, at least for now :))\r\nexport const SCHEMA = {\r\n  id: \"/HubsStore\",\r\n\r\n  definitions: {\r\n    profile: {\r\n      type: \"object\",\r\n      additionalProperties: false,\r\n      properties: {\r\n        displayName: { type: \"string\", pattern: \"^[A-Za-z0-9 -]{3,32}$\" },\r\n        avatarId: { type: \"string\" },\r\n        // personalAvatarId is obsolete, but we need it here for backwards compatibility.\r\n        personalAvatarId: { type: \"string\" }\r\n      }\r\n    },\r\n\r\n    credentials: {\r\n      type: \"object\",\r\n      additionalProperties: false,\r\n      properties: {\r\n        token: { type: [\"null\", \"string\"] },\r\n        email: { type: [\"null\", \"string\"] }\r\n      }\r\n    },\r\n\r\n    activity: {\r\n      type: \"object\",\r\n      additionalProperties: false,\r\n      properties: {\r\n        hasFoundFreeze: { type: \"boolean\" },\r\n        hasChangedName: { type: \"boolean\" },\r\n        hasAcceptedProfile: { type: \"boolean\" },\r\n        lastEnteredAt: { type: \"string\" },\r\n        hasPinned: { type: \"boolean\" },\r\n        hasRotated: { type: \"boolean\" },\r\n        hasRecentered: { type: \"boolean\" },\r\n        hasScaled: { type: \"boolean\" },\r\n        hasHoveredInWorldHud: { type: \"boolean\" },\r\n        hasOpenedShare: { type: \"boolean\" },\r\n        entryCount: { type: \"number\" }\r\n      }\r\n    },\r\n\r\n    settings: {\r\n      type: \"object\",\r\n      additionalProperties: false,\r\n      properties: {\r\n        lastUsedMicDeviceId: { type: \"string\" }\r\n      }\r\n    },\r\n\r\n    preferences: {\r\n      type: \"object\",\r\n      additionalProperties: false,\r\n      properties: {\r\n        muteMicOnEntry: { type: \"bool\" },\r\n        enableOnScreenJoystickLeft: { type: \"bool\" },\r\n        enableOnScreenJoystickRight: { type: \"bool\" },\r\n        onlyShowNametagsInFreeze: { type: \"bool\" },\r\n        allowMultipleHubsInstances: { type: \"bool\" },\r\n        maxResolutionWidth: { type: \"number\" },\r\n        maxResolutionHeight: { type: \"number\" },\r\n        globalVoiceVolume: { type: \"number\" },\r\n        globalMediaVolume: { type: \"number\" },\r\n        snapRotationDegrees: { type: \"number\" },\r\n        materialQualitySetting: { type: \"string\" },\r\n        disableMovement: { type: \"bool\" },\r\n        disableBackwardsMovement: { type: \"bool\" },\r\n        disableStrafing: { type: \"bool\" },\r\n        disableTeleporter: { type: \"bool\" },\r\n        disableAutoPixelRatio: { type: \"bool\" }\r\n      }\r\n    },\r\n\r\n    // Legacy\r\n    confirmedDiscordRooms: {\r\n      type: \"array\",\r\n      items: { type: \"string\" }\r\n    },\r\n\r\n    confirmedBroadcastedRooms: {\r\n      type: \"array\",\r\n      items: { type: \"string\" }\r\n    },\r\n\r\n    uploadPromotionTokens: {\r\n      type: \"array\",\r\n      items: {\r\n        type: \"object\",\r\n        additionalProperties: false,\r\n        properties: {\r\n          fileId: { type: \"string\" },\r\n          promotionToken: { type: \"string\" }\r\n        }\r\n      }\r\n    },\r\n\r\n    creatorAssignmentTokens: {\r\n      type: \"array\",\r\n      items: {\r\n        type: \"object\",\r\n        additionalProperties: false,\r\n        properties: {\r\n          hubId: { type: \"string\" },\r\n          creatorAssignmentToken: { type: \"string\" }\r\n        }\r\n      }\r\n    },\r\n\r\n    embedTokens: {\r\n      type: \"array\",\r\n      items: {\r\n        type: \"object\",\r\n        additionalProperties: false,\r\n        properties: {\r\n          hubId: { type: \"string\" },\r\n          embedToken: { type: \"string\" }\r\n        }\r\n      }\r\n    },\r\n\r\n    onLoadActions: {\r\n      type: \"array\",\r\n      items: {\r\n        type: \"object\",\r\n        additionalProperties: false,\r\n        properties: {\r\n          action: { type: \"string\" },\r\n          args: { type: \"object\" }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  type: \"object\",\r\n\r\n  properties: {\r\n    profile: { $ref: \"#/definitions/profile\" },\r\n    credentials: { $ref: \"#/definitions/credentials\" },\r\n    activity: { $ref: \"#/definitions/activity\" },\r\n    settings: { $ref: \"#/definitions/settings\" },\r\n    preferences: { $ref: \"#/definitions/preferences\" },\r\n    confirmedDiscordRooms: { $ref: \"#/definitions/confirmedDiscordRooms\" }, // Legacy\r\n    confirmedBroadcastedRooms: { $ref: \"#/definitions/confirmedBroadcastedRooms\" },\r\n    uploadPromotionTokens: { $ref: \"#/definitions/uploadPromotionTokens\" },\r\n    creatorAssignmentTokens: { $ref: \"#/definitions/creatorAssignmentTokens\" },\r\n    embedTokens: { $ref: \"#/definitions/embedTokens\" },\r\n    onLoadActions: { $ref: \"#/definitions/onLoadActions\" }\r\n  },\r\n\r\n  additionalProperties: false\r\n};\r\n\r\nexport default class Store extends EventTarget {\r\n  constructor() {\r\n    super();\r\n\r\n    if (localStorage.getItem(LOCAL_STORE_KEY) === null) {\r\n      localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify({}));\r\n    }\r\n\r\n    // When storage is updated in another window\r\n    window.addEventListener(\"storage\", e => {\r\n      if (e.key !== LOCAL_STORE_KEY) return;\r\n      delete this[STORE_STATE_CACHE_KEY];\r\n      this.dispatchEvent(new CustomEvent(\"statechanged\"));\r\n    });\r\n\r\n    this.update({\r\n      activity: {},\r\n      settings: {},\r\n      credentials: {},\r\n      profile: {},\r\n      confirmedDiscordRooms: [],\r\n      confirmedBroadcastedRooms: [],\r\n      uploadPromotionTokens: [],\r\n      creatorAssignmentTokens: [],\r\n      embedTokens: [],\r\n      onLoadActions: [],\r\n      preferences: {}\r\n    });\r\n\r\n    this._shouldResetAvatarOnInit = false;\r\n\r\n    const oauthFlowCredentials = Cookies.getJSON(OAUTH_FLOW_CREDENTIALS_KEY);\r\n    if (oauthFlowCredentials) {\r\n      this.update({ credentials: oauthFlowCredentials });\r\n      this._shouldResetAvatarOnInit = true;\r\n      Cookies.remove(OAUTH_FLOW_CREDENTIALS_KEY);\r\n    }\r\n\r\n    this._signOutOnExpiredAuthToken();\r\n  }\r\n\r\n  _signOutOnExpiredAuthToken = () => {\r\n    if (!this.state.credentials.token) return;\r\n\r\n    const expiry = jwtDecode(this.state.credentials.token).exp * 1000;\r\n    if (expiry <= Date.now()) {\r\n      this.update({ credentials: { token: null, email: null } });\r\n    }\r\n  };\r\n\r\n  initProfile = async () => {\r\n    if (this._shouldResetAvatarOnInit) {\r\n      await this.resetToRandomDefaultAvatar();\r\n    } else {\r\n      this.update({\r\n        profile: { avatarId: await fetchRandomDefaultAvatarId(), ...(this.state.profile || {}) }\r\n      });\r\n    }\r\n\r\n    // Regenerate name to encourage users to change it.\r\n    if (!this.state.activity.hasChangedName) {\r\n      this.update({ profile: { displayName: generateRandomName() } });\r\n    }\r\n  };\r\n\r\n  resetToRandomDefaultAvatar = async () => {\r\n    this.update({\r\n      profile: { ...(this.state.profile || {}), avatarId: await fetchRandomDefaultAvatarId() }\r\n    });\r\n  };\r\n\r\n  get state() {\r\n    if (!this.hasOwnProperty(STORE_STATE_CACHE_KEY)) {\r\n      this[STORE_STATE_CACHE_KEY] = JSON.parse(localStorage.getItem(LOCAL_STORE_KEY));\r\n    }\r\n\r\n    return this[STORE_STATE_CACHE_KEY];\r\n  }\r\n\r\n  get credentialsAccountId() {\r\n    if (this.state.credentials.token) {\r\n      return jwtDecode(this.state.credentials.token).sub;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  resetConfirmedBroadcastedRooms() {\r\n    this.clearStoredArray(\"confirmedBroadcastedRooms\");\r\n  }\r\n\r\n  resetTipActivityFlags() {\r\n    this.update({\r\n      activity: { hasRotated: false, hasPinned: false, hasRecentered: false, hasScaled: false, entryCount: 0 }\r\n    });\r\n  }\r\n\r\n  bumpEntryCount() {\r\n    const currentEntryCount = this.state.activity.entryCount || 0;\r\n    this.update({ activity: { entryCount: currentEntryCount + 1 } });\r\n  }\r\n\r\n  // Sets a one-time action to perform the next time the page loads\r\n  enqueueOnLoadAction(action, args) {\r\n    this.update({ onLoadActions: [{ action, args }] });\r\n  }\r\n\r\n  executeOnLoadActions(sceneEl) {\r\n    for (let i = 0; i < this.state.onLoadActions.length; i++) {\r\n      const { action, args } = this.state.onLoadActions[i];\r\n\r\n      if (action === \"emit_scene_event\") {\r\n        sceneEl.emit(args.event, args.detail);\r\n      }\r\n    }\r\n\r\n    this.clearOnLoadActions();\r\n  }\r\n\r\n  clearOnLoadActions() {\r\n    this.clearStoredArray(\"onLoadActions\");\r\n  }\r\n\r\n  clearStoredArray(key) {\r\n    const overwriteMerge = (destinationArray, sourceArray) => sourceArray;\r\n    const update = {};\r\n    update[key] = [];\r\n\r\n    this.update(update, { arrayMerge: overwriteMerge });\r\n  }\r\n\r\n  update(newState, mergeOpts) {\r\n    const finalState = merge(this.state, newState, mergeOpts);\r\n    const { valid } = validator.validate(finalState, SCHEMA);\r\n\r\n    if (!valid) {\r\n      // Intentionally not including details about the state or validation result here, since we don't want to leak\r\n      // sensitive data in the error message.\r\n      throw new Error(`Write to store failed schema validation.`);\r\n    }\r\n\r\n    localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify(finalState));\r\n    delete this[STORE_STATE_CACHE_KEY];\r\n\r\n    if (newState.profile !== undefined) {\r\n      this.dispatchEvent(new CustomEvent(\"profilechanged\"));\r\n    }\r\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\r\n\r\n    return finalState;\r\n  }\r\n}\r\n","module.exports = __webpack_public_path__ + \"assets/images/app-logo-157c06cff6c80227eb577f35c79e58b6.png\";","module.exports = __webpack_public_path__ + \"assets/images/company-logo-8f6f7c3b303004256295b45c2eee5117.png\";","module.exports = __webpack_public_path__ + \"assets/images/editor-logo-6f885a1543496ebc23a21b7fea82b255.png\";","// Brief overview of client authorization can be found in the wiki:\r\n// https://github.com/mozilla/hubs/wiki/Hubs-authorization\r\nexport function showHoverEffect(el) {\r\n  const isFrozen = el.sceneEl.is(\"frozen\");\r\n  const isPinned = el.components.pinnable && el.components.pinnable.data.pinned;\r\n  const isSpawner = !!el.components[\"super-spawner\"];\r\n  const isEmojiSpawner = isSpawner && el.components[\"super-spawner\"].data.template === \"#interactable-emoji\";\r\n  const isEmoji = !!el.components.emoji;\r\n  const canMove =\r\n    (isEmoji || isEmojiSpawner\r\n      ? window.APP.hubChannel.can(\"spawn_emoji\")\r\n      : window.APP.hubChannel.can(\"spawn_and_move_media\")) &&\r\n    (!isPinned || window.APP.hubChannel.can(\"pin_objects\"));\r\n  return (isSpawner || !isPinned || isFrozen) && canMove;\r\n}\r\n\r\nexport function canMove(entity) {\r\n  const isPinned = entity.components.pinnable && entity.components.pinnable.data.pinned;\r\n  const networkedTemplate = entity && entity.components.networked && entity.components.networked.data.template;\r\n  const isCamera = networkedTemplate === \"#interactable-camera\";\r\n  const isPen = networkedTemplate === \"#interactable-pen\";\r\n  const spawnerTemplate =\r\n    entity && entity.components[\"super-spawner\"] && entity.components[\"super-spawner\"].data.template;\r\n  const isEmojiSpawner = spawnerTemplate === \"#interactable-emoji\";\r\n  const isEmoji = !!entity.components.emoji;\r\n  const isHoldableButton = entity.components.tags && entity.components.tags.data.holdableButton;\r\n  return (\r\n    isHoldableButton ||\r\n    ((isEmoji || isEmojiSpawner\r\n      ? window.APP.hubChannel.can(\"spawn_emoji\")\r\n      : window.APP.hubChannel.can(\"spawn_and_move_media\")) &&\r\n      (!isPinned || window.APP.hubChannel.can(\"pin_objects\")) &&\r\n      (!isCamera || window.APP.hubChannel.can(\"spawn_camera\")) &&\r\n      (!isPen || window.APP.hubChannel.can(\"spawn_drawing\")))\r\n  );\r\n}\r\n\r\nfunction indexForComponent(component, schema) {\r\n  const fullComponent = typeof component === \"string\";\r\n  const componentName = fullComponent ? component : component.component;\r\n\r\n  if (fullComponent) {\r\n    return schema.components.findIndex(schemaComponent => schemaComponent === componentName);\r\n  } else {\r\n    return schema.components.findIndex(\r\n      schemaComponent => schemaComponent.component === componentName && schemaComponent.property === component.property\r\n    );\r\n  }\r\n}\r\n\r\nlet nonAuthorizedSchemas = null;\r\nfunction initializeNonAuthorizedSchemas() {\r\n  /*\r\n  Takes the NAF schemas defined in network-schemas.js and produces a data structure of template name to non-authorized\r\n  component indices:\r\n  {\r\n    \"#interactable-media\": [\"4\", \"5\", \"6\"]\r\n  }\r\n  */\r\n  nonAuthorizedSchemas = {};\r\n  const { schemaDict } = NAF.schemas;\r\n  for (const template in schemaDict) {\r\n    if (!schemaDict.hasOwnProperty(template)) continue;\r\n    const schema = schemaDict[template];\r\n    nonAuthorizedSchemas[template] = (schema.nonAuthorizedComponents || [])\r\n      .map(nonAuthorizedComponent => indexForComponent(nonAuthorizedComponent, schema))\r\n      .map(index => index.toString());\r\n  }\r\n}\r\n\r\nfunction sanitizeMessageData(template, data) {\r\n  if (nonAuthorizedSchemas === null) {\r\n    initializeNonAuthorizedSchemas();\r\n  }\r\n  const nonAuthorizedIndices = nonAuthorizedSchemas[template];\r\n  for (const index in data.components) {\r\n    if (!data.components.hasOwnProperty(index)) continue;\r\n    if (!nonAuthorizedIndices.includes(index)) {\r\n      data.components[index] = null;\r\n    }\r\n  }\r\n  return data;\r\n}\r\n\r\nfunction authorizeEntityManipulation(entityMetadata, sender, senderPermissions) {\r\n  const { template, creator, isPinned } = entityMetadata;\r\n  const isCreator = sender === creator;\r\n\r\n  if (template.endsWith(\"-waypoint-avatar\")) {\r\n    return true;\r\n  } else if (template.endsWith(\"-avatar\")) {\r\n    return isCreator;\r\n  } else if (template.endsWith(\"-media\")) {\r\n    return (!isPinned || senderPermissions.pin_objects) && (isCreator || senderPermissions.spawn_and_move_media);\r\n  } else if (template.endsWith(\"-camera\")) {\r\n    return isCreator || senderPermissions.spawn_camera;\r\n  } else if (template.endsWith(\"-pen\") || template.endsWith(\"-drawing\")) {\r\n    return isCreator || senderPermissions.spawn_drawing;\r\n  } else if (template.endsWith(\"-emoji\")) {\r\n    return isCreator || senderPermissions.spawn_emoji;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction getPendingOrExistingEntityMetadata(networkId) {\r\n  const pendingData = NAF.connection.adapter.getPendingDataForNetworkId(networkId);\r\n\r\n  if (pendingData) {\r\n    const { template, creator } = pendingData;\r\n    const schema = NAF.schemas.schemaDict[template];\r\n    const pinnableComponent = pendingData.components[indexForComponent(\"pinnable\", schema)];\r\n    const isPinned = pinnableComponent && pinnableComponent.pinned;\r\n    return { template, creator, isPinned };\r\n  }\r\n\r\n  const entity = NAF.entities.getEntity(networkId);\r\n  if (!entity) return null;\r\n\r\n  const { template, creator } = entity.components.networked.data;\r\n  const isPinned = entity.components.pinnable && entity.components.pinnable.data.pinned;\r\n  return { template, creator, isPinned };\r\n}\r\n\r\nfunction authorizeOrSanitizeMessageData(data, sender, senderPermissions) {\r\n  const entityMetadata = getPendingOrExistingEntityMetadata(data.networkId);\r\n  if (!entityMetadata) return false;\r\n\r\n  if (authorizeEntityManipulation(entityMetadata, sender, senderPermissions)) {\r\n    return true;\r\n  } else {\r\n    const { template } = entityMetadata;\r\n    sanitizeMessageData(template, data);\r\n    return true;\r\n  }\r\n}\r\n\r\n// If we receive a sync from a persistent object that we don't have an entity for yet, it must be a scene-owned object\r\n// (since we guarantee that pinned objects are loaded before connecting NAF).\r\n// Since we need to get metadata (the template id in particular) from the entity, we must stash these messages until\r\n// the scene has loaded.\r\n// Components which require this data must call applyPersistentSync after they are initialized\r\nconst persistentSyncs = {};\r\nfunction stashPersistentSync(message, entityData) {\r\n  if (!persistentSyncs[entityData.networkId]) {\r\n    persistentSyncs[entityData.networkId] = {\r\n      dataType: \"u\",\r\n      data: entityData,\r\n      clientId: message.clientId,\r\n      from_session_id: message.from_session_id\r\n    };\r\n  } else {\r\n    const currentData = persistentSyncs[entityData.networkId].data;\r\n    const currentComponents = currentData.components;\r\n    Object.assign(currentData, entityData);\r\n    currentData.components = Object.assign(currentComponents, entityData.components);\r\n  }\r\n}\r\n\r\nconst emptyObject = {};\r\nexport function authorizeOrSanitizeMessage(message) {\r\n  const { dataType, from_session_id } = message;\r\n\r\n  if (dataType === \"u\" && message.data.isFirstSync && !message.data.persistent) {\r\n    // The server has already authorized first sync messages that result in an instantiation.\r\n    return message;\r\n  }\r\n\r\n  const presenceState = window.APP.hubChannel.presence.state[from_session_id];\r\n\r\n  if (!presenceState) {\r\n    // We've received a manipulation message from a user that we don't have presence state for yet.\r\n    // Since we can't make a judgement about their permissions, we'll have to ignore the message.\r\n    return emptyObject;\r\n  }\r\n\r\n  const senderPermissions = presenceState.metas[0].permissions;\r\n\r\n  if (dataType === \"um\") {\r\n    let sanitizedAny = false;\r\n    let stashedAny = false;\r\n    for (const index in message.data.d) {\r\n      if (!message.data.d.hasOwnProperty(index)) continue;\r\n      const entityData = message.data.d[index];\r\n      if (entityData.persistent && !NAF.entities.getEntity(entityData.networkId)) {\r\n        stashPersistentSync(message, entityData);\r\n        message.data.d[index] = null;\r\n        stashedAny = true;\r\n      } else {\r\n        const authorizedOrSanitized = authorizeOrSanitizeMessageData(entityData, from_session_id, senderPermissions);\r\n        if (!authorizedOrSanitized) {\r\n          message.data.d[index] = null;\r\n          sanitizedAny = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (sanitizedAny || stashedAny) {\r\n      message.data.d = message.data.d.filter(x => x != null);\r\n    }\r\n\r\n    return message;\r\n  } else if (dataType === \"u\") {\r\n    if (message.data.persistent && !NAF.entities.getEntity(message.data.networkId)) {\r\n      persistentSyncs[message.data.networkId] = message;\r\n      return emptyObject;\r\n    } else {\r\n      const authorizedOrSanitized = authorizeOrSanitizeMessageData(message.data, from_session_id, senderPermissions);\r\n      if (authorizedOrSanitized) {\r\n        return message;\r\n      } else {\r\n        return emptyObject;\r\n      }\r\n    }\r\n  } else if (dataType === \"r\") {\r\n    const entityMetadata = getPendingOrExistingEntityMetadata(message.data.networkId);\r\n    if (!entityMetadata) return emptyObject;\r\n    if (authorizeEntityManipulation(entityMetadata, from_session_id, senderPermissions)) {\r\n      return message;\r\n    } else {\r\n      return emptyObject;\r\n    }\r\n  } else {\r\n    // Fall through for other data types. Namely, \"drawing-<networkId>\" messages at the moment.\r\n    return message;\r\n  }\r\n}\r\n\r\nconst PHOENIX_RELIABLE_NAF = \"phx-reliable\";\r\nexport function applyPersistentSync(networkId) {\r\n  if (!persistentSyncs[networkId]) return;\r\n  NAF.connection.adapter.onData(authorizeOrSanitizeMessage(persistentSyncs[networkId]), PHOENIX_RELIABLE_NAF);\r\n  delete persistentSyncs[networkId];\r\n}\r\n","const adjectives = [\r\n  \"able\",\r\n  \"absolute\",\r\n  \"acceptable\",\r\n  \"acclaimed\",\r\n  \"accomplished\",\r\n  \"accurate\",\r\n  \"aching\",\r\n  \"acrobatic\",\r\n  \"adorable\",\r\n  \"adventurous\",\r\n  \"basic\",\r\n  \"belated\",\r\n  \"beloved\",\r\n  \"calm\",\r\n  \"candid\",\r\n  \"capital\",\r\n  \"carefree\",\r\n  \"caring\",\r\n  \"cautious\",\r\n  \"celebrated\",\r\n  \"charming\",\r\n  \"daring\",\r\n  \"darling\",\r\n  \"dearest\",\r\n  \"each\",\r\n  \"eager\",\r\n  \"early\",\r\n  \"earnest\",\r\n  \"easy\",\r\n  \"easygoing\",\r\n  \"ecstatic\",\r\n  \"edible\",\r\n  \"fabulous\",\r\n  \"fair\",\r\n  \"faithful\",\r\n  \"familiar\",\r\n  \"famous\",\r\n  \"fancy\",\r\n  \"fantastic\",\r\n  \"far\",\r\n  \"generous\",\r\n  \"gentle\",\r\n  \"genuine\",\r\n  \"giant\",\r\n  \"handmade\",\r\n  \"handsome\",\r\n  \"handy\",\r\n  \"happy\",\r\n  \"icy\",\r\n  \"ideal\",\r\n  \"identical\",\r\n  \"keen\",\r\n  \"lasting\",\r\n  \"lavish\",\r\n  \"magnificent\",\r\n  \"majestic\",\r\n  \"mammoth\",\r\n  \"marvelous\",\r\n  \"natural\",\r\n  \"obedient\",\r\n  \"palatable\",\r\n  \"parched\",\r\n  \"passionate\",\r\n  \"pastel\",\r\n  \"peaceful\",\r\n  \"perfect\",\r\n  \"perfumed\",\r\n  \"quaint\",\r\n  \"qualified\",\r\n  \"radiant\",\r\n  \"rapid\",\r\n  \"rare\",\r\n  \"safe\",\r\n  \"sandy\",\r\n  \"satisfied\",\r\n  \"scaly\",\r\n  \"scarce\",\r\n  \"scared\",\r\n  \"scary\",\r\n  \"scented\",\r\n  \"scientific\",\r\n  \"secret\",\r\n  \"sentimental\",\r\n  \"talkative\",\r\n  \"tangible\",\r\n  \"tart\",\r\n  \"tasty\",\r\n  \"tattered\",\r\n  \"teeming\",\r\n  \"ultimate\",\r\n  \"uncommon\",\r\n  \"unconscious\",\r\n  \"understated\",\r\n  \"warm\",\r\n  \"active\",\r\n  \"adept\",\r\n  \"admirable\",\r\n  \"admired\",\r\n  \"adorable\",\r\n  \"adored\",\r\n  \"advanced\",\r\n  \"affectionate\",\r\n  \"beneficial\",\r\n  \"best\",\r\n  \"better\",\r\n  \"big\",\r\n  \"cheerful\",\r\n  \"cheery\",\r\n  \"chief\",\r\n  \"chilly\",\r\n  \"classic\",\r\n  \"clean\",\r\n  \"clear\",\r\n  \"clever\",\r\n  \"decent\",\r\n  \"decisive\",\r\n  \"deep\",\r\n  \"defiant\",\r\n  \"definitive\",\r\n  \"delectable\",\r\n  \"delicious\",\r\n  \"elaborate\",\r\n  \"elastic\",\r\n  \"elated\",\r\n  \"elegant\",\r\n  \"elementary\",\r\n  \"elliptical\",\r\n  \"fast\",\r\n  \"favorable\",\r\n  \"favorite\",\r\n  \"fearless\",\r\n  \"gifted\",\r\n  \"glamorous\",\r\n  \"gleaming\",\r\n  \"glittering\",\r\n  \"harmonious\",\r\n  \"imaginative\",\r\n  \"immense\",\r\n  \"jealous\",\r\n  \"kind\",\r\n  \"leafy\",\r\n  \"legal\",\r\n  \"mature\",\r\n  \"mean\",\r\n  \"nautical\",\r\n  \"neat\",\r\n  \"necessary\",\r\n  \"needy\",\r\n  \"oddball\",\r\n  \"offbeat\",\r\n  \"periodic\",\r\n  \"perky\",\r\n  \"personal\",\r\n  \"pertinent\",\r\n  \"petty\",\r\n  \"quarterly\",\r\n  \"ready\",\r\n  \"real\",\r\n  \"realistic\",\r\n  \"reasonable\",\r\n  \"regal\",\r\n  \"serene\",\r\n  \"shabby\",\r\n  \"sharp\",\r\n  \"shiny\",\r\n  \"showy\",\r\n  \"shy\",\r\n  \"silky\",\r\n  \"tempting\",\r\n  \"tense\",\r\n  \"terrific\",\r\n  \"testy\",\r\n  \"thankful\",\r\n  \"uniform\",\r\n  \"unique\",\r\n  \"vast\",\r\n  \"weary\",\r\n  \"wee\",\r\n  \"welcome\",\r\n  \"agile\",\r\n  \"alarmed\",\r\n  \"alert\",\r\n  \"alive\",\r\n  \"bleak\",\r\n  \"blissful\",\r\n  \"blushing\",\r\n  \"coarse\",\r\n  \"colorful\",\r\n  \"colossal\",\r\n  \"comfortable\",\r\n  \"compassionate\",\r\n  \"complete\",\r\n  \"delightful\",\r\n  \"dense\",\r\n  \"dependable\",\r\n  \"dependent\",\r\n  \"descriptive\",\r\n  \"detailed\",\r\n  \"determined\",\r\n  \"devoted\",\r\n  \"different\",\r\n  \"eminent\",\r\n  \"emotional\",\r\n  \"enchanted\",\r\n  \"enchanting\",\r\n  \"energetic\",\r\n  \"enormous\",\r\n  \"fine\",\r\n  \"finished\",\r\n  \"firm\",\r\n  \"firsthand\",\r\n  \"fixed\",\r\n  \"flashy\",\r\n  \"flawless\",\r\n  \"glorious\",\r\n  \"glossy\",\r\n  \"golden\",\r\n  \"good\",\r\n  \"gorgeous\",\r\n  \"graceful\",\r\n  \"healthy\",\r\n  \"heartfelt\",\r\n  \"hearty\",\r\n  \"helpful\",\r\n  \"impartial\",\r\n  \"impressive\",\r\n  \"jolly\",\r\n  \"jovial\",\r\n  \"lighthearted\",\r\n  \"likable\",\r\n  \"lined\",\r\n  \"mellow\",\r\n  \"melodic\",\r\n  \"memorable\",\r\n  \"mild\",\r\n  \"new\",\r\n  \"opulent\",\r\n  \"playful\",\r\n  \"pleasant\",\r\n  \"pleasing\",\r\n  \"plump\",\r\n  \"plush\",\r\n  \"polished\",\r\n  \"polite\",\r\n  \"reliable\",\r\n  \"relieved\",\r\n  \"remarkable\",\r\n  \"remote\",\r\n  \"respectful\",\r\n  \"responsible\",\r\n  \"simple\",\r\n  \"simplistic\",\r\n  \"sizzling\",\r\n  \"sleepy\",\r\n  \"slight\",\r\n  \"slim\",\r\n  \"smart\",\r\n  \"smooth\",\r\n  \"snappy\",\r\n  \"snoopy\",\r\n  \"thirsty\",\r\n  \"this\",\r\n  \"thorough\",\r\n  \"those\",\r\n  \"thoughtful\",\r\n  \"united\",\r\n  \"vibrant\",\r\n  \"vicious\",\r\n  \"wellmade\",\r\n  \"whimsical\",\r\n  \"whirlwind\",\r\n  \"zesty\",\r\n  \"amazing\",\r\n  \"ambitious\",\r\n  \"ample\",\r\n  \"amused\",\r\n  \"amusing\",\r\n  \"ancient\",\r\n  \"angelic\",\r\n  \"antique\",\r\n  \"bold\",\r\n  \"bossy\",\r\n  \"both\",\r\n  \"bouncy\",\r\n  \"bountiful\",\r\n  \"complex\",\r\n  \"conscious\",\r\n  \"considerate\",\r\n  \"constant\",\r\n  \"content\",\r\n  \"conventional\",\r\n  \"cooked\",\r\n  \"cool\",\r\n  \"cooperative\",\r\n  \"diligent\",\r\n  \"dimwitted\",\r\n  \"direct\",\r\n  \"discrete\",\r\n  \"envious\",\r\n  \"essential\",\r\n  \"ethical\",\r\n  \"euphoric\",\r\n  \"flippant\",\r\n  \"fluffy\",\r\n  \"flustered\",\r\n  \"focused\",\r\n  \"fond\",\r\n  \"gracious\",\r\n  \"grand\",\r\n  \"grandiose\",\r\n  \"granular\",\r\n  \"grateful\",\r\n  \"grave\",\r\n  \"great\",\r\n  \"hidden\",\r\n  \"high\",\r\n  \"hilarious\",\r\n  \"homely\",\r\n  \"incomparable\",\r\n  \"incredible\",\r\n  \"infamous\",\r\n  \"joyful\",\r\n  \"lively\",\r\n  \"loathsome\",\r\n  \"lonely\",\r\n  \"long\",\r\n  \"mindless\",\r\n  \"miniature\",\r\n  \"minor\",\r\n  \"misty\",\r\n  \"next\",\r\n  \"nice\",\r\n  \"nifty\",\r\n  \"nimble\",\r\n  \"orderly\",\r\n  \"organic\",\r\n  \"ornate\",\r\n  \"popular\",\r\n  \"posh\",\r\n  \"positive\",\r\n  \"potable\",\r\n  \"powerful\",\r\n  \"powerless\",\r\n  \"precious\",\r\n  \"present\",\r\n  \"prestigious\",\r\n  \"quick\",\r\n  \"rewarding\",\r\n  \"rich\",\r\n  \"right\",\r\n  \"sociable\",\r\n  \"soft\",\r\n  \"solid\",\r\n  \"some\",\r\n  \"sophisticated\",\r\n  \"soulful\",\r\n  \"sparkling\",\r\n  \"spectacular\",\r\n  \"speedy\",\r\n  \"spicy\",\r\n  \"spiffy\",\r\n  \"spirited\",\r\n  \"spiteful\",\r\n  \"splendid\",\r\n  \"spotless\",\r\n  \"spry\",\r\n  \"thrifty\",\r\n  \"tidy\",\r\n  \"tight\",\r\n  \"timely\",\r\n  \"tinted\",\r\n  \"unruly\",\r\n  \"untimely\",\r\n  \"violet\",\r\n  \"wicked\",\r\n  \"wide\",\r\n  \"wild\",\r\n  \"willing\",\r\n  \"winding\",\r\n  \"windy\",\r\n  \"zigzag\",\r\n  \"apprehensive\",\r\n  \"appropriate\",\r\n  \"artistic\",\r\n  \"assured\",\r\n  \"astonishing\",\r\n  \"bright\",\r\n  \"brilliant\",\r\n  \"bronze\",\r\n  \"coordinated\",\r\n  \"courageous\",\r\n  \"courteous\",\r\n  \"crafty\",\r\n  \"crazy\",\r\n  \"creamy\",\r\n  \"creative\",\r\n  \"crisp\",\r\n  \"distant\",\r\n  \"distinct\",\r\n  \"downright\",\r\n  \"evergreen\",\r\n  \"everlasting\",\r\n  \"every\",\r\n  \"evil\",\r\n  \"excellent\",\r\n  \"excitable\",\r\n  \"exemplary\",\r\n  \"exhausted\",\r\n  \"forthright\",\r\n  \"fortunate\",\r\n  \"fragrant\",\r\n  \"frank\",\r\n  \"free\",\r\n  \"frequent\",\r\n  \"fresh\",\r\n  \"friendly\",\r\n  \"frightened\",\r\n  \"frigid\",\r\n  \"gripping\",\r\n  \"grounded\",\r\n  \"honest\",\r\n  \"honorable\",\r\n  \"honored\",\r\n  \"hopeful\",\r\n  \"hospitable\",\r\n  \"hot\",\r\n  \"huge\",\r\n  \"infatuated\",\r\n  \"infinite\",\r\n  \"informal\",\r\n  \"insistent\",\r\n  \"instructive\",\r\n  \"juicy\",\r\n  \"jumbo\",\r\n  \"knowing\",\r\n  \"knowledgeable\",\r\n  \"longterm\",\r\n  \"loud\",\r\n  \"lovable\",\r\n  \"loving\",\r\n  \"modern\",\r\n  \"modest\",\r\n  \"monumental\",\r\n  \"normal\",\r\n  \"notable\",\r\n  \"outgoing\",\r\n  \"precious\",\r\n  \"pretty\",\r\n  \"prickly\",\r\n  \"primary\",\r\n  \"pristine\",\r\n  \"private\",\r\n  \"prize\",\r\n  \"productive\",\r\n  \"profitable\",\r\n  \"quiet\",\r\n  \"quintessential\",\r\n  \"roasted\",\r\n  \"robust\",\r\n  \"square\",\r\n  \"squiggly\",\r\n  \"stable\",\r\n  \"staid\",\r\n  \"starry\",\r\n  \"steel\",\r\n  \"stimulating\",\r\n  \"striking\",\r\n  \"striped\",\r\n  \"strong\",\r\n  \"studious\",\r\n  \"stunning\",\r\n  \"tough\",\r\n  \"trained\",\r\n  \"treasured\",\r\n  \"tremendous\",\r\n  \"triangular\",\r\n  \"tricky\",\r\n  \"unused\",\r\n  \"unusual\",\r\n  \"upbeat\",\r\n  \"virtual\",\r\n  \"witty\",\r\n  \"wonderful\",\r\n  \"wooden\",\r\n  \"worldly\",\r\n  \"youthful\",\r\n  \"attached\",\r\n  \"attentive\",\r\n  \"attractive\",\r\n  \"austere\",\r\n  \"authentic\",\r\n  \"automatic\",\r\n  \"aware\",\r\n  \"awesome\",\r\n  \"bubbly\",\r\n  \"bustling\",\r\n  \"busy\",\r\n  \"buttery\",\r\n  \"cuddly\",\r\n  \"cultured\",\r\n  \"curly\",\r\n  \"curvy\",\r\n  \"cute\",\r\n  \"cylindrical\",\r\n  \"downright\",\r\n  \"dramatic\",\r\n  \"excited\",\r\n  \"exciting\",\r\n  \"exotic\",\r\n  \"experienced\",\r\n  \"expert\",\r\n  \"frosty\",\r\n  \"fruitful\",\r\n  \"full\",\r\n  \"fumbling\",\r\n  \"funny\",\r\n  \"fussy\",\r\n  \"growing\",\r\n  \"grown\",\r\n  \"gummy\",\r\n  \"humble\",\r\n  \"humongous\",\r\n  \"hungry\",\r\n  \"intelligent\",\r\n  \"interesting\",\r\n  \"known\",\r\n  \"kooky\",\r\n  \"loyal\",\r\n  \"lucky\",\r\n  \"luminous\",\r\n  \"lustrous\",\r\n  \"luxurious\",\r\n  \"multicolored\",\r\n  \"mysterious\",\r\n  \"noteworthy\",\r\n  \"numb\",\r\n  \"nutritious\",\r\n  \"outstanding\",\r\n  \"overjoyed\",\r\n  \"proper\",\r\n  \"proud\",\r\n  \"prudent\",\r\n  \"punctual\",\r\n  \"puny\",\r\n  \"pure\",\r\n  \"puzzled\",\r\n  \"puzzling\",\r\n  \"quirky\",\r\n  \"stupendous\",\r\n  \"sturdy\",\r\n  \"stylish\",\r\n  \"subdued\",\r\n  \"subtle\",\r\n  \"sunny\",\r\n  \"super\",\r\n  \"superb\",\r\n  \"supportive\",\r\n  \"surprised\",\r\n  \"sweet\",\r\n  \"swift\",\r\n  \"sympathetic\",\r\n  \"trivial\",\r\n  \"trusting\",\r\n  \"trustworthy\",\r\n  \"trusty\",\r\n  \"truthful\",\r\n  \"twin\",\r\n  \"usable\",\r\n  \"used\",\r\n  \"useful\",\r\n  \"utilized\",\r\n  \"vital\",\r\n  \"vivid\",\r\n  \"worried\",\r\n  \"worthwhile\",\r\n  \"worthy\",\r\n  \"writhing\",\r\n  \"wry\",\r\n  \"yummy\",\r\n  \"chocolate\",\r\n  \"crimson\",\r\n  \"cyan\",\r\n  \"fuchsia\",\r\n  \"gold\",\r\n  \"honeydew\",\r\n  \"lime\",\r\n  \"linen\",\r\n  \"magenta\",\r\n  \"olive\",\r\n  \"peru\",\r\n  \"salmon\",\r\n  \"seashell\",\r\n  \"sienna\",\r\n  \"snow\",\r\n  \"thistle\",\r\n  \"tomato\",\r\n  \"transparent\",\r\n  \"turquoise\",\r\n  \"violet\"\r\n];\r\n\r\nconst nouns = [\r\n  \"space\",\r\n  \"land\",\r\n  \"world\",\r\n  \"universe\",\r\n  \"plane\",\r\n  \"room\",\r\n  \"nation\",\r\n  \"plaza\",\r\n  \"gathering\",\r\n  \"meetup\",\r\n  \"get together\",\r\n  \"conclave\",\r\n  \"party\",\r\n  \"domain\",\r\n  \"dominion\",\r\n  \"realm\",\r\n  \"square\",\r\n  \"commons\",\r\n  \"park\",\r\n  \"cosmos\",\r\n  \"sphere\",\r\n  \"terrain\",\r\n  \"spot\",\r\n  \"zone\",\r\n  \"area\",\r\n  \"tract\",\r\n  \"turf\",\r\n  \"place\",\r\n  \"territory\",\r\n  \"volume\",\r\n  \"camp\",\r\n  \"picnic\",\r\n  \"outing\",\r\n  \"vacation\",\r\n  \"adventure\",\r\n  \"exploration\",\r\n  \"outing\",\r\n  \"walkabout\",\r\n  \"safari\",\r\n  \"venture\",\r\n  \"roundtable\",\r\n  \"barbecue\",\r\n  \"celebration\",\r\n  \"festivity\",\r\n  \"gala\",\r\n  \"shindig\",\r\n  \"social\",\r\n  \"convention\",\r\n  \"assembly\",\r\n  \"congregation\",\r\n  \"rendezvous\",\r\n  \"huddle\",\r\n  \"meet\",\r\n  \"soiree\"\r\n];\r\n\r\nexport function generateHubName() {\r\n  const randItem = set => {\r\n    const s = set[Math.floor(Math.random() * set.length)];\r\n    return s.charAt(0).toUpperCase() + s.slice(1);\r\n  };\r\n\r\n  return `${randItem(adjectives)} ${randItem(adjectives)} ${randItem(nouns)}`;\r\n}\r\n","import { Socket } from \"phoenix\";\r\nimport { generateHubName } from \"../utils/name-generation\";\r\nimport configs from \"../utils/configs\";\r\n\r\nimport Store from \"../storage/store\";\r\n\r\nexport function hasReticulumServer() {\r\n  return !!configs.RETICULUM_SERVER;\r\n}\r\n\r\nexport function isLocalClient() {\r\n  return hasReticulumServer() && document.location.host !== configs.RETICULUM_SERVER;\r\n}\r\n\r\nconst resolverLink = document.createElement(\"a\");\r\nlet reticulumMeta = null;\r\nlet invalidatedReticulumMetaThisSession = false;\r\n\r\nexport function getReticulumFetchUrl(path, absolute = false, host = null, port = null) {\r\n  if (host || hasReticulumServer()) {\r\n    return `https://${host || configs.RETICULUM_SERVER}${port ? `:${port}` : \"\"}${path}`;\r\n  } else if (absolute) {\r\n    resolverLink.href = path;\r\n    return resolverLink.href;\r\n  } else {\r\n    return path;\r\n  }\r\n}\r\n\r\nexport async function getReticulumMeta() {\r\n  if (!reticulumMeta) {\r\n    // Initially look up version based upon page, avoiding round-trip, otherwise fetch.\r\n    if (!invalidatedReticulumMetaThisSession && document.querySelector(\"meta[name='ret:version']\")) {\r\n      reticulumMeta = {\r\n        version: document.querySelector(\"meta[name='ret:version']\").getAttribute(\"value\"),\r\n        pool: document.querySelector(\"meta[name='ret:pool']\").getAttribute(\"value\"),\r\n        phx_host: document.querySelector(\"meta[name='ret:phx_host']\").getAttribute(\"value\")\r\n      };\r\n    } else {\r\n      await fetch(getReticulumFetchUrl(\"/api/v1/meta\")).then(async res => {\r\n        reticulumMeta = await res.json();\r\n      });\r\n    }\r\n  }\r\n\r\n  const qs = new URLSearchParams(location.search);\r\n  const phxHostOverride = qs.get(\"phx_host\");\r\n\r\n  if (phxHostOverride) {\r\n    reticulumMeta.phx_host = phxHostOverride;\r\n  }\r\n\r\n  return reticulumMeta;\r\n}\r\n\r\nlet directReticulumHostAndPort;\r\n\r\nasync function refreshDirectReticulumHostAndPort() {\r\n  const qs = new URLSearchParams(location.search);\r\n  let host = qs.get(\"phx_host\");\r\n  const reticulumMeta = await getReticulumMeta();\r\n  host = host || configs.RETICULUM_SOCKET_SERVER || reticulumMeta.phx_host;\r\n  const port =\r\n    qs.get(\"phx_port\") ||\r\n    (hasReticulumServer() ? new URL(`${document.location.protocol}//${configs.RETICULUM_SERVER}`).port : \"443\");\r\n  directReticulumHostAndPort = { host, port };\r\n}\r\n\r\nexport function getDirectReticulumFetchUrl(path, absolute = false) {\r\n  if (!directReticulumHostAndPort) {\r\n    console.warn(\"Cannot call getDirectReticulumFetchUrl before connectToReticulum. Returning non-direct url.\");\r\n    return getReticulumFetchUrl(path, absolute);\r\n  }\r\n\r\n  const { host, port } = directReticulumHostAndPort;\r\n  return getReticulumFetchUrl(path, absolute, host, port);\r\n}\r\n\r\nexport async function invalidateReticulumMeta() {\r\n  invalidatedReticulumMetaThisSession = true;\r\n  reticulumMeta = null;\r\n}\r\n\r\nexport async function connectToReticulum(debug = false, params = null, socketClass = Socket) {\r\n  const qs = new URLSearchParams(location.search);\r\n\r\n  const getNewSocketUrl = async () => {\r\n    await refreshDirectReticulumHostAndPort();\r\n    const { host, port } = directReticulumHostAndPort;\r\n    const protocol =\r\n      qs.get(\"phx_protocol\") ||\r\n      configs.RETICULUM_SOCKET_PROTOCOL ||\r\n      (document.location.protocol === \"https:\" ? \"wss:\" : \"ws:\");\r\n\r\n    return `${protocol}//${host}${port ? `:${port}` : \"\"}`;\r\n  };\r\n\r\n  const socketUrl = await getNewSocketUrl();\r\n  console.log(`Phoenix Socket URL: ${socketUrl}`);\r\n\r\n  const socketSettings = {};\r\n\r\n  if (debug) {\r\n    socketSettings.logger = (kind, msg, data) => {\r\n      console.log(`${kind}: ${msg}`, data);\r\n    };\r\n  }\r\n\r\n  if (params) {\r\n    socketSettings.params = params;\r\n  }\r\n\r\n  const socket = new socketClass(`${socketUrl}/socket`, socketSettings);\r\n  socket.connect();\r\n  socket.onError(async () => {\r\n    // On error, underlying reticulum node may have died, so rebalance by\r\n    // fetching a new healthy node to connect to.\r\n    invalidateReticulumMeta();\r\n\r\n    const endPointPath = new URL(socket.endPoint).pathname;\r\n    const newSocketUrl = await getNewSocketUrl();\r\n    const newEndPoint = `${newSocketUrl}${endPointPath}`;\r\n    console.log(`Socket error, changed endpoint to ${newEndPoint}`);\r\n    socket.endPoint = newEndPoint;\r\n  });\r\n\r\n  return socket;\r\n}\r\n\r\nexport function getLandingPageForPhoto(photoUrl) {\r\n  const parsedUrl = new URL(photoUrl);\r\n  return getReticulumFetchUrl(parsedUrl.pathname.replace(\".png\", \".html\") + parsedUrl.search, true);\r\n}\r\n\r\nexport function fetchReticulumAuthenticated(url, method = \"GET\", payload) {\r\n  const { token } = window.APP.store.state.credentials;\r\n  const retUrl = getReticulumFetchUrl(url);\r\n  const params = {\r\n    headers: { \"content-type\": \"application/json\" },\r\n    method\r\n  };\r\n  if (token) {\r\n    params.headers.authorization = `bearer ${token}`;\r\n  }\r\n  if (payload) {\r\n    params.body = JSON.stringify(payload);\r\n  }\r\n  return fetch(retUrl, params).then(async r => {\r\n    const result = await r.text();\r\n    try {\r\n      return JSON.parse(result);\r\n    } catch (e) {\r\n      // Some reticulum responses, particularly DELETE requests, don't return json.\r\n      return result;\r\n    }\r\n  });\r\n}\r\n\r\nexport async function createAndRedirectToNewHub(name, sceneId, replace) {\r\n  const createUrl = getReticulumFetchUrl(\"/api/v1/hubs\");\r\n  const payload = { hub: { name: name || generateHubName() } };\r\n\r\n  if (sceneId) {\r\n    payload.hub.scene_id = sceneId;\r\n  }\r\n\r\n  const headers = { \"content-type\": \"application/json\" };\r\n  const store = new Store();\r\n  if (store.state && store.state.credentials.token) {\r\n    headers.authorization = `bearer ${store.state.credentials.token}`;\r\n  }\r\n\r\n  let res = await fetch(createUrl, {\r\n    body: JSON.stringify(payload),\r\n    headers,\r\n    method: \"POST\"\r\n  }).then(r => r.json());\r\n\r\n  if (res.error === \"invalid_token\") {\r\n    // Clear the invalid token from store.\r\n    store.update({ credentials: { token: null, email: null } });\r\n\r\n    // Create hub anonymously\r\n    delete headers.authorization;\r\n    res = await fetch(createUrl, {\r\n      body: JSON.stringify(payload),\r\n      headers,\r\n      method: \"POST\"\r\n    }).then(r => r.json());\r\n  }\r\n\r\n  const hub = res;\r\n  let url = hub.url;\r\n\r\n  const creatorAssignmentToken = hub.creator_assignment_token;\r\n  if (creatorAssignmentToken) {\r\n    store.update({ creatorAssignmentTokens: [{ hubId: hub.hub_id, creatorAssignmentToken: creatorAssignmentToken }] });\r\n\r\n    // Don't need to store the embed token if there's no creator assignment token, since that means\r\n    // we are the owner and will get the embed token on page load.\r\n    const embedToken = hub.embed_token;\r\n\r\n    if (embedToken) {\r\n      store.update({ embedTokens: [{ hubId: hub.hub_id, embedToken: embedToken }] });\r\n    }\r\n  }\r\n\r\n  if (isLocalClient()) {\r\n    url = `${process.env.BASE_ASSETS_PATH}/hub.html?hub_id=${hub.hub_id}`;\r\n  }\r\n\r\n  if (replace) {\r\n    document.location.replace(url);\r\n  } else {\r\n    document.location = url;\r\n  }\r\n}\r\n\r\nexport function getPresenceEntryForSession(presences, sessionId) {\r\n  const entry = Object.entries(presences || {}).find(([k]) => k === sessionId) || [];\r\n  const presence = entry[1];\r\n  return (presence && presence.metas && presence.metas[0]) || {};\r\n}\r\n\r\nexport function getPresenceContextForSession(presences, sessionId) {\r\n  return (getPresenceEntryForSession(presences, sessionId) || {}).context || {};\r\n}\r\n\r\nexport function getPresenceProfileForSession(presences, sessionId) {\r\n  return (getPresenceEntryForSession(presences, sessionId) || {}).profile || {};\r\n}\r\n\r\n// Takes the given channel, and creates a new channel with the same bindings\r\n// with the given socket, joins it, and leaves the old channel after joining.\r\n//\r\n// NOTE: This function relies upon phoenix channel object internals, so this\r\n// function will need to be reviewed if/when we ever update phoenix.js\r\nexport function migrateChannelToSocket(oldChannel, socket, params) {\r\n  const channel = socket.channel(oldChannel.topic, params || oldChannel.params);\r\n\r\n  for (let i = 0, l = oldChannel.bindings.length; i < l; i++) {\r\n    const item = oldChannel.bindings[i];\r\n    channel.on(item.event, item.callback);\r\n  }\r\n\r\n  for (let i = 0, l = oldChannel.pushBuffer.length; i < l; i++) {\r\n    const item = oldChannel.pushBuffer[i];\r\n    channel.push(item.event, item.payload, item.timeout);\r\n  }\r\n\r\n  const oldJoinPush = oldChannel.joinPush;\r\n  const joinPush = channel.join();\r\n\r\n  for (let i = 0, l = oldJoinPush.recHooks.length; i < l; i++) {\r\n    const item = oldJoinPush.recHooks[i];\r\n    joinPush.receive(item.status, item.callback);\r\n  }\r\n\r\n  return new Promise(resolve => {\r\n    joinPush.receive(\"ok\", () => {\r\n      // Clear all event handlers first so no duplicate messages come in.\r\n      oldChannel.bindings = [];\r\n      resolve(channel);\r\n    });\r\n  });\r\n}\r\n\r\nexport function discordBridgesForPresences(presences) {\r\n  const channels = [];\r\n  for (const p of Object.values(presences)) {\r\n    for (const m of p.metas) {\r\n      if (m.profile && m.profile.discordBridges) {\r\n        Array.prototype.push.apply(channels, m.profile.discordBridges.map(b => b.channel.name));\r\n      }\r\n    }\r\n  }\r\n  return channels;\r\n}\r\n","module.exports = __webpack_public_path__ + \"assets/models/DuckyMesh-04f978955fb12d48f7ff8c59a05de439.glb\";","export default function nextTick() {\r\n  return new Promise(resolve => {\r\n    setTimeout(resolve, 0);\r\n  });\r\n}\r\n","import nextTick from \"../utils/next-tick\";\r\nimport { mapMaterials } from \"../utils/material-utils\";\r\nimport SketchfabZipWorker from \"../workers/sketchfab-zip.worker.js\";\r\nimport MobileStandardMaterial from \"../materials/MobileStandardMaterial\";\r\nimport { textureLoader, basisTextureLoader } from \"../utils/media-utils\";\r\nimport { getCustomGLTFParserURLResolver } from \"../utils/media-url-utils\";\r\nimport { promisifyWorker } from \"../utils/promisify-worker.js\";\r\nimport { MeshBVH, acceleratedRaycast } from \"three-mesh-bvh\";\r\nimport { disposeNode, cloneObject3D } from \"../utils/three-utils\";\r\n\r\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\r\n\r\nclass GLTFCache {\r\n  cache = new Map();\r\n\r\n  set(src, gltf) {\r\n    this.cache.set(src, {\r\n      gltf,\r\n      count: 0\r\n    });\r\n    return this.retain(src);\r\n  }\r\n\r\n  has(src) {\r\n    return this.cache.has(src);\r\n  }\r\n\r\n  get(src) {\r\n    return this.cache.get(src);\r\n  }\r\n\r\n  retain(src) {\r\n    const cacheItem = this.cache.get(src);\r\n    cacheItem.count++;\r\n    return cacheItem;\r\n  }\r\n\r\n  release(src) {\r\n    const cacheItem = this.cache.get(src);\r\n\r\n    if (!cacheItem) {\r\n      console.error(`Releasing uncached gltf ${src}`);\r\n      return;\r\n    }\r\n\r\n    cacheItem.count--;\r\n    if (cacheItem.count <= 0) {\r\n      cacheItem.gltf.scene.traverse(disposeNode);\r\n      this.cache.delete(src);\r\n    }\r\n  }\r\n}\r\nconst gltfCache = new GLTFCache();\r\nconst inflightGltfs = new Map();\r\n\r\nconst extractZipFile = promisifyWorker(new SketchfabZipWorker());\r\n\r\nfunction defaultInflator(el, componentName, componentData) {\r\n  if (!AFRAME.components[componentName]) {\r\n    throw new Error(`Inflator failed. \"${componentName}\" component does not exist.`);\r\n  }\r\n  if (AFRAME.components[componentName].multiple && Array.isArray(componentData)) {\r\n    for (let i = 0; i < componentData.length; i++) {\r\n      el.setAttribute(componentName + \"__\" + i, componentData[i]);\r\n    }\r\n  } else {\r\n    el.setAttribute(componentName, componentData);\r\n  }\r\n}\r\n\r\nAFRAME.GLTFModelPlus = {\r\n  // eslint-disable-next-line no-unused-vars\r\n  components: {},\r\n  registerComponent(componentKey, componentName, inflator) {\r\n    inflator = inflator || defaultInflator;\r\n    AFRAME.GLTFModelPlus.components[componentKey] = { inflator, componentName };\r\n  }\r\n};\r\n\r\nfunction generateMeshBVH(object3D) {\r\n  object3D.traverse(obj => {\r\n    // note that we might already have a bounds tree if this was a clone of an object with one\r\n    const hasBufferGeometry = obj.isMesh && obj.geometry.isBufferGeometry;\r\n    const hasBoundsTree = hasBufferGeometry && obj.geometry.boundsTree;\r\n    if (hasBufferGeometry && !hasBoundsTree && obj.geometry.attributes.position) {\r\n      const geo = obj.geometry;\r\n      const triCount = geo.index ? geo.index.count / 3 : geo.attributes.position.count / 3;\r\n      // only bother using memory and time making a BVH if there are a reasonable number of tris,\r\n      // and if there are too many it's too painful and large to tolerate doing it (at least until\r\n      // we put this in a web worker)\r\n      if (triCount > 1000 && triCount < 1000000) {\r\n        // note that bounds tree construction creates an index as a side effect if one doesn't already exist\r\n        geo.boundsTree = new MeshBVH(obj.geometry, { strategy: 0, maxDepth: 30 });\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction cloneGltf(gltf) {\r\n  return {\r\n    animations: gltf.scene.animations,\r\n    scene: cloneObject3D(gltf.scene)\r\n  };\r\n}\r\n\r\nfunction getHubsComponents(node) {\r\n  const hubsComponents =\r\n    node.userData.gltfExtensions &&\r\n    (node.userData.gltfExtensions.MOZ_hubs_components || node.userData.gltfExtensions.HUBS_components);\r\n\r\n  // We can remove support for legacy components when our environment, avatar and interactable models are\r\n  // updated to match Spoke output.\r\n  const legacyComponents = node.userData.components;\r\n\r\n  return hubsComponents || legacyComponents;\r\n}\r\n\r\n/// Walks the tree of three.js objects starting at the given node, using the GLTF data\r\n/// and template data to construct A-Frame entities and components when necessary.\r\n/// (It's unnecessary to construct entities for subtrees that have no component data\r\n/// or templates associated with any of their nodes.)\r\n///\r\n/// Returns the A-Frame entity associated with the given node, if one was constructed.\r\nconst inflateEntities = function(indexToEntityMap, node, templates, isRoot, modelToWorldScale = 1) {\r\n  // TODO: Remove this once we update the legacy avatars to the new node names\r\n  if (node.name === \"Chest\") {\r\n    node.name = \"Spine\";\r\n  } else if (node.name === \"Root Scene\") {\r\n    node.name = \"AvatarRoot\";\r\n  } else if (node.name === \"Bot_Skinned\") {\r\n    node.name = \"AvatarMesh\";\r\n  }\r\n\r\n  // inflate subtrees first so that we can determine whether or not this node needs to be inflated\r\n  const childEntities = [];\r\n  const children = node.children.slice(0); // setObject3D mutates the node's parent, so we have to copy\r\n  for (const child of children) {\r\n    const el = inflateEntities(indexToEntityMap, child, templates);\r\n    if (el) {\r\n      childEntities.push(el);\r\n    }\r\n  }\r\n\r\n  const entityComponents = getHubsComponents(node);\r\n\r\n  const nodeHasBehavior = !!entityComponents || node.name in templates;\r\n  if (!nodeHasBehavior && !childEntities.length && !isRoot) {\r\n    return null; // we don't need an entity for this node\r\n  }\r\n\r\n  const el = document.createElement(\"a-entity\");\r\n  el.append.apply(el, childEntities);\r\n\r\n  // Remove invalid CSS class name characters.\r\n  const className = (node.name || node.uuid).replace(/[^\\w-]/g, \"\");\r\n  el.classList.add(className);\r\n\r\n  // AFRAME rotation component expects rotations in YXZ, convert it\r\n  if (node.rotation.order !== \"YXZ\") {\r\n    node.rotation.setFromQuaternion(node.quaternion, \"YXZ\");\r\n  }\r\n\r\n  // Copy over the object's transform to the THREE.Group and reset the actual transform of the Object3D\r\n  // all updates to the object should be done through the THREE.Group wrapper\r\n  el.object3D.position.copy(node.position);\r\n  el.object3D.rotation.copy(node.rotation);\r\n  el.object3D.scale.copy(node.scale).multiplyScalar(modelToWorldScale);\r\n  el.object3D.matrixNeedsUpdate = true;\r\n\r\n  node.matrixAutoUpdate = false;\r\n  node.matrix.identity();\r\n  node.matrix.decompose(node.position, node.rotation, node.scale);\r\n\r\n  el.setObject3D(node.type.toLowerCase(), node);\r\n  if (entityComponents && \"nav-mesh\" in entityComponents) {\r\n    el.setObject3D(\"mesh\", node);\r\n  }\r\n\r\n  // Set the name of the `THREE.Group` to match the name of the node,\r\n  // so that templates can be attached to the correct AFrame entity.\r\n  el.object3D.name = node.name;\r\n\r\n  // Set the uuid of the `THREE.Group` to match the uuid of the node,\r\n  // so that `THREE.PropertyBinding` will find (and later animate)\r\n  // the group. See `PropertyBinding.findNode`:\r\n  // https://github.com/mrdoob/three.js/blob/dev/src/animation/PropertyBinding.js#L211\r\n  el.object3D.uuid = node.uuid;\r\n  node.uuid = THREE.Math.generateUUID();\r\n\r\n  if (node.animations) {\r\n    // Pass animations up to the group object so that when we can pass the group as\r\n    // the optional root in `THREE.AnimationMixer.clipAction` and use the hierarchy\r\n    // preserved under the group (but not the node). Otherwise `clipArray` will be\r\n    // `null` in `THREE.AnimationClip.findByName`.\r\n    node.parent.animations = node.animations;\r\n  }\r\n\r\n  if (node.morphTargetInfluences) {\r\n    node.parent.morphTargetInfluences = node.morphTargetInfluences;\r\n  }\r\n\r\n  const gltfIndex = node.userData.gltfIndex;\r\n  if (gltfIndex !== undefined) {\r\n    indexToEntityMap[gltfIndex] = el;\r\n  }\r\n\r\n  return el;\r\n};\r\n\r\nasync function inflateComponents(inflatedEntity, indexToEntityMap) {\r\n  let isFirstInflation = true;\r\n  const objectInflations = [];\r\n\r\n  inflatedEntity.object3D.traverse(async object3D => {\r\n    const objectInflation = {};\r\n    objectInflation.promise = new Promise(resolve => (objectInflation.resolve = resolve));\r\n    objectInflations.push(objectInflation);\r\n\r\n    if (!isFirstInflation) {\r\n      await objectInflations.shift().promise;\r\n    }\r\n    isFirstInflation = false;\r\n\r\n    const entityComponents = getHubsComponents(object3D);\r\n    const el = object3D.el;\r\n\r\n    if (entityComponents && el) {\r\n      for (const prop in entityComponents) {\r\n        if (entityComponents.hasOwnProperty(prop) && AFRAME.GLTFModelPlus.components.hasOwnProperty(prop)) {\r\n          const { componentName, inflator } = AFRAME.GLTFModelPlus.components[prop];\r\n          await inflator(el, componentName, entityComponents[prop], entityComponents, indexToEntityMap);\r\n        }\r\n      }\r\n    }\r\n\r\n    objectInflation.resolve();\r\n  });\r\n\r\n  await objectInflations.shift().promise;\r\n}\r\n\r\nfunction attachTemplate(root, name, templateRoot) {\r\n  const targetEls = root.querySelectorAll(\".\" + name);\r\n  for (const el of targetEls) {\r\n    const root = templateRoot.cloneNode(true);\r\n    // Merge root element attributes with the target element\r\n    for (const { name, value } of root.attributes) {\r\n      el.setAttribute(name, value);\r\n    }\r\n\r\n    // Append all child elements\r\n    while (root.children.length > 0) {\r\n      el.appendChild(root.children[0]);\r\n    }\r\n  }\r\n}\r\n\r\nfunction getHubsComponentsExtension(node) {\r\n  if (node.extensions && node.extensions.MOZ_hubs_components) {\r\n    return node.extensions.MOZ_hubs_components;\r\n  } else if (node.extensions && node.extensions.HUBS_components) {\r\n    return node.extensions.HUBS_components;\r\n  } else if (node.extras && node.extras.gltfExtensions && node.extras.gltfExtensions.MOZ_hubs_components) {\r\n    return node.extras.gltfExtensions.MOZ_hubs_components;\r\n  }\r\n}\r\n\r\n// Versions are documented here: https://github.com/mozilla/hubs/wiki/MOZ_hubs_components-Changelog\r\n// Make sure to update the wiki and Spoke when bumping a version\r\nfunction runMigration(version, json) {\r\n  if (version < 2) {\r\n    //old heightfields will be on the same node as the nav-mesh, delete those\r\n    const oldHeightfieldNode = json.nodes.find(node => {\r\n      const components = getHubsComponentsExtension(node);\r\n      return components && components.heightfield && components[\"nav-mesh\"];\r\n    });\r\n    if (oldHeightfieldNode) {\r\n      if (oldHeightfieldNode.extensions && oldHeightfieldNode.extensions.MOZ_hubs_components) {\r\n        delete oldHeightfieldNode.extensions.MOZ_hubs_components.heightfield;\r\n      } else if (oldHeightfieldNode.extensions && oldHeightfieldNode.extensions.HUBS_components) {\r\n        delete oldHeightfieldNode.extensions.HUBS_components.heightfield;\r\n      } else if (\r\n        oldHeightfieldNode.extras &&\r\n        oldHeightfieldNode.extras.gltfExtensions &&\r\n        oldHeightfieldNode.extras.gltfExtensions.MOZ_hubs_components\r\n      ) {\r\n        delete oldHeightfieldNode.extras.gltfExtensions.MOZ_hubs_components;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (version < 4) {\r\n    // Lights prior to version 4 should treat range === 0 as if it has zero decay\r\n    if (json.nodes) {\r\n      for (const node of json.nodes) {\r\n        const components = getHubsComponentsExtension(node);\r\n\r\n        if (!components) {\r\n          continue;\r\n        }\r\n\r\n        const light = components[\"spot-light\"] || components[\"point-light\"];\r\n\r\n        if (light && light.range === 0) {\r\n          light.decay = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport async function loadGLTF(src, contentType, preferredTechnique, onProgress, jsonPreprocessor) {\r\n  let gltfUrl = src;\r\n  let fileMap;\r\n\r\n  if (contentType && (contentType.includes(\"model/gltf+zip\") || contentType.includes(\"application/x-zip-compressed\"))) {\r\n    fileMap = await extractZipFile(gltfUrl);\r\n    gltfUrl = fileMap[\"scene.gtlf\"];\r\n  }\r\n\r\n  const loadingManager = new THREE.LoadingManager();\r\n  loadingManager.setURLModifier(getCustomGLTFParserURLResolver(gltfUrl));\r\n  const gltfLoader = new THREE.GLTFLoader(loadingManager);\r\n  gltfLoader.setBasisTextureLoader(basisTextureLoader);\r\n\r\n  const parser = await new Promise((resolve, reject) => gltfLoader.createParser(gltfUrl, resolve, onProgress, reject));\r\n\r\n  parser.textureLoader = textureLoader;\r\n\r\n  if (jsonPreprocessor) {\r\n    parser.json = jsonPreprocessor(parser.json);\r\n  }\r\n\r\n  let version = 0;\r\n  if (\r\n    parser.json.extensions &&\r\n    parser.json.extensions.MOZ_hubs_components &&\r\n    parser.json.extensions.MOZ_hubs_components.hasOwnProperty(\"version\")\r\n  ) {\r\n    version = parser.json.extensions.MOZ_hubs_components.version;\r\n  }\r\n  runMigration(version, parser.json);\r\n\r\n  const materials = parser.json.materials;\r\n  if (materials) {\r\n    for (let i = 0; i < materials.length; i++) {\r\n      const material = materials[i];\r\n\r\n      if (\r\n        material.extensions &&\r\n        material.extensions.MOZ_alt_materials &&\r\n        material.extensions.MOZ_alt_materials[preferredTechnique] !== undefined\r\n      ) {\r\n        const altMaterialIndex = material.extensions.MOZ_alt_materials[preferredTechnique];\r\n        materials[i] = materials[altMaterialIndex];\r\n      }\r\n    }\r\n  }\r\n\r\n  const nodes = parser.json.nodes;\r\n\r\n  if (nodes) {\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      const node = nodes[i];\r\n\r\n      if (!node.extras) {\r\n        node.extras = {};\r\n      }\r\n\r\n      node.extras.gltfIndex = i;\r\n    }\r\n  }\r\n\r\n  const gltf = await new Promise(parser.parse.bind(parser));\r\n\r\n  gltf.scene.traverse(object => {\r\n    // GLTFLoader sets matrixAutoUpdate on animated objects, we want to keep the defaults\r\n    object.matrixAutoUpdate = THREE.Object3D.DefaultMatrixAutoUpdate;\r\n\r\n    object.material = mapMaterials(object, material => {\r\n      if (material.isMeshStandardMaterial && preferredTechnique === \"KHR_materials_unlit\") {\r\n        return MobileStandardMaterial.fromStandardMaterial(material);\r\n      }\r\n\r\n      return material;\r\n    });\r\n  });\r\n\r\n  if (fileMap) {\r\n    // The GLTF is now cached as a THREE object, we can get rid of the original blobs\r\n    Object.keys(fileMap).forEach(URL.revokeObjectURL);\r\n  }\r\n\r\n  gltf.scene.animations = gltf.animations;\r\n\r\n  return gltf;\r\n}\r\n\r\nexport async function loadModel(src, contentType = null, useCache = false, jsonPreprocessor = null) {\r\n  const preferredTechnique =\r\n    window.APP && window.APP.quality === \"low\" ? \"KHR_materials_unlit\" : \"pbrMetallicRoughness\";\r\n\r\n  if (useCache) {\r\n    if (gltfCache.has(src)) {\r\n      gltfCache.retain(src);\r\n      return cloneGltf(gltfCache.get(src).gltf);\r\n    } else {\r\n      if (inflightGltfs.has(src)) {\r\n        const gltf = await inflightGltfs.get(src);\r\n        gltfCache.retain(src);\r\n        return cloneGltf(gltf);\r\n      } else {\r\n        const promise = loadGLTF(src, contentType, preferredTechnique, null, jsonPreprocessor);\r\n        inflightGltfs.set(src, promise);\r\n        const gltf = await promise;\r\n        inflightGltfs.delete(src);\r\n        gltfCache.set(src, gltf);\r\n        return cloneGltf(gltf);\r\n      }\r\n    }\r\n  } else {\r\n    return loadGLTF(src, contentType, preferredTechnique, null, jsonPreprocessor);\r\n  }\r\n}\r\n\r\nfunction resolveAsset(src) {\r\n  // If the src attribute is a selector, get the url from the asset item.\r\n  if (src && src.charAt(0) === \"#\") {\r\n    const assetEl = document.getElementById(src.substring(1));\r\n    if (assetEl) {\r\n      return assetEl.getAttribute(\"src\");\r\n    }\r\n  }\r\n  return src;\r\n}\r\n\r\n/**\r\n * Loads a GLTF model, optionally recursively \"inflates\" the child nodes of a model into a-entities and sets\r\n * whitelisted components on them if defined in the node's extras.\r\n * @namespace gltf\r\n * @component gltf-model-plus\r\n */\r\nAFRAME.registerComponent(\"gltf-model-plus\", {\r\n  schema: {\r\n    src: { type: \"string\" },\r\n    contentType: { type: \"string\" },\r\n    useCache: { default: true },\r\n    inflate: { default: false },\r\n    batch: { default: false },\r\n    modelToWorldScale: { type: \"number\", default: 1 }\r\n  },\r\n\r\n  init() {\r\n    // This can be set externally if a consumer wants to do some node preprocssing.\r\n    this.jsonPreprocessor = null;\r\n\r\n    this.loadTemplates();\r\n  },\r\n\r\n  update() {\r\n    this.applySrc(resolveAsset(this.data.src), this.data.contentType);\r\n  },\r\n\r\n  remove() {\r\n    if (this.data.batch && this.model) {\r\n      this.el.sceneEl.systems[\"hubs-systems\"].batchManagerSystem.removeObject(this.el.object3DMap.mesh);\r\n    }\r\n    const src = resolveAsset(this.data.src);\r\n    if (src) {\r\n      gltfCache.release(src);\r\n    }\r\n  },\r\n\r\n  loadTemplates() {\r\n    this.templates = {};\r\n    this.el.querySelectorAll(\":scope > template\").forEach(templateEl => {\r\n      const root = document.importNode(templateEl.firstElementChild || templateEl.content.firstElementChild, true);\r\n      this.templates[templateEl.getAttribute(\"data-name\")] = root;\r\n    });\r\n  },\r\n\r\n  async applySrc(src, contentType) {\r\n    try {\r\n      if (src === this.lastSrc) return;\r\n\r\n      const lastSrc = this.lastSrc;\r\n      this.lastSrc = src;\r\n\r\n      if (!src) {\r\n        if (this.inflatedEl) {\r\n          console.warn(\"gltf-model-plus set to an empty source, unloading inflated model.\");\r\n          this.disposeLastInflatedEl();\r\n        }\r\n        return;\r\n      }\r\n\r\n      this.el.emit(\"model-loading\");\r\n      const gltf = await loadModel(src, contentType, this.data.useCache, this.jsonPreprocessor);\r\n\r\n      // If we started loading something else already\r\n      // TODO: there should be a way to cancel loading instead\r\n      if (src != this.lastSrc) return;\r\n\r\n      // If we had inflated something already before, clean that up\r\n      this.disposeLastInflatedEl();\r\n\r\n      this.model = gltf.scene || gltf.scenes[0];\r\n\r\n      if (this.data.batch) {\r\n        this.el.sceneEl.systems[\"hubs-systems\"].batchManagerSystem.addObject(this.model);\r\n      }\r\n\r\n      if (gltf.animations.length > 0) {\r\n        this.el.setAttribute(\"animation-mixer\", {});\r\n        this.el.components[\"animation-mixer\"].initMixer(this.model.animations);\r\n      } else {\r\n        generateMeshBVH(this.model);\r\n      }\r\n\r\n      const indexToEntityMap = {};\r\n\r\n      let object3DToSet = this.model;\r\n      if (\r\n        this.data.inflate &&\r\n        (this.inflatedEl = inflateEntities(\r\n          indexToEntityMap,\r\n          this.model,\r\n          this.templates,\r\n          true,\r\n          this.data.modelToWorldScale\r\n        ))\r\n      ) {\r\n        this.el.appendChild(this.inflatedEl);\r\n\r\n        object3DToSet = this.inflatedEl.object3D;\r\n        object3DToSet.visible = false;\r\n\r\n        // TODO: Still don't fully understand the lifecycle here and how it differs between browsers, we should dig in more\r\n        // Wait one tick for the appended custom elements to be connected before attaching templates\r\n        await nextTick();\r\n        if (src != this.lastSrc) return; // TODO: there must be a nicer pattern for this\r\n\r\n        await inflateComponents(this.inflatedEl, indexToEntityMap);\r\n\r\n        for (const name in this.templates) {\r\n          attachTemplate(this.el, name, this.templates[name]);\r\n        }\r\n      }\r\n\r\n      // The call to setObject3D below recursively clobbers any `el` backreferences to entities\r\n      // in the entire inflated entity graph to point to `object3DToSet`.\r\n      //\r\n      // We don't want those overwritten, since lots of code assumes `object3d.el` points to the relevant\r\n      // A-Frame entity for that three.js object, so we back them up and re-wire them here. If we didn't do\r\n      // this, all the `el` properties on these object3ds would point to the `object3DToSet` which is either\r\n      // the model or the root GLTF inflated entity.\r\n      const rewires = [];\r\n\r\n      object3DToSet.traverse(o => {\r\n        const el = o.el;\r\n        if (el) rewires.push(() => (o.el = el));\r\n      });\r\n\r\n      const environmentMapComponent = this.el.sceneEl.components[\"environment-map\"];\r\n\r\n      if (environmentMapComponent) {\r\n        environmentMapComponent.applyEnvironmentMap(object3DToSet);\r\n      }\r\n\r\n      if (lastSrc) {\r\n        gltfCache.release(lastSrc);\r\n      }\r\n      this.el.setObject3D(\"mesh\", object3DToSet);\r\n\r\n      rewires.forEach(f => f());\r\n\r\n      object3DToSet.visible = true;\r\n      this.el.emit(\"model-loaded\", { format: \"gltf\", model: this.model });\r\n    } catch (e) {\r\n      gltfCache.release(src);\r\n      console.error(\"Failed to load glTF model\", e, this);\r\n      this.el.emit(\"model-error\", { format: \"gltf\", src });\r\n    }\r\n  },\r\n\r\n  disposeLastInflatedEl() {\r\n    if (this.inflatedEl) {\r\n      this.inflatedEl.parentNode.removeChild(this.inflatedEl);\r\n\r\n      this.inflatedEl.object3D.traverse(x => {\r\n        if (x.material && x.material.dispose) {\r\n          x.material.dispose();\r\n        }\r\n\r\n        if (x.geometry) {\r\n          if (x.geometry.dispose) {\r\n            x.geometry.dispose();\r\n          }\r\n\r\n          x.geometry.boundsTree = null;\r\n        }\r\n      });\r\n\r\n      delete this.inflatedEl;\r\n\r\n      this.el.removeAttribute(\"animation-mixer\");\r\n    }\r\n  }\r\n});\r\n","const tempVector3 = new THREE.Vector3();\r\nconst tempQuaternion = new THREE.Quaternion();\r\n\r\nexport function getLastWorldPosition(src, target) {\r\n  src.updateMatrices();\r\n  target.setFromMatrixPosition(src.matrixWorld);\r\n  return target;\r\n}\r\n\r\nexport function getLastWorldQuaternion(src, target) {\r\n  src.updateMatrices();\r\n  src.matrixWorld.decompose(tempVector3, target, tempVector3);\r\n  return target;\r\n}\r\n\r\nexport function getLastWorldScale(src, target) {\r\n  src.updateMatrices();\r\n  src.matrixWorld.decompose(tempVector3, tempQuaternion, target);\r\n  return target;\r\n}\r\n\r\nexport function disposeMaterial(mtrl) {\r\n  if (mtrl.map) mtrl.map.dispose();\r\n  if (mtrl.lightMap) mtrl.lightMap.dispose();\r\n  if (mtrl.bumpMap) mtrl.bumpMap.dispose();\r\n  if (mtrl.normalMap) mtrl.normalMap.dispose();\r\n  if (mtrl.specularMap) mtrl.specularMap.dispose();\r\n  if (mtrl.envMap) mtrl.envMap.dispose();\r\n  mtrl.dispose();\r\n}\r\n\r\nexport function disposeNode(node) {\r\n  if (!(node instanceof THREE.Mesh)) return;\r\n\r\n  if (node.geometry) {\r\n    node.geometry.dispose();\r\n  }\r\n\r\n  if (node.material) {\r\n    let materialArray;\r\n    if (node.material instanceof THREE.MeshFaceMaterial || node.material instanceof THREE.MultiMaterial) {\r\n      materialArray = node.material.materials;\r\n    } else if (node.material instanceof Array) {\r\n      materialArray = node.material;\r\n    }\r\n    if (materialArray) {\r\n      materialArray.forEach(disposeMaterial);\r\n    } else {\r\n      disposeMaterial(node.material);\r\n    }\r\n  }\r\n}\r\n\r\nconst IDENTITY = new THREE.Matrix4().identity();\r\nexport function setMatrixWorld(object3D, m) {\r\n  if (!object3D.matrixIsModified) {\r\n    object3D.applyMatrix(IDENTITY); // hack around our matrix optimizations\r\n  }\r\n  object3D.matrixWorld.copy(m);\r\n  if (object3D.parent) {\r\n    object3D.matrix = object3D.matrix.getInverse(object3D.parent.matrixWorld).multiply(object3D.matrixWorld);\r\n  } else {\r\n    object3D.matrix.copy(object3D.matrixWorld);\r\n  }\r\n  object3D.matrix.decompose(object3D.position, object3D.quaternion, object3D.scale);\r\n  object3D.childrenNeedMatrixWorldUpdate = true;\r\n}\r\n\r\n// Modified version of Don McCurdy's AnimationUtils.clone\r\n// https://github.com/mrdoob/three.js/pull/14494\r\n\r\nfunction parallelTraverse(a, b, callback) {\r\n  callback(a, b);\r\n\r\n  for (let i = 0; i < a.children.length; i++) {\r\n    parallelTraverse(a.children[i], b.children[i], callback);\r\n  }\r\n}\r\n\r\n// Supports the following PropertyBinding path formats:\r\n// uuid.propertyName\r\n// uuid.propertyName[propertyIndex]\r\n// uuid.objectName[objectIndex].propertyName[propertyIndex]\r\n// Does not support property bindings that use object3D names or parent nodes\r\nfunction cloneKeyframeTrack(sourceKeyframeTrack, cloneUUIDLookup) {\r\n  const { nodeName: uuid, objectName, objectIndex, propertyName, propertyIndex } = THREE.PropertyBinding.parseTrackName(\r\n    sourceKeyframeTrack.name\r\n  );\r\n\r\n  let path = \"\";\r\n\r\n  if (uuid !== undefined) {\r\n    const clonedUUID = cloneUUIDLookup.get(uuid);\r\n\r\n    if (clonedUUID === undefined) {\r\n      console.warn(`Could not find KeyframeTrack target with uuid: \"${uuid}\"`);\r\n    }\r\n\r\n    path += clonedUUID;\r\n  }\r\n\r\n  if (objectName !== undefined) {\r\n    path += \".\" + objectName;\r\n  }\r\n\r\n  if (objectIndex !== undefined) {\r\n    path += \"[\" + objectIndex + \"]\";\r\n  }\r\n\r\n  if (propertyName !== undefined) {\r\n    path += \".\" + propertyName;\r\n  }\r\n\r\n  if (propertyIndex !== undefined) {\r\n    path += \"[\" + propertyIndex + \"]\";\r\n  }\r\n\r\n  const clonedKeyframeTrack = sourceKeyframeTrack.clone();\r\n  clonedKeyframeTrack.name = path;\r\n\r\n  return clonedKeyframeTrack;\r\n}\r\n\r\nfunction cloneAnimationClip(sourceAnimationClip, cloneUUIDLookup) {\r\n  const clonedTracks = sourceAnimationClip.tracks.map(keyframeTrack =>\r\n    cloneKeyframeTrack(keyframeTrack, cloneUUIDLookup)\r\n  );\r\n  return new THREE.AnimationClip(sourceAnimationClip.name, sourceAnimationClip.duration, clonedTracks);\r\n}\r\n\r\nexport function cloneObject3D(source, preserveUUIDs) {\r\n  const cloneLookup = new Map();\r\n  const cloneUUIDLookup = new Map();\r\n\r\n  const clone = source.clone();\r\n\r\n  parallelTraverse(source, clone, (sourceNode, clonedNode) => {\r\n    cloneLookup.set(sourceNode, clonedNode);\r\n  });\r\n\r\n  source.traverse(sourceNode => {\r\n    const clonedNode = cloneLookup.get(sourceNode);\r\n\r\n    if (preserveUUIDs) {\r\n      clonedNode.uuid = sourceNode.uuid;\r\n    }\r\n\r\n    cloneUUIDLookup.set(sourceNode.uuid, clonedNode.uuid);\r\n  });\r\n\r\n  source.traverse(sourceNode => {\r\n    const clonedNode = cloneLookup.get(sourceNode);\r\n\r\n    if (!clonedNode) {\r\n      return;\r\n    }\r\n\r\n    if (sourceNode.animations) {\r\n      clonedNode.animations = sourceNode.animations.map(animationClip =>\r\n        cloneAnimationClip(animationClip, cloneUUIDLookup)\r\n      );\r\n    }\r\n\r\n    if (sourceNode.isMesh && sourceNode.geometry.boundsTree) {\r\n      clonedNode.geometry.boundsTree = sourceNode.geometry.boundsTree;\r\n    }\r\n\r\n    if (!sourceNode.isSkinnedMesh) return;\r\n\r\n    const sourceBones = sourceNode.skeleton.bones;\r\n\r\n    clonedNode.skeleton = sourceNode.skeleton.clone();\r\n\r\n    clonedNode.skeleton.bones = sourceBones.map(sourceBone => {\r\n      if (!cloneLookup.has(sourceBone)) {\r\n        throw new Error(\"Required bones are not descendants of the given object.\");\r\n      }\r\n\r\n      return cloneLookup.get(sourceBone);\r\n    });\r\n\r\n    clonedNode.bind(clonedNode.skeleton, sourceNode.bindMatrix);\r\n  });\r\n\r\n  return clone;\r\n}\r\n\r\nexport function findNode(root, pred) {\r\n  let nodes = [root];\r\n  while (nodes.length) {\r\n    const node = nodes.shift();\r\n    if (pred(node)) return node;\r\n    if (node.children) nodes = nodes.concat(node.children);\r\n  }\r\n  return null;\r\n}\r\n\r\nexport const interpolateAffine = (function() {\r\n  const mat4 = new THREE.Matrix4();\r\n  const end = {\r\n    position: new THREE.Vector3(),\r\n    quaternion: new THREE.Quaternion(),\r\n    scale: new THREE.Vector3()\r\n  };\r\n  const start = {\r\n    position: new THREE.Vector3(),\r\n    quaternion: new THREE.Quaternion(),\r\n    scale: new THREE.Vector3()\r\n  };\r\n  const interpolated = {\r\n    position: new THREE.Vector3(),\r\n    quaternion: new THREE.Quaternion(),\r\n    scale: new THREE.Vector3()\r\n  };\r\n  return function(startMat4, endMat4, progress, outMat4) {\r\n    start.quaternion.setFromRotationMatrix(mat4.extractRotation(startMat4));\r\n    end.quaternion.setFromRotationMatrix(mat4.extractRotation(endMat4));\r\n    THREE.Quaternion.slerp(start.quaternion, end.quaternion, interpolated.quaternion, progress);\r\n    interpolated.position.lerpVectors(\r\n      start.position.setFromMatrixColumn(startMat4, 3),\r\n      end.position.setFromMatrixColumn(endMat4, 3),\r\n      progress\r\n    );\r\n    interpolated.scale.lerpVectors(\r\n      start.scale.setFromMatrixScale(startMat4),\r\n      end.scale.setFromMatrixScale(endMat4),\r\n      progress\r\n    );\r\n    return outMat4.compose(\r\n      interpolated.position,\r\n      interpolated.quaternion,\r\n      interpolated.scale\r\n    );\r\n  };\r\n})();\r\n\r\nexport const squareDistanceBetween = (function() {\r\n  const posA = new THREE.Vector3();\r\n  const posB = new THREE.Vector3();\r\n  return function(objA, objB) {\r\n    objA.updateMatrices();\r\n    objB.updateMatrices();\r\n    posA.setFromMatrixColumn(objA.matrixWorld, 3);\r\n    posB.setFromMatrixColumn(objB.matrixWorld, 3);\r\n    return posA.distanceToSquared(posB);\r\n  };\r\n})();\r\n\r\nexport function isAlmostUniformVector3(v, epsilonHalf = 0.005) {\r\n  return Math.abs(v.x - v.y) < epsilonHalf && Math.abs(v.x - v.z) < epsilonHalf;\r\n}\r\nexport function almostEqual(a, b, epsilon = 0.01) {\r\n  return Math.abs(a - b) < epsilon;\r\n}\r\n\r\nexport const affixToWorldUp = (function() {\r\n  const inRotationMat4 = new THREE.Matrix4();\r\n  const inForward = new THREE.Vector3();\r\n  const outForward = new THREE.Vector3();\r\n  const outSide = new THREE.Vector3();\r\n  const worldUp = new THREE.Vector3(); // Could be called \"outUp\"\r\n  const v = new THREE.Vector3();\r\n  const inMat4Copy = new THREE.Matrix4();\r\n  return function affixToWorldUp(inMat4, outMat4) {\r\n    inRotationMat4.identity().extractRotation(inMat4Copy.copy(inMat4));\r\n    inForward.setFromMatrixColumn(inRotationMat4, 2).multiplyScalar(-1);\r\n    outForward\r\n      .copy(inForward)\r\n      .sub(v.copy(inForward).projectOnVector(worldUp.set(0, 1, 0)))\r\n      .normalize();\r\n    outSide.crossVectors(outForward, worldUp);\r\n    outMat4.makeBasis(outSide, worldUp, outForward.multiplyScalar(-1));\r\n    outMat4.scale(v.setFromMatrixScale(inMat4Copy));\r\n    outMat4.setPosition(v.setFromMatrixColumn(inMat4Copy, 3));\r\n    return outMat4;\r\n  };\r\n})();\r\n\r\nexport const calculateCameraTransformForWaypoint = (function() {\r\n  const upAffixedCameraTransform = new THREE.Matrix4();\r\n  const upAffixedWaypointTransform = new THREE.Matrix4();\r\n  const detachFromWorldUp = new THREE.Matrix4();\r\n  return function calculateCameraTransformForWaypoint(cameraTransform, waypointTransform, outMat4) {\r\n    affixToWorldUp(cameraTransform, upAffixedCameraTransform);\r\n    detachFromWorldUp.getInverse(upAffixedCameraTransform).multiply(cameraTransform);\r\n    affixToWorldUp(waypointTransform, upAffixedWaypointTransform);\r\n    outMat4.copy(upAffixedWaypointTransform).multiply(detachFromWorldUp);\r\n  };\r\n})();\r\n\r\nexport const calculateViewingDistance = (function() {\r\n  return function calculateViewingDistance(fov, aspect, object, box, center, vrMode) {\r\n    const halfYExtents = Math.max(Math.abs(box.max.y - center.y), Math.abs(center.y - box.min.y));\r\n    const halfXExtents = Math.max(Math.abs(box.max.x - center.x), Math.abs(center.x - box.min.x));\r\n    const halfVertFOV = THREE.Math.degToRad(fov / 2);\r\n    const halfHorFOV = Math.atan(Math.tan(halfVertFOV) * aspect) * (vrMode ? 0.5 : 1);\r\n    const margin = 1.05;\r\n    const length1 = Math.abs((halfYExtents * margin) / Math.tan(halfVertFOV));\r\n    const length2 = Math.abs((halfXExtents * margin) / Math.tan(halfHorFOV));\r\n    const length3 = Math.abs(box.max.z - center.z) + Math.max(length1, length2);\r\n    const length = vrMode ? Math.max(0.25, length3) : length3;\r\n    return length || 1.25;\r\n  };\r\n})();\r\n\r\nexport const rotateInPlaceAroundWorldUp = (function() {\r\n  const inMat4Copy = new THREE.Matrix4();\r\n  const startRotation = new THREE.Matrix4();\r\n  const endRotation = new THREE.Matrix4();\r\n  const v = new THREE.Vector3();\r\n  return function rotateInPlaceAroundWorldUp(inMat4, theta, outMat4) {\r\n    inMat4Copy.copy(inMat4);\r\n    return outMat4\r\n      .copy(endRotation.makeRotationY(theta).multiply(startRotation.extractRotation(inMat4Copy)))\r\n      .scale(v.setFromMatrixScale(inMat4Copy))\r\n      .setPosition(v.setFromMatrixPosition(inMat4Copy));\r\n  };\r\n})();\r\n\r\nexport const childMatch = (function() {\r\n  const childInverse = new THREE.Matrix4();\r\n  const newParentMatrix = new THREE.Matrix4();\r\n  // transform the parent such that its child matches the target\r\n  return function childMatch(parent, child, target) {\r\n    child.updateMatrices();\r\n    childInverse.getInverse(child.matrix);\r\n    newParentMatrix.multiplyMatrices(target, childInverse);\r\n    setMatrixWorld(parent, newParentMatrix);\r\n  };\r\n})();\r\n","export const createImageBitmap =\r\n  window.createImageBitmap ||\r\n  async function(data) {\r\n    return new Promise(resolve => {\r\n      // https://dev.to/nektro/createimagebitmap-polyfill-for-safari-and-edge-228\r\n      // https://gist.github.com/MonsieurV/fb640c29084c171b4444184858a91bc7\r\n\r\n      let srcUrl;\r\n      if (data instanceof Blob) {\r\n        srcUrl = URL.createObjectURL(data);\r\n      } else {\r\n        const canvas = document.createElement(\"canvas\");\r\n        const ctx = canvas.getContext(\"2d\");\r\n        canvas.width = data.width;\r\n        canvas.height = data.height;\r\n        ctx.putImageData(data, 0, 0);\r\n        srcUrl = canvas.toDataURL();\r\n      }\r\n      const img = document.createElement(\"img\");\r\n\r\n      img.addEventListener(\"load\", () => resolve(img));\r\n\r\n      img.src = srcUrl;\r\n    });\r\n  };\r\n\r\nexport function disposeImageBitmap(imageBitmap) {\r\n  if (imageBitmap instanceof HTMLImageElement && imageBitmap.src.startsWith(\"blob:\")) {\r\n    URL.revokeObjectURL(imageBitmap.src);\r\n  } else {\r\n    imageBitmap.close && imageBitmap.close();\r\n  }\r\n}\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"avatar-landing\":\"avatar__avatar-landing__33j9b\",\"avatarLanding\":\"avatar__avatar-landing__33j9b\",\"form-submit\":\"avatar__form-submit__RsmP9\",\"formSubmit\":\"avatar__form-submit__RsmP9\",\"title\":\"avatar__title__rg8KL\",\"attributions\":\"avatar__attributions__3ULZG\",\"logo\":\"avatar__logo__BuXl_\",\"box\":\"avatar__box__sLtp1\",\"selected-message\":\"avatar__selected-message__1rYQu\",\"selectedMessage\":\"avatar__selected-message__1rYQu\",\"preview\":\"avatar__preview__1j63F\",\"copy-tip\":\"avatar__copy-tip__1qRHz\",\"copyTip\":\"avatar__copy-tip__1qRHz\",\"edit-avatar\":\"avatar__edit-avatar__2oK1-\",\"editAvatar\":\"avatar__edit-avatar__2oK1-\"};","import { waitForDOMContentLoaded } from \"./async-utils\";\r\nimport \"./configs\";\r\n\r\n// Node these should be synchronized with the top of shared.scss\r\nconst DEFAULT_ACTION_COLOR = \"#FF3464\";\r\nconst DEFAULT_ACTION_COLOR_LIGHT = \"#FF74A4\";\r\n\r\nconst DEFAULT_COLORS = {\r\n  \"action-color\": DEFAULT_ACTION_COLOR,\r\n  \"action-label-color\": DEFAULT_ACTION_COLOR,\r\n  \"action-color-disabled\": DEFAULT_ACTION_COLOR_LIGHT,\r\n  \"action-color-highlight\": DEFAULT_ACTION_COLOR_LIGHT,\r\n  \"action-text-color\": \"#FFFFFF\",\r\n  \"action-subtitle-color\": \"#F0F0F0\",\r\n  \"notice-background-color\": \"#2F80ED\",\r\n  \"notice-text-color\": \"#FFFFFF\",\r\n  \"favorited-color\": \"#FFC000\"\r\n};\r\n\r\nfunction getThemeColor(name) {\r\n  if (window.APP_CONFIG && window.APP_CONFIG.theme && window.APP_CONFIG.theme[name])\r\n    return window.APP_CONFIG.theme[name];\r\n\r\n  return DEFAULT_COLORS[name];\r\n}\r\n\r\nwaitForDOMContentLoaded().then(() => {\r\n  if (window.APP_CONFIG && window.APP_CONFIG.theme && window.APP_CONFIG.theme[\"dark-theme\"]) {\r\n    document.body.classList.add(\"dark-theme\");\r\n  } else {\r\n    document.body.classList.add(\"light-theme\");\r\n  }\r\n\r\n  const actionColor = getThemeColor(\"action-color\");\r\n  const actionHoverColor = getThemeColor(\"action-color-highlight\");\r\n\r\n  if (document.querySelector(\"#rounded-text-button\")) {\r\n    // NOTE, using the object-based {} setAttribute variant in a-frame\r\n    // seems to not work in Firefox here -- the entities with the mixins are not\r\n    // updated.\r\n    document\r\n      .querySelector(\"#rounded-text-button\")\r\n      .setAttribute(\r\n        \"text-button\",\r\n        `textHoverColor: ${actionHoverColor}; textColor: ${actionColor}; backgroundColor: #fff; backgroundHoverColor: #aaa;`\r\n      );\r\n\r\n    document\r\n      .querySelector(\"#rounded-button\")\r\n      .setAttribute(\r\n        \"text-button\",\r\n        `textHoverColor: ${actionHoverColor}; textColor: ${actionColor}; backgroundColor: #fff; backgroundHoverColor: #aaa;`\r\n      );\r\n\r\n    document\r\n      .querySelector(\"#rounded-text-action-button\")\r\n      .setAttribute(\r\n        \"text-button\",\r\n        `textHoverColor: #fff; textColor: #fff; backgroundColor: ${actionColor}; backgroundHoverColor: ${actionHoverColor}`\r\n      );\r\n\r\n    document\r\n      .querySelector(\"#rounded-action-button\")\r\n      .setAttribute(\r\n        \"text-button\",\r\n        `textHoverColor: #fff; textColor: #fff; backgroundColor: ${actionColor}; backgroundHoverColor: ${actionHoverColor}`\r\n      );\r\n  }\r\n});\r\n\r\nfunction applyThemeToTextButton(el, highlighted) {\r\n  el.setAttribute(\r\n    \"text-button\",\r\n    \"backgroundColor\",\r\n    highlighted ? getThemeColor(\"action-color-highlight\") : getThemeColor(\"action-color\")\r\n  );\r\n  el.setAttribute(\r\n    \"text-button\",\r\n    \"backgroundHoverColor\",\r\n    highlighted ? \"#aaa\" : getThemeColor(\"action-color-highlight\")\r\n  );\r\n}\r\n\r\nexport { applyThemeToTextButton, getThemeColor };\r\n","module.exports = __webpack_public_path__ + \"assets/images/warning_icon-739d2a2ea906737505bcbc2cb51123a8.png\";","const VERTEX_SHADER = `\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n  #include <uv_vertex>\r\n  #include <uv2_vertex>\r\n  #include <color_vertex>\r\n  #include <skinbase_vertex>\r\n\r\n  #include <begin_vertex>\r\n  #include <morphtarget_vertex>\r\n  #include <skinning_vertex>\r\n  #include <project_vertex>\r\n  #include <logdepthbuf_vertex>\r\n\r\n  #include <worldpos_vertex>\r\n  #include <clipping_planes_vertex>\r\n  #include <fog_vertex>\r\n}\r\n`;\r\n\r\nconst FRAGMENT_SHADER = `\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n  #include <clipping_planes_fragment>\r\n\r\n  vec4 diffuseColor = vec4(diffuse, opacity);\r\n  ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\r\n  vec3 totalEmissiveRadiance = emissive;\r\n\r\n  #include <logdepthbuf_fragment>\r\n  #include <map_fragment>\r\n  #include <color_fragment>\r\n  #include <alphatest_fragment>\r\n  #include <emissivemap_fragment>\r\n\r\n  reflectedLight.indirectDiffuse += vec3(1.0);\r\n\r\n  #include <aomap_fragment>\r\n\r\n  reflectedLight.indirectDiffuse *= diffuseColor.rgb;\r\n\r\n  vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\r\n\r\n  gl_FragColor = vec4(outgoingLight, diffuseColor.a);\r\n\r\n  #include <premultiplied_alpha_fragment>\r\n  #include <tonemapping_fragment>\r\n  #include <encodings_fragment>\r\n  #include <fog_fragment>\r\n}\r\n`;\r\n\r\nexport default class MobileStandardMaterial extends THREE.ShaderMaterial {\r\n  type = \"MobileStandardMaterial\";\r\n  isMobileStandardMaterial = true;\r\n  static fromStandardMaterial(material) {\r\n    const parameters = {\r\n      vertexShader: VERTEX_SHADER,\r\n      fragmentShader: FRAGMENT_SHADER,\r\n      uniforms: {\r\n        ...THREE.UniformsUtils.clone(THREE.UniformsLib.fog),\r\n        uvTransform: { value: new THREE.Matrix3() },\r\n        diffuse: { value: material.color },\r\n        opacity: { value: material.opacity },\r\n        map: { value: material.map },\r\n        aoMapIntensity: { value: material.aoMapIntensity },\r\n        aoMap: { value: material.aoMap },\r\n        emissive: { value: material.emissive },\r\n        emissiveMap: { value: material.emissiveMap }\r\n      },\r\n      fog: true,\r\n      lights: false,\r\n      opacity: material.opacity,\r\n      transparent: material.transparent,\r\n      alphaTest: material.alphaTest,\r\n      skinning: material.skinning,\r\n      morphTargets: material.morphTargets,\r\n      vertexColors: material.vertexColors,\r\n      name: material.name\r\n    };\r\n\r\n    const mobileMaterial = new MobileStandardMaterial(parameters);\r\n\r\n    mobileMaterial.color = material.color;\r\n    mobileMaterial.map = material.map;\r\n    mobileMaterial.aoMap = material.aoMap;\r\n    mobileMaterial.aoMapIntensity = material.aoMapIntensity;\r\n    mobileMaterial.emissive = material.emissive;\r\n    mobileMaterial.emissiveIntensity = material.emissiveIntensity;\r\n    mobileMaterial.emissiveMap = material.emissiveMap;\r\n\r\n    // TODO this actually needs to get called whenever any of these material properties change\r\n    mobileMaterial.refreshUniforms();\r\n\r\n    return mobileMaterial;\r\n  }\r\n\r\n  refreshUniforms() {\r\n    this.uniforms.opacity.value = this.opacity;\r\n\r\n    if (this.color) {\r\n      this.uniforms.diffuse.value.copy(this.color);\r\n    }\r\n\r\n    if (this.emissive) {\r\n      this.uniforms.emissive.value.copy(this.emissive).multiplyScalar(this.emissiveIntensity);\r\n    }\r\n\r\n    if (this.map) {\r\n      this.uniforms.map.value = this.map;\r\n    }\r\n\r\n    if (this.aoMap) {\r\n      this.uniforms.aoMap.value = this.aoMap;\r\n      this.uniforms.aoMapIntensity.value = this.aoMapIntensity;\r\n    }\r\n\r\n    const uvScaleMap = this.map || this.emissiveMap;\r\n    if (uvScaleMap && uvScaleMap.matrixAutoUpdate === true) {\r\n      uvScaleMap.updateMatrix();\r\n      this.uniforms.uvTransform.value.copy(uvScaleMap.matrix);\r\n    }\r\n  }\r\n\r\n  clone() {\r\n    return MobileStandardMaterial.fromStandardMaterial(this);\r\n  }\r\n}\r\n"],"sourceRoot":""}